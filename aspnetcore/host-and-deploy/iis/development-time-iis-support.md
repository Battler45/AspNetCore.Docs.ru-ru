---
title: Поддержка служб IIS во время разработки в Visual Studio для ASP.NET Core
author: guardrex
description: Узнайте о поддерживаемых возможностях для отладки приложений ASP.NET Core, выполняемых в службах IIS в Windows Server.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 10/10/2019
uid: host-and-deploy/iis/development-time-iis-support
ms.openlocfilehash: e5da4f7202bf31e65c366d6f7de54212f5b0fed7
ms.sourcegitcommit: 7d3c6565dda6241eb13f9a8e1e1fd89b1cfe4d18
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2019
ms.locfileid: "72259796"
---
# <a name="development-time-iis-support-in-visual-studio-for-aspnet-core"></a>Поддержка служб IIS во время разработки в Visual Studio для ASP.NET Core

Авторы: [Сурабх Ширхатти](https://twitter.com/sshirhatti) (Sourabh Shirhatti) и [Люк Латэм](https://github.com/guardrex) (Luke Latham)

В этой статье описаны поддерживаемые в [Visual Studio](https://visualstudio.microsoft.com) возможности для отладки приложений ASP.NET Core, выполняющихся в службах IIS в Windows Server. Также здесь приведены пошаговые инструкции по включению этого сценария и настройке проекта.

## <a name="prerequisites"></a>Предварительные требования

* [Visual Studio для Windows](https://visualstudio.microsoft.com/downloads/)
* Рабочая нагрузка **ASP.NET и веб-разработка**
* Рабочая нагрузка **Кроссплатформенная разработка .NET Core**
* Сертификат безопасности X.509 (для поддержки HTTPS)

## <a name="enable-iis"></a>Активация IIS

1. В Windows последовательно выберите **Панель управления** > **Программы** > **Программы и компоненты** > **Включение или отключение компонентов Windows** (в левой части экрана).
1. Установите флажок **Службы IIS**. Нажмите кнопку **ОК**.

Для установки служб IIS, возможно, потребуется перезагрузить компьютер.

## <a name="configure-iis"></a>Настройка IIS

В службах IIS нужно настроить веб-сайт со следующими характеристиками:

* **Имя узла**. Обычно используется **Веб-сайт по умолчанию** со значением `localhost`, заданным параметру **Имя узла**. Но можно также задать любой допустимый веб-сайт IIS с уникальным именем узла.
* **Привязка сайта**
  * Для приложений, которым требуется протокол HTTPS, создайте привязку к порту 443 с помощью сертификата. Обычно используется **сертификат разработки IIS Express**, но подойдет и любой другой действительный сертификат.
  * Для приложений, использующих протокол HTTP, подтвердите привязку к порту 80 или создайте привязку к порту 80 для нового сайта.
  * Используйте одну привязку либо для HTTP, либо для HTTPS. **Одновременная привязка к портам HTTP и HTTPS не поддерживается.**

## <a name="enable-development-time-iis-support-in-visual-studio"></a>Включение поддержки служб IIS в Visual Studio во время разработки

1. Запустите установщик Visual Studio.
1. Выберите **Изменить** в установщике программы Visual Studio, которую планируется использовать для поддержки IIS во время разработки.
1. Для рабочей нагрузки **ASP.NET и разработка веб-приложений** найдите и установите компонент **Поддержка времени разработки в IIS**.

   Компонент находится в разделе **Дополнительно** под пунктом **Поддержка времени разработки в IIS** на панели **Сведения об установке** справа от рабочих нагрузок. Этот компонент выполнит установку [модуля ASP.NET Core](xref:host-and-deploy/aspnet-core-module), который является собственным модулем IIS, необходимым для запуска приложений ASP.NET Core со службами IIS.

## <a name="configure-the-project"></a>Настройка проекта

### <a name="https-redirection"></a>Перенаправление HTTPS

Если новому проекту требуется протокол HTTPS, установите флажок **Configure for HTTPS** (Настроить для HTTPS) в окне **Создать веб-приложение ASP.NET Core**. Установка флажка добавляет [ПО промежуточного слоя перенаправления HTTPS и HSTS](xref:security/enforcing-ssl) в приложение при его создании.

Если существующему проекту требуется протокол HTTPS, используйте ПО промежуточного слоя перенаправления HTTPS и HSTS в `Startup.Configure`. Дополнительные сведения можно найти по адресу: <xref:security/enforcing-ssl>.

Для проекта, который использует протокол HTTP, поддержку [ПО промежуточного слоя перенаправления HTTPS и HSTS](xref:security/enforcing-ssl) задавать не нужно. Настройка приложения не требуется.

### <a name="iis-launch-profile"></a>Профиль запуска служб IIS

Создайте новый профиль запуска, чтобы добавить поддержку IIS во время разработки.

::: moniker range=">= aspnetcore-3.0"

1. В **обозревателе решений** щелкните проект правой кнопкой мыши. Выберите пункт **Свойства**. Откройте вкладку **Отладка**.
1. В разделе **Профиль** нажмите кнопку **Новый**. Во всплывающем окне присвойте новому профилю имя IIS. Нажмите кнопку **ОК**, чтобы создать проект.
1. В поле **Запуск** выберите из списка значение **IIS**.
1. Установите флажок **Запуск браузера** и укажите URL-адрес конечной точки.

   Если приложению требуется протокол HTTPS, используйте конечную точку HTTPS (`https://`). Для протокола HTTP используйте конечную точку HTTP (`http://`).

   Укажите то же имя узла и тот же порт, как в [выполненной ранее настройке IIS](#configure-iis). Обычно это `localhost`.

   Укажите имя приложения в конце URL-адреса.

   Например `https://localhost/WebApplication1` (HTTPS) или `http://localhost/WebApplication1` (HTTP) являются действительными URL-адресами конечной точки.
1. В разделе **Переменные среды** нажмите кнопку **Добавить**. Для переменной среды задайте **имя** `ASPNETCORE_ENVIRONMENT` и **значение** `Development`.
1. В области **Параметры веб-сервера** в поле **URL-адрес приложения** задайте значение, соответствующее URL-адресу конечной точки в поле **Запуск браузера**.
1. В Visual Studio 2019 и последующих версиях параметру **Модель размещения** задайте значение **По умолчанию**, чтобы использовать модель размещения проекта. Если для проекта задано свойство `<AspNetCoreHostingModel>` в файле проекта, используется значение свойства `InProcess` или `OutOfProcess`. Если свойство не задано, используется модель размещения приложения по умолчанию In Process. Если приложению требуется явно указать модель размещения, отличную от обычной модели размещения приложения, задайте параметру **Модель размещения** значение `In Process` или `Out Of Process` по необходимости.
1. Сохраните профиль.

::: moniker-end

::: moniker range="< aspnetcore-3.0"

1. В **обозревателе решений** щелкните проект правой кнопкой мыши. Выберите пункт **Свойства**. Откройте вкладку **Отладка**.
1. В разделе **Профиль** нажмите кнопку **Новый**. Во всплывающем окне присвойте новому профилю имя IIS. Нажмите кнопку **ОК**, чтобы создать проект.
1. В поле **Запуск** выберите из списка значение **IIS**.
1. Установите флажок **Запуск браузера** и укажите URL-адрес конечной точки.

   Если приложению требуется протокол HTTPS, используйте конечную точку HTTPS (`https://`). Для протокола HTTP используйте конечную точку HTTP (`http://`).

   Укажите то же имя узла и тот же порт, как в [выполненной ранее настройке IIS](#configure-iis). Обычно это `localhost`.

   Укажите имя приложения в конце URL-адреса.

   Например `https://localhost/WebApplication1` (HTTPS) или `http://localhost/WebApplication1` (HTTP) являются действительными URL-адресами конечной точки.
1. В разделе **Переменные среды** нажмите кнопку **Добавить**. Для переменной среды задайте **имя** `ASPNETCORE_ENVIRONMENT` и **значение** `Development`.
1. В области **Параметры веб-сервера** в поле **URL-адрес приложения** задайте значение, соответствующее URL-адресу конечной точки в поле **Запуск браузера**.
1. В Visual Studio 2019 и последующих версиях параметру **Модель размещения** задайте значение **По умолчанию**, чтобы использовать модель размещения проекта. Если для проекта задано свойство `<AspNetCoreHostingModel>` в файле проекта, используется значение свойства `InProcess` или `OutOfProcess`. Если свойство не задано, используется модель размещения приложения по умолчанию Out Of Process. Если приложению требуется явно указать модель размещения, отличную от обычной модели размещения приложения, задайте параметру **Модель размещения** значение `In Process` или `Out Of Process` по необходимости.
1. Сохраните профиль.

::: moniker-end

Если Visual Studio не используется, можно вручную добавить профиль запуска в файл [launchSettings.json](https://json.schemastore.org/launchsettings) в папке *Properties*. В следующем примере настраивается профиль для использования протокола HTTPS.

```json
{
  "iisSettings": {
    "windowsAuthentication": false,
    "anonymousAuthentication": true,
    "iis": {
      "applicationUrl": "https://localhost/WebApplication1",
      "sslPort": 0
    }
  },
  "profiles": {
    "IIS": {
      "commandName": "IIS",
      "launchBrowser": true,
      "launchUrl": "https://localhost/WebApplication1",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      }
    }
  }
}
```

Убедитесь, что конечные точки `applicationUrl` и `launchUrl` совпадают и используют тот же протокол (HTTP или HTTPS), что и конфигурация привязки IIS.

## <a name="run-the-project"></a>Запуск проекта

Запустите Visual Studio от имени администратора.

* Убедитесь, что для раскрывающегося списка с конфигурацией сборки построения выбрано значение **Отладка**.
* Настройте кнопку [Начать отладку](/visualstudio/debugger/debugger-feature-tour) на профиль **IIS** и нажмите ее для запуска приложения.

Если вы вошли в Visual Studio без прав администратора, возможно, потребуется перезапуск. Перезапустите Visual Studio при появлении соответствующего запроса.

Если используется сертификат разработки без доверия, возможно, потребуется создать исключение для этого ненадежного сертификата по запросу в браузере.

> [!NOTE]
> Отладка конфигурации сборки выпуска с использованием функции [Только мой код](/visualstudio/debugger/just-my-code) и оптимизации компилятора приводит к ограничению возможностей. Например, точки останова не будут достигнуты.

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Начало работы с диспетчером IIS в IIS](/iis/get-started/getting-started-with-iis/getting-started-with-the-iis-manager-in-iis-7-and-iis-8)
* [Размещение ASP.NET Core в Windows со службами IIS](xref:host-and-deploy/iis/index)
* [Введение в модуль ASP.NET Core](xref:host-and-deploy/aspnet-core-module)
* [Справочник по конфигурации модуля ASP.NET Core](xref:host-and-deploy/aspnet-core-module)
* [Принудительное использование HTTPS](xref:security/enforcing-ssl)
