# <a name="upload-files-sample-app"></a>Пример приложения для отправки файлов

Этот пример приложения демонстрирует концепции, описанные в статье [Передача файлов в ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).

## <a name="security-considerations"></a>Замечания по безопасности

Необходимо соблюдать осторожность при предоставлении пользователям возможности отправки файлов на сервер. Злоумышленники могут выполнять атаки типа [отказ в обслуживании](/windows-hardware/drivers/ifs/denial-of-service), пытаться передать вирусы или вредоносные программы или попытаться атаковать сети и серверы другими способами.

Ниже приведены некоторые действия по обеспечению безопасности, которые снижают вероятность успешных атак.

* Передавайте файлы в выделенную область для отправки файлов в системе, желательно не на системный диск. Использование выделенного расположения упрощает применение мер безопасности к отправленным файлам. Отключите разрешения на выполнение для расположения отправки файла.&dagger;
* Никогда не сохраняйте переданные файлы в дереве каталогов, где находится приложение.&dagger;
* Используйте безопасное имя файла, определяемое приложением. Не используйте имя файла, предоставленное пользователем, или ненадежное имя переданного файла.&dagger;
* Разрешите только определенный набор одобренных расширений файлов.&dagger;
* Проверьте подпись формата файла, чтобы запретить отправку замаскированных файлов (например, передача *EXE*-файла с заменой расширения на *TXT*).&dagger;
* Убедитесь, что на сервере выполняются проверки на стороне клиента. Проверки на стороне клиента можно легко обойти.&dagger;
* Проверяйте размер отправляемых файлов и запретите выполнять отправку файлов большего размера.&dagger;
* Если файлы не должны перезаписываться переданным файлом с тем же именем, перед отправкой файла проверьте его имя в базе данных или физическом хранилище.
* **Запустите сканер для проверки отправляемого содержимого на наличие вирусов и вредоносных программ, прежде чем сохранять файл.**

&dagger;Пример приложения демонстрирует подход, который соответствует критериям.

> [!WARNING]
> Отправка в систему вредоносного кода часто является первым шагом перед выполнением кода, который может:
>
> * полностью захватить управление системой;
> * перезагрузить систему так, что она окажется в неработоспособном состоянии;
> * скомпрометировать пользовательские или системные данные;
> * применить граффити к открытому интерфейсу.
>
> Сведения об уменьшении контактной зоны атаки во время приема файлов от пользователей см. в следующих ресурсах:
>
> * [Неограниченная отправка файлов](https://www.owasp.org/index.php/Unrestricted_File_Upload)
> * [Безопасность в Azure. Убедитесь, что при приеме файлов от пользователей обеспечиваются соответствующие меры безопасности](/azure/security/azure-security-threat-modeling-tool-input-validation#controls-users).

Дополнительные сведения см. в статье [Передача файлов в ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).

## <a name="how-to-use-the-sample"></a>Как использовать этот пример

В файле *appsettings.json*:

1. Задайте путь к сохраненным файлам (`StoredFilesPath`).

   * Пример приложения задает значение `c:\\files`, которое предполагает, что папка с именем *files* расположена в корневом каталоге диска "C:".
   * Путь должен существовать. Создайте папку *files* на диске C: или задайте в качестве пути подходящее расположение.
   * Процессам приложения требуются разрешения на чтение и запись для пути.
   * **ВАЖНО!** Отключите разрешения на выполнение для всех пользователей в пути.

1. Установите максимальный размер файла (`FileSizeLimit`) в байтах. Значение по умолчанию для примера приложения `2097152` (2 097 152 байт) позволяет отправлять файлы размером до 2 МБ.
