# <a name="upload-files-sample-app"></a><span data-ttu-id="81b4a-101">Пример приложения для отправки файлов</span><span class="sxs-lookup"><span data-stu-id="81b4a-101">Upload Files Sample App</span></span>

<span data-ttu-id="81b4a-102">Этот пример приложения демонстрирует концепции, описанные в статье [Передача файлов в ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).</span><span class="sxs-lookup"><span data-stu-id="81b4a-102">This sample app demonstrates concepts described in the [Upload files in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads) topic.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="81b4a-103">Замечания по безопасности</span><span class="sxs-lookup"><span data-stu-id="81b4a-103">Security considerations</span></span>

<span data-ttu-id="81b4a-104">Необходимо соблюдать осторожность при предоставлении пользователям возможности отправки файлов на сервер.</span><span class="sxs-lookup"><span data-stu-id="81b4a-104">Use caution when providing users with the ability to upload files to a server.</span></span> <span data-ttu-id="81b4a-105">Злоумышленники могут выполнять атаки типа [отказ в обслуживании](/windows-hardware/drivers/ifs/denial-of-service), пытаться передать вирусы или вредоносные программы или попытаться атаковать сети и серверы другими способами.</span><span class="sxs-lookup"><span data-stu-id="81b4a-105">Attackers may execute [denial of service](/windows-hardware/drivers/ifs/denial-of-service) attacks, attempt to upload viruses or malware, or attempt to compromise networks and servers in other ways.</span></span>

<span data-ttu-id="81b4a-106">Ниже приведены некоторые действия по обеспечению безопасности, которые снижают вероятность успешных атак.</span><span class="sxs-lookup"><span data-stu-id="81b4a-106">Security steps that reduce the likelihood of a successful attack are:</span></span>

* <span data-ttu-id="81b4a-107">Передавайте файлы в выделенную область для отправки файлов в системе, желательно не на системный диск.</span><span class="sxs-lookup"><span data-stu-id="81b4a-107">Upload files to a dedicated file upload area on the system, preferably to a non-system drive.</span></span> <span data-ttu-id="81b4a-108">Использование выделенного расположения упрощает применение мер безопасности к отправленным файлам.</span><span class="sxs-lookup"><span data-stu-id="81b4a-108">Use of a dedicated location makes it easier to impose security measures on uploaded files.</span></span> <span data-ttu-id="81b4a-109">Отключите разрешения на выполнение для расположения отправки файла.&dagger;</span><span class="sxs-lookup"><span data-stu-id="81b4a-109">Disable execute permissions on the file upload location.&dagger;</span></span>
* <span data-ttu-id="81b4a-110">Никогда не сохраняйте переданные файлы в дереве каталогов, где находится приложение.&dagger;</span><span class="sxs-lookup"><span data-stu-id="81b4a-110">Never persist uploaded files in the same directory tree as the app.&dagger;</span></span>
* <span data-ttu-id="81b4a-111">Используйте безопасное имя файла, определяемое приложением.</span><span class="sxs-lookup"><span data-stu-id="81b4a-111">Use a safe file name determined by the app.</span></span> <span data-ttu-id="81b4a-112">Не используйте имя файла, предоставленное пользователем, или ненадежное имя переданного файла.&dagger;</span><span class="sxs-lookup"><span data-stu-id="81b4a-112">Don't use a file name provided by user input or the untrusted file name of the uploaded file.&dagger;</span></span>
* <span data-ttu-id="81b4a-113">Разрешите только определенный набор одобренных расширений файлов.&dagger;</span><span class="sxs-lookup"><span data-stu-id="81b4a-113">Only allow a specific set of approved file extensions.&dagger;</span></span>
* <span data-ttu-id="81b4a-114">Проверьте подпись формата файла, чтобы запретить отправку замаскированных файлов (например, передача *EXE*-файла с заменой расширения на *TXT*).&dagger;</span><span class="sxs-lookup"><span data-stu-id="81b4a-114">Check the file format signature to prevent a user from uploading a masqueraded file (for example, uploading an *.exe* file with a *.txt* extension).&dagger;</span></span>
* <span data-ttu-id="81b4a-115">Убедитесь, что на сервере выполняются проверки на стороне клиента.</span><span class="sxs-lookup"><span data-stu-id="81b4a-115">Verify that client-side checks are also performed on the server.</span></span> <span data-ttu-id="81b4a-116">Проверки на стороне клиента можно легко обойти.&dagger;</span><span class="sxs-lookup"><span data-stu-id="81b4a-116">Client-side checks are easy to circumvent.&dagger;</span></span>
* <span data-ttu-id="81b4a-117">Проверяйте размер отправляемых файлов и запретите выполнять отправку файлов большего размера.&dagger;</span><span class="sxs-lookup"><span data-stu-id="81b4a-117">Check the size of the upload and prevent uploads that are larger than expected.&dagger;</span></span>
* <span data-ttu-id="81b4a-118">Если файлы не должны перезаписываться переданным файлом с тем же именем, перед отправкой файла проверьте его имя в базе данных или физическом хранилище.</span><span class="sxs-lookup"><span data-stu-id="81b4a-118">When files shouldn't be overwritten by an uploaded file with the same name, check the file name against the database or physical storage before uploading the file.</span></span>
* <span data-ttu-id="81b4a-119">**Запустите сканер для проверки отправляемого содержимого на наличие вирусов и вредоносных программ, прежде чем сохранять файл.**</span><span class="sxs-lookup"><span data-stu-id="81b4a-119">**Run a virus/malware scanner on uploaded content before the file is stored.**</span></span>

<span data-ttu-id="81b4a-120">&dagger;Пример приложения демонстрирует подход, который соответствует критериям.</span><span class="sxs-lookup"><span data-stu-id="81b4a-120">&dagger;The sample app demonstrates an approach that meets the criteria.</span></span>

> [!WARNING]
> <span data-ttu-id="81b4a-121">Отправка в систему вредоносного кода часто является первым шагом перед выполнением кода, который может:</span><span class="sxs-lookup"><span data-stu-id="81b4a-121">Uploading malicious code to a system is frequently the first step to executing code that can:</span></span>
>
> * <span data-ttu-id="81b4a-122">полностью захватить управление системой;</span><span class="sxs-lookup"><span data-stu-id="81b4a-122">Completely takeover a system.</span></span>
> * <span data-ttu-id="81b4a-123">перезагрузить систему так, что она окажется в неработоспособном состоянии;</span><span class="sxs-lookup"><span data-stu-id="81b4a-123">Overload a system with the result that the system crashes.</span></span>
> * <span data-ttu-id="81b4a-124">скомпрометировать пользовательские или системные данные;</span><span class="sxs-lookup"><span data-stu-id="81b4a-124">Compromise user or system data.</span></span>
> * <span data-ttu-id="81b4a-125">применить граффити к открытому интерфейсу.</span><span class="sxs-lookup"><span data-stu-id="81b4a-125">Apply graffiti to a public UI.</span></span>
>
> <span data-ttu-id="81b4a-126">Сведения об уменьшении контактной зоны атаки во время приема файлов от пользователей см. в следующих ресурсах:</span><span class="sxs-lookup"><span data-stu-id="81b4a-126">For information on reducing the attack surface area when accepting files from users, see the following resources:</span></span>
>
> * [<span data-ttu-id="81b4a-127">Неограниченная отправка файлов</span><span class="sxs-lookup"><span data-stu-id="81b4a-127">Unrestricted File Upload</span></span>](https://www.owasp.org/index.php/Unrestricted_File_Upload)
> * <span data-ttu-id="81b4a-128">[Безопасность в Azure. Убедитесь, что при приеме файлов от пользователей обеспечиваются соответствующие меры безопасности](/azure/security/azure-security-threat-modeling-tool-input-validation#controls-users).</span><span class="sxs-lookup"><span data-stu-id="81b4a-128">[Azure Security: Ensure appropriate controls are in place when accepting files from users](/azure/security/azure-security-threat-modeling-tool-input-validation#controls-users)</span></span>

<span data-ttu-id="81b4a-129">Дополнительные сведения см. в статье [Передача файлов в ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).</span><span class="sxs-lookup"><span data-stu-id="81b4a-129">For additional information, see [Upload files in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).</span></span>

## <a name="how-to-use-the-sample"></a><span data-ttu-id="81b4a-130">Как использовать этот пример</span><span class="sxs-lookup"><span data-stu-id="81b4a-130">How to use the sample</span></span>

<span data-ttu-id="81b4a-131">В *файле appsettings.json*:</span><span class="sxs-lookup"><span data-stu-id="81b4a-131">In the *appsettings.json* file:</span></span>

1. <span data-ttu-id="81b4a-132">Задайте путь к сохраненным файлам (`StoredFilesPath`).</span><span class="sxs-lookup"><span data-stu-id="81b4a-132">Set the path for stored files (`StoredFilesPath`).</span></span>

   * <span data-ttu-id="81b4a-133">Пример приложения задает значение `c:\\files`, которое предполагает, что папка с именем *files* расположена в корневом каталоге диска "C:".</span><span class="sxs-lookup"><span data-stu-id="81b4a-133">The sample app sets the value to `c:\\files`, which assumes that a folder named *files* exists at the system's C: drive root.</span></span>
   * <span data-ttu-id="81b4a-134">Путь должен существовать.</span><span class="sxs-lookup"><span data-stu-id="81b4a-134">The path must exist.</span></span> <span data-ttu-id="81b4a-135">Создайте папку *files* на диске C: или задайте в качестве пути подходящее расположение.</span><span class="sxs-lookup"><span data-stu-id="81b4a-135">Create a *files* folder on the system's C: drive or set the path to a suitable location.</span></span>
   * <span data-ttu-id="81b4a-136">Процессам приложения требуются разрешения на чтение и запись для пути.</span><span class="sxs-lookup"><span data-stu-id="81b4a-136">The app's process requires read/write permissions to the path.</span></span>
   * <span data-ttu-id="81b4a-137">**ВАЖНО!**</span><span class="sxs-lookup"><span data-stu-id="81b4a-137">**IMPORTANT!**</span></span> <span data-ttu-id="81b4a-138">Отключите разрешения на выполнение для всех пользователей в пути.</span><span class="sxs-lookup"><span data-stu-id="81b4a-138">Disable execute permissions for all users at the path.</span></span>

1. <span data-ttu-id="81b4a-139">Установите максимальный размер файла (`FileSizeLimit`) в байтах.</span><span class="sxs-lookup"><span data-stu-id="81b4a-139">Set the file size limit (`FileSizeLimit`) in bytes.</span></span> <span data-ttu-id="81b4a-140">Значение по умолчанию для примера приложения `2097152` (2 097 152 байт) позволяет отправлять файлы размером до 2 МБ.</span><span class="sxs-lookup"><span data-stu-id="81b4a-140">The sample app's default value of `2097152` (2,097,152 bytes) permits file uploads up to 2 MB.</span></span>
