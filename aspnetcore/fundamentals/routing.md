---
title: Маршрутизация в ASP.NET Core
author: rick-anderson
description: Узнайте, как маршрутизация ASP.NET Core отвечает за сопоставление URI запросов с селекторами конечных точек и отправку входящих запросов к конечным точкам.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 09/24/2019
uid: fundamentals/routing
ms.openlocfilehash: be4493cc927bd5437a2c9dab00b6a555756195bb
ms.sourcegitcommit: eb2fe5ad2e82fab86ca952463af8d017ba659b25
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/01/2019
ms.locfileid: "73416135"
---
# <a name="routing-in-aspnet-core"></a><span data-ttu-id="b4ae8-103">Маршрутизация в ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="b4ae8-103">Routing in ASP.NET Core</span></span>

<span data-ttu-id="b4ae8-104">Авторы: [Райан Новак](https://github.com/rynowak) (Ryan Nowak), [Стив Смит](https://ardalis.com/) (Steve Smith) и [Рик Андерсон](https://twitter.com/RickAndMSFT) (Rick Anderson)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-104">By [Ryan Nowak](https://github.com/rynowak), [Steve Smith](https://ardalis.com/), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="b4ae8-105">Маршрутизация отвечает за сопоставление URI запросов с конечными точками и отправку входящих запросов к этим конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-105">Routing is responsible for mapping request URIs to endpoints and dispatching incoming requests to those endpoints.</span></span> <span data-ttu-id="b4ae8-106">Маршруты определяются в приложении и настраиваются при его запуске.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-106">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="b4ae8-107">Маршрут может также извлекать значения из содержащегося в запросе URL-адреса, которые затем используются для обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-107">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="b4ae8-108">С помощью сведений о маршрутах из приложения маршрутизация также может формировать URL-адреса, которые сопоставляются с конечными точками.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-108">Using route information from the app, routing is also able to generate URLs that map to endpoints.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b4ae8-109">В этом документе рассматривается низкоуровневая маршрутизация ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-109">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="b4ae8-110">Сведения о маршрутизации ASP.NET Core MVC см. в разделе <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-110">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span> <span data-ttu-id="b4ae8-111">Сведения о соглашениях о маршрутизации в Razor Pages см. в разделе <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-111">For information on routing conventions in Razor Pages, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="b4ae8-112">[Просмотреть или скачать образец кода](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([как скачивать](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="b4ae8-112">[View or download sample code](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="b4ae8-113">Основы маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-113">Routing basics</span></span>

<span data-ttu-id="b4ae8-114">Для большинства приложений следует выбрать базовую описательную схему маршрутизации таким образом, чтобы URL-адреса были удобочитаемыми и осмысленными.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-114">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="b4ae8-115">Традиционный маршрут по умолчанию `{controller=Home}/{action=Index}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-115">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="b4ae8-116">Поддерживает основную и описательную схемы маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-116">Supports a basic and descriptive routing scheme.</span></span>
* <span data-ttu-id="b4ae8-117">Является отправной точкой для приложений на базе пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-117">Is a useful starting point for UI-based apps.</span></span>

<span data-ttu-id="b4ae8-118">Как правило, в зонах приложения с высоким трафиком и в особых случаях (например, конечные точки блога, интернет-магазина) добавляются дополнительные краткие маршруты с использованием [маршрутизации с помощью атрибутов](xref:mvc/controllers/routing#attribute-routing) или выделенные традиционные маршруты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-118">Developers commonly add additional terse routes to high-traffic areas of an app in specialized situations (for example, blog and ecommerce endpoints) using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span>

<span data-ttu-id="b4ae8-119">Веб-интерфейсы API должны использовать маршрутизацию с помощью атрибутов, чтобы моделировать функциональность приложения в качестве набора ресурсов, где операции представлены с помощью команд HTTP.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-119">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="b4ae8-120">Это означает, что многие операции (например, GET, POST) на одном логическом ресурсе будут использовать одинаковый URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-120">This means that many operations (for example, GET, POST) on the same logical resource will use the same URL.</span></span> <span data-ttu-id="b4ae8-121">Маршрутизация с помощью атрибутов обеспечивает необходимый уровень контроля, позволяющий тщательно разработать схему общедоступных конечных точек API-интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-121">Attribute routing provides a level of control that's needed to carefully design an API's public endpoint layout.</span></span>

<span data-ttu-id="b4ae8-122">Приложения Razor Pages используют стандартную маршрутизацию по умолчанию для предоставления именованных ресурсов в папке *Pages* приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-122">Razor Pages apps use default conventional routing to serve named resources in the *Pages* folder of an app.</span></span> <span data-ttu-id="b4ae8-123">Доступны дополнительные соглашения, которые позволяют настроить поведение маршрутизации Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-123">Additional conventions are available that allow you to customize Razor Pages routing behavior.</span></span> <span data-ttu-id="b4ae8-124">Дополнительные сведения см. в разделах <xref:razor-pages/index> и <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-124">For more information, see <xref:razor-pages/index> and <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="b4ae8-125">Благодаря поддержке создания URL-адресов приложение можно разрабатывать без жесткого программирования URL-адресов для связывания компонентов приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-125">URL generation support allows the app to be developed without hard-coding URLs to link the app together.</span></span> <span data-ttu-id="b4ae8-126">Это обеспечивает начало работы с основной конфигурацией маршрутизации и изменение маршрутов после определения схемы ресурсов приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-126">This support allows for starting with a basic routing configuration and modifying the routes after the app's resource layout is determined.</span></span>

<span data-ttu-id="b4ae8-127">Маршрутизация использует *конечные точки* (`Endpoint`) для представления логических конечных точек в приложении.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-127">Routing uses *endpoints* (`Endpoint`) to represent logical endpoints in an app.</span></span>

<span data-ttu-id="b4ae8-128">Конечная точка определяет делегат для обработки запросов и коллекцию произвольных метаданных.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-128">An endpoint defines a delegate to process requests and a collection of arbitrary metadata.</span></span> <span data-ttu-id="b4ae8-129">Метаданные используются для реализации сквозной функциональности на основе политик и конфигурации каждой конечной точки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-129">The metadata is used to implement cross-cutting concerns based on policies and configuration attached to each endpoint.</span></span>

<span data-ttu-id="b4ae8-130">Система маршрутизации обладает следующими характеристиками:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-130">The routing system has the following characteristics:</span></span>

* <span data-ttu-id="b4ae8-131">Синтаксис шаблона маршрута используется для определения маршрутов с помощью параметров размеченного маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-131">Route template syntax is used to define routes with tokenized route parameters.</span></span>
* <span data-ttu-id="b4ae8-132">Допускается конфигурация конечной точки в стандартном стиле и с атрибутами.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-132">Conventional-style and attribute-style endpoint configuration is permitted.</span></span>
* <span data-ttu-id="b4ae8-133"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> используется для определения того, содержит ли параметр URL-адреса допустимое значение для ограничения заданной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-133"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> is used to determine whether a URL parameter contains a valid value for a given endpoint constraint.</span></span>
* <span data-ttu-id="b4ae8-134">Модели приложения, такие как MVC и Razor Pages, регистрируют все свои конечные точки, имеющие предсказуемую реализацию сценариев маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-134">App models, such as MVC/Razor Pages, register all of their endpoints, which have a predictable implementation of routing scenarios.</span></span>
* <span data-ttu-id="b4ae8-135">Реализация маршрутизации принимает решения о маршрутизации в нужном месте конвейера ПО промежуточного слоя.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-135">The routing implementation makes routing decisions wherever desired in the middleware pipeline.</span></span>
* <span data-ttu-id="b4ae8-136">ПО промежуточного слоя, которое появляется после ПО промежуточного слоя маршрутизации, может проверить результат принятия решений о конечной точке, принятое ПО промежуточного слоя маршрутизации для заданного URI запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-136">Middleware that appears after a Routing Middleware can inspect the result of the Routing Middleware's endpoint decision for a given request URI.</span></span>
* <span data-ttu-id="b4ae8-137">Можно перечислить все конечные точки в приложении в любом месте конвейера ПО промежуточного слоя.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-137">It's possible to enumerate all of the endpoints in the app anywhere in the middleware pipeline.</span></span>
* <span data-ttu-id="b4ae8-138">Приложение может использовать маршрутизацию для формирования URL-адресов (например, для перенаправления или ссылок) на основе сведений о конечной точке, что позволяет избежать жесткого задания URL-адресов и упрощает поддержку.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-138">An app can use routing to generate URLs (for example, for redirection or links) based on endpoint information and thus avoid hard-coded URLs, which helps maintainability.</span></span>
* <span data-ttu-id="b4ae8-139">Формирование URL-адреса основано на адресах, которые поддерживают произвольную расширяемость:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-139">URL generation is based on addresses, which support arbitrary extensibility:</span></span>

  * <span data-ttu-id="b4ae8-140">API генератора ссылок (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) может быть разрешено в любом месте с помощью [внедрения зависимостей (DI)](xref:fundamentals/dependency-injection) для формирования URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-140">The Link Generator API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) can be resolved anywhere using [dependency injection (DI)](xref:fundamentals/dependency-injection) to generate URLs.</span></span>
  * <span data-ttu-id="b4ae8-141">Если API генератора ссылок недоступно через внедрение зависимостей, <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> предлагает методы для создания URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-141">Where the Link Generator API isn't available via DI, <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offers methods to build URLs.</span></span>

> [!NOTE]
> <span data-ttu-id="b4ae8-142">Связывание конечных точек ограничено действиями и страницами MVC и Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-142">Endpoint linking is limited to MVC/Razor Pages actions and pages.</span></span> <span data-ttu-id="b4ae8-143">Расширение функций связывания конечных точек планируется в будущих выпусках.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-143">The expansions of endpoint-linking capabilities is planned for future releases.</span></span>

<span data-ttu-id="b4ae8-144">Функция маршрутизации подключается к конвейеру [ПО промежуточного слоя](xref:fundamentals/middleware/index) с помощью класса <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-144">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="b4ae8-145">[ASP.NET Core MVC](xref:mvc/overview) добавляет функцию маршрутизации в конвейер ПО промежуточного слоя в процессе настройки и обрабатывает маршрутизацию в приложениях MVC и Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-145">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration and handles routing in MVC and Razor Pages apps.</span></span> <span data-ttu-id="b4ae8-146">Сведения об использовании маршрутизации в виде отдельного компонента см. в руководстве по [использованию ПО промежуточного слоя маршрутизации](#use-routing-middleware).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-146">To learn how to use routing as a standalone component, see the [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="b4ae8-147">Соответствие URL-адресов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-147">URL matching</span></span>

<span data-ttu-id="b4ae8-148">Сопоставление URL-адресов — это процесс, с помощью которого функция маршрутизации отправляет входящий запрос в *конечную точку*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-148">URL matching is the process by which routing dispatches an incoming request to an *endpoint*.</span></span> <span data-ttu-id="b4ae8-149">Этот процесс основывается на данных в пути URL-адреса, но может быть расширен для учета любых данных в запросе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-149">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="b4ae8-150">Возможность отправки запросов в отдельные обработчики имеет первостепенное значение для масштабирования размера и сложности приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-150">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="b4ae8-151">При выполнении ПО промежуточного слоя маршрутизации оно задает конечную точку (`Endpoint`) и значения маршрута для компонента в <xref:Microsoft.AspNetCore.Http.HttpContext>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-151">When a Routing Middleware executes, it sets an endpoint (`Endpoint`) and route values to a feature on the <xref:Microsoft.AspNetCore.Http.HttpContext>.</span></span> <span data-ttu-id="b4ae8-152">Для текущего запроса:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-152">For the current request:</span></span>

* <span data-ttu-id="b4ae8-153">Вызов к `HttpContext.GetEndpoint` возвращает конечную точку.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-153">Calling `HttpContext.GetEndpoint` gets the endpoint.</span></span>
* <span data-ttu-id="b4ae8-154">`HttpRequest.RouteValues` получает коллекцию значений маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-154">`HttpRequest.RouteValues` gets the collection of route values.</span></span>

<span data-ttu-id="b4ae8-155">ПО промежуточного слоя, которое выполняется после ПО промежуточного слоя маршрутизации, может видеть конечную точку и выполнять действия.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-155">Middleware running after the Routing Middleware can see the endpoint and take action.</span></span> <span data-ttu-id="b4ae8-156">Например, ПО промежуточного слоя авторизации может запросить политику авторизации у коллекции метаданных конечной точки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-156">For example, an Authorization Middleware can interrogate the endpoint's metadata collection for an authorization policy.</span></span> <span data-ttu-id="b4ae8-157">После выполнения всех экземпляров ПО промежуточного слоя в конвейере обработки запросов вызывается делегат выбранной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-157">After all of the middleware in the request processing pipeline is executed, the selected endpoint's delegate is invoked.</span></span>

<span data-ttu-id="b4ae8-158">Система маршрутизации в маршрутизации по конечным точкам принимает все решения об отправке.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-158">The routing system in endpoint routing is responsible for all dispatching decisions.</span></span> <span data-ttu-id="b4ae8-159">Так как ПО промежуточного слоя применяет политики в зависимости от выбранной конечной точки, очень важно, чтобы любое решение, которое может повлиять на отправку или применение политик безопасности, принималось внутри системы маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-159">Since the middleware applies policies based on the selected endpoint, it's important that any decision that can affect dispatching or the application of security policies is made inside the routing system.</span></span>

<span data-ttu-id="b4ae8-160">Когда делегат конечной точки выполняется, свойствам [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) присваиваются значения с учетом уже выполненной на текущий момент обработки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-160">When the endpoint delegate is executed, the properties of [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) are set to appropriate values based on the request processing performed thus far.</span></span>

<span data-ttu-id="b4ae8-161">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) — это словарь *значений маршрута*, полученных из маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-161">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="b4ae8-162">Как правило, эти значения определяются путем разбивки URL-адреса на сегменты и могут использоваться для принятия входных данных пользователя или принятия дальнейших решений об отправке в приложении.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-162">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="b4ae8-163">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) — это контейнер свойств с дополнительными данными, связанными с соответствующим маршрутом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-163">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="b4ae8-164">Свойства <xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> обеспечивают связывание данных состояния с каждым маршрутом, что позволяет приложению принимать решения в зависимости от соответствующего маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-164"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> are provided to support associating state data with each route so that the app can make decisions based on which route matched.</span></span> <span data-ttu-id="b4ae8-165">Эти значения определяются разработчиком и никоим образом **не** влияют на поведение маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-165">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="b4ae8-166">Кроме того, значения, спрятанные в токенах [RouteData.DataToken](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*), могут быть любого типа в отличие от значений [RouteData.Value](xref:Microsoft.AspNetCore.Routing.RouteData.Values), которые должны легко преобразовываться в строки и из строк.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-166">Additionally, values stashed in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) can be of any type, in contrast to [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), which must be convertible to and from strings.</span></span>

<span data-ttu-id="b4ae8-167">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) — это список маршрутов, которые участвовали в успешном сопоставлении с запросом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-167">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="b4ae8-168">Маршруты могут быть вложены друг в друга.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-168">Routes can be nested inside of one another.</span></span> <span data-ttu-id="b4ae8-169">Свойство <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> отражает путь по логическому дереву маршрутов, который привел к совпадению.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-169">The <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="b4ae8-170">Как правило, первый элемент в свойстве <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> — это коллекция маршрутов, используемая для формирования URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-170">Generally, the first item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="b4ae8-171">Последний элемент в свойстве <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> — это соответствующий обработчик маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-171">The last item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route handler that matched.</span></span>

<a name="lg"></a>

### <a name="url-generation-with-linkgenerator"></a><span data-ttu-id="b4ae8-172">Создание URL-адреса с помощью LinkGenerator</span><span class="sxs-lookup"><span data-stu-id="b4ae8-172">URL generation with LinkGenerator</span></span>

<span data-ttu-id="b4ae8-173">Формирование URL-адреса — это процесс создания пути URL-адреса функцией маршрутизации на основе набора значений маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-173">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="b4ae8-174">Он обеспечивает логическое разделение конечных точек и URL-адресов, по которым к ним осуществляется доступ.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-174">This allows for a logical separation between your endpoints and the URLs that access them.</span></span>

<span data-ttu-id="b4ae8-175">Маршрутизация по конечным точкам включает в себя API генератора ссылок (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-175">Endpoint routing includes the Link Generator API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>).</span></span> <span data-ttu-id="b4ae8-176"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> — это отдельная служба, которую можно получить посредством внедрения зависимостей.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-176"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is a singleton service that can be retrieved from DI.</span></span> <span data-ttu-id="b4ae8-177">API можно использовать вне контекста выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-177">The API can be used outside of the context of an executing request.</span></span> <span data-ttu-id="b4ae8-178"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> MVC и сценарии, которые зависят от <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, такие как [вспомогательные функции тегов](xref:mvc/views/tag-helpers/intro), вспомогательные методы HTML и [результаты действий](xref:mvc/controllers/actions), используют генератор ссылок для предоставления возможностей создания ссылок.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-178">MVC's <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> and scenarios that rely on <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, such as [Tag Helpers](xref:mvc/views/tag-helpers/intro), HTML Helpers, and [Action Results](xref:mvc/controllers/actions), use the link generator to provide link generating capabilities.</span></span>

<span data-ttu-id="b4ae8-179">Генератор ссылок использует концепции *адреса* и *схем адресов*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-179">The link generator is backed by the concept of an *address* and *address schemes*.</span></span> <span data-ttu-id="b4ae8-180">Схема адресов — это способ определения конечных точек, которые должны рассматриваться для создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-180">An address scheme is a way of determining the endpoints that should be considered for link generation.</span></span> <span data-ttu-id="b4ae8-181">Например, сценарии с именем маршрута и значениями маршрута, с которыми многие пользователи знакомы по MVC и Razor Pages, реализуются как схема адресов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-181">For example, the route name and route values scenarios many users are familiar with from MVC/Razor Pages are implemented as an address scheme.</span></span>

<span data-ttu-id="b4ae8-182">Генератор ссылок может установить связь с действиями и страницами MVC и Razor Pages с помощью следующих методов расширения:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-182">The link generator can link to MVC/Razor Pages actions and pages via the following extension methods:</span></span>

* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetPathByAction*>
* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetUriByAction*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetPathByPage*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetUriByPage*>

<span data-ttu-id="b4ae8-183">Перегрузка этих методов принимает аргументы, которые включают `HttpContext`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-183">An overload of these methods accepts arguments that include the `HttpContext`.</span></span> <span data-ttu-id="b4ae8-184">Эти методы являются функциональными эквивалентами `Url.Action` и `Url.Page`, но предлагают дополнительную гибкость и параметры.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-184">These methods are functionally equivalent to `Url.Action` and `Url.Page` but offer additional flexibility and options.</span></span>

<span data-ttu-id="b4ae8-185">Методы `GetPath*` наиболее схожи с `Url.Action` и `Url.Page` в том, что создают URI, содержащий абсолютный путь.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-185">The `GetPath*` methods are most similar to `Url.Action` and `Url.Page` in that they generate a URI containing an absolute path.</span></span> <span data-ttu-id="b4ae8-186">Методы `GetUri*` всегда создают абсолютный URI, содержащий схему и узел.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-186">The `GetUri*` methods always generate an absolute URI containing a scheme and host.</span></span> <span data-ttu-id="b4ae8-187">Методы, которые принимают `HttpContext`, создают URI в контексте выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-187">The methods that accept an `HttpContext` generate a URI in the context of the executing request.</span></span> <span data-ttu-id="b4ae8-188">Используются значения окружения маршрута, базовый URL-адрес, схема и узел из выполняющегося запроса, если не указано иное.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-188">The ambient route values, URL base path, scheme, and host from the executing request are used unless overridden.</span></span>

<span data-ttu-id="b4ae8-189"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> вызывается с адресом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-189"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is called with an address.</span></span> <span data-ttu-id="b4ae8-190">Создание URI происходит в два этапа:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-190">Generating a URI occurs in two steps:</span></span>

1. <span data-ttu-id="b4ae8-191">Адрес привязан к списку конечных точек, соответствующих адресу.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-191">An address is bound to a list of endpoints that match the address.</span></span>
1. <span data-ttu-id="b4ae8-192">`RoutePattern` конечной точки вычисляется, пока не будет найден шаблон маршрута, который соответствует предоставленным значениям.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-192">Each endpoint's `RoutePattern` is evaluated until a route pattern that matches the supplied values is found.</span></span> <span data-ttu-id="b4ae8-193">Полученный результат объединяется с другими частями URI, предоставленными генератору ссылок и возвращенными.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-193">The resulting output is combined with the other URI parts supplied to the link generator and returned.</span></span>

<span data-ttu-id="b4ae8-194">Методы, предоставляемые <xref:Microsoft.AspNetCore.Routing.LinkGenerator>, поддерживают стандартные возможности создания ссылки для любого типа адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-194">The methods provided by <xref:Microsoft.AspNetCore.Routing.LinkGenerator> support standard link generation capabilities for any type of address.</span></span> <span data-ttu-id="b4ae8-195">Самый удобный способ использовать генератор ссылки — через методы расширения, которые выполняют операции для определенного типа адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-195">The most convenient way to use the link generator is through extension methods that perform operations for a specific address type.</span></span>

| <span data-ttu-id="b4ae8-196">Метод расширения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-196">Extension Method</span></span> | <span data-ttu-id="b4ae8-197">ОПИСАНИЕ</span><span class="sxs-lookup"><span data-stu-id="b4ae8-197">Description</span></span> |
| ---------------- | ----------- |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*> | <span data-ttu-id="b4ae8-198">Создает URI с абсолютным путем на основе предоставленных значений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-198">Generates a URI with an absolute path based on the provided values.</span></span> |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetUriByAddress*> | <span data-ttu-id="b4ae8-199">Создает абсолютный URI на основе предоставленных значений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-199">Generates an absolute URI based on the provided values.</span></span>             |

> [!WARNING]
> <span data-ttu-id="b4ae8-200">Обратите внимание на следующие последствия вызова методов <xref:Microsoft.AspNetCore.Routing.LinkGenerator>:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-200">Pay attention to the following implications of calling <xref:Microsoft.AspNetCore.Routing.LinkGenerator> methods:</span></span>
>
> * <span data-ttu-id="b4ae8-201">Используйте методы расширения `GetUri*` с осторожностью в конфигурации приложения, которая не проверяет заголовок входящих запросов `Host`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-201">Use `GetUri*` extension methods with caution in an app configuration that doesn't validate the `Host` header of incoming requests.</span></span> <span data-ttu-id="b4ae8-202">Если не проверить заголовок входящих запросов `Host`, входные данные в запросе без доверия могут отправляться обратно клиенту в URI в представлении или странице.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-202">If the `Host` header of incoming requests isn't validated, untrusted request input can be sent back to the client in URIs in a view/page.</span></span> <span data-ttu-id="b4ae8-203">Рекомендуется, чтобы все рабочие приложения настраивали свой сервер на проверку заголовка `Host` относительно известных допустимых значений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-203">We recommend that all production apps configure their server to validate the `Host` header against known valid values.</span></span>
>
> * <span data-ttu-id="b4ae8-204">Используйте <xref:Microsoft.AspNetCore.Routing.LinkGenerator> с осторожностью в ПО промежуточного слоя в сочетании с `Map` или `MapWhen`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-204">Use <xref:Microsoft.AspNetCore.Routing.LinkGenerator> with caution in middleware in combination with `Map` or `MapWhen`.</span></span> <span data-ttu-id="b4ae8-205">`Map*` изменяет базовый путь выполняющегося запроса, что влияет на выходные данные создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-205">`Map*` changes the base path of the executing request, which affects the output of link generation.</span></span> <span data-ttu-id="b4ae8-206">Все API <xref:Microsoft.AspNetCore.Routing.LinkGenerator> разрешают указание базового пути.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-206">All of the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> APIs allow specifying a base path.</span></span> <span data-ttu-id="b4ae8-207">Всегда указывайте пустой базовый путь для отмены влияния `Map*` на создание ссылок.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-207">Always specify an empty base path to undo `Map*`'s affect on link generation.</span></span>

## <a name="endpoint-routing-differences-from-earlier-versions-of-routing"></a><span data-ttu-id="b4ae8-208">Отличия маршрутизации конечных точек от более ранних версий маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-208">Endpoint routing differences from earlier versions of routing</span></span>

<span data-ttu-id="b4ae8-209">Существует несколько различий между маршрутизацией по конечным точкам и более ранними версиями маршрутизации, чем в ASP.NET Core 2.2:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-209">A few differences exist between endpoint routing and versions of routing earlier than in ASP.NET Core 2.2:</span></span>

* <span data-ttu-id="b4ae8-210">Система маршрутизации по конечным точкам не поддерживает расширяемость на основе <xref:Microsoft.AspNetCore.Routing.IRouter>, включая наследование от <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-210">The endpoint routing system doesn't support <xref:Microsoft.AspNetCore.Routing.IRouter>-based extensibility, including inheriting from <xref:Microsoft.AspNetCore.Routing.Route>.</span></span>

* <span data-ttu-id="b4ae8-211">Маршрутизация по конечным точкам не поддерживает [WebApiCompatShim](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.WebApiCompatShim).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-211">Endpoint routing doesn't support [WebApiCompatShim](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.WebApiCompatShim).</span></span> <span data-ttu-id="b4ae8-212">Используйте [совместимую версию](xref:mvc/compatibility-version) 2.1 (`.SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`), чтобы продолжить использование оболочек совместимости.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-212">Use the 2.1 [compatibility version](xref:mvc/compatibility-version) (`.SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`) to continue using the compatibility shim.</span></span>

* <span data-ttu-id="b4ae8-213">Маршрутизация по конечным точкам иначе обрабатывает регистр созданных URI при использовании стандартных маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-213">Endpoint Routing has different behavior for the casing of generated URIs when using conventional routes.</span></span>

  <span data-ttu-id="b4ae8-214">Рассмотрим следующий шаблон маршрута по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-214">Consider the following default route template:</span></span>

  ```csharp
  app.UseMvc(routes =>
  {
      routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
  });
  ```

  <span data-ttu-id="b4ae8-215">Предположим, вы создаете ссылку на действие с помощью следующего маршрута:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-215">Suppose you generate a link to an action using the following route:</span></span>

  ```csharp
  var link = Url.Action("ReadPost", "blog", new { id = 17, });
  ```

  <span data-ttu-id="b4ae8-216">С помощью маршрутизации на основе <xref:Microsoft.AspNetCore.Routing.IRouter> этот код создает URI из `/blog/ReadPost/17`, который учитывает регистр предоставленного значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-216">With <xref:Microsoft.AspNetCore.Routing.IRouter>-based routing, this code generates a URI of `/blog/ReadPost/17`, which respects the casing of the provided route value.</span></span> <span data-ttu-id="b4ae8-217">Маршрутизация по конечным точкам в ASP.NET Core 2.2 или более поздней версии создает `/Blog/ReadPost/17` ("Blog" — с прописной буквы).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-217">Endpoint routing in ASP.NET Core 2.2 or later produces `/Blog/ReadPost/17` ("Blog" is capitalized).</span></span> <span data-ttu-id="b4ae8-218">Маршрутизация по конечным точкам предоставляет интерфейс `IOutboundParameterTransformer`, который можно использовать для настройки этого поведения на глобальном уровне или применения других соглашения для сопоставления URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-218">Endpoint routing provides the `IOutboundParameterTransformer` interface that can be used to customize this behavior globally or to apply different conventions for mapping URLs.</span></span>

  <span data-ttu-id="b4ae8-219">Дополнительные сведения см. в разделе [Справочник по преобразователям параметров](#parameter-transformer-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-219">For more information, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

* <span data-ttu-id="b4ae8-220">Создание ссылок, используемых MVC и Razor Pages со стандартными маршрутами, работает иначе при попытке сослаться на контроллер/действие или страницу, которые не существуют.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-220">Link Generation used by MVC/Razor Pages with conventional routes behaves differently when attempting to link to an controller/action or page that doesn't exist.</span></span>

  <span data-ttu-id="b4ae8-221">Рассмотрим следующий шаблон маршрута по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-221">Consider the following default route template:</span></span>

  ```csharp
  app.UseMvc(routes =>
  {
      routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
  });
  ```

  <span data-ttu-id="b4ae8-222">Предположим, вы создаете ссылку на действие с помощью шаблона по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-222">Suppose you generate a link to an action using the default template with the following:</span></span>

  ```csharp
  var link = Url.Action("ReadPost", "Blog", new { id = 17, });
  ```

  <span data-ttu-id="b4ae8-223">С маршрутизацией на основе `IRouter` результатом всегда будет `/Blog/ReadPost/17`, даже если `BlogController` не существует или не имеет метода действия `ReadPost`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-223">With `IRouter`-based routing, the result is always `/Blog/ReadPost/17`, even if the `BlogController` doesn't exist or doesn't have a `ReadPost` action method.</span></span> <span data-ttu-id="b4ae8-224">Как и ожидалось, маршрутизация по конечным точкам в ASP.NET Core 2.2 или более поздней версии создает `/Blog/ReadPost/17`, если метод действия существует.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-224">As expected, endpoint routing in ASP.NET Core 2.2 or later produces `/Blog/ReadPost/17` if the action method exists.</span></span> <span data-ttu-id="b4ae8-225">*Но маршрутизация по конечным точкам создает пустую строку, если действие не существует.*</span><span class="sxs-lookup"><span data-stu-id="b4ae8-225">*However, endpoint routing produces an empty string if the action doesn't exist.*</span></span> <span data-ttu-id="b4ae8-226">По существу, маршрутизация по конечным точкам не предполагает, что конечная точка существует, если действие не существует.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-226">Conceptually, endpoint routing doesn't assume that the endpoint exists if the action doesn't exist.</span></span>

* <span data-ttu-id="b4ae8-227">*Алгоритм отмены значения окружения* при создании ссылок работает иначе при маршрутизации по конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-227">The link generation *ambient value invalidation algorithm* behaves differently when used with endpoint routing.</span></span>

  <span data-ttu-id="b4ae8-228">*Отмена значения окружения* — это алгоритм, который решает, какие значения маршрута из текущего выполняемого запроса (значения окружения) могут использоваться в операции создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-228">*Ambient value invalidation* is the algorithm that decides which route values from the currently executing request (the ambient values) can be used in link generation operations.</span></span> <span data-ttu-id="b4ae8-229">Стандартная маршрутизация всегда отменяет лишние значения маршрута при привязке к другому действию.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-229">Conventional routing always invalidated extra route values when linking to a different action.</span></span> <span data-ttu-id="b4ae8-230">Маршрутизация с помощью атрибутов работала иначе до выпуска ASP.NET Core 2.2.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-230">Attribute routing didn't have this behavior prior to the release of ASP.NET Core 2.2.</span></span> <span data-ttu-id="b4ae8-231">В более ранних версиях ASP.NET Core ссылки на другое действие, которые используют те же имена параметров маршрута, приводили к ошибкам создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-231">In earlier versions of ASP.NET Core, links to another action that use the same route parameter names resulted in link generation errors.</span></span> <span data-ttu-id="b4ae8-232">В ASP.NET Core 2.2 или более поздней версии обе формы маршрутизации отменяют значения при привязке к другому действию.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-232">In ASP.NET Core 2.2 or later, both forms of routing invalidate values when linking to another action.</span></span>

  <span data-ttu-id="b4ae8-233">Рассмотрим следующий пример в ASP.NET Core 2.1 или более ранней версии.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-233">Consider the following example in ASP.NET Core 2.1 or earlier.</span></span> <span data-ttu-id="b4ae8-234">При привязке к другому действию (или странице) значения маршрута могут использоваться повторно нежелательным образом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-234">When linking to another action (or another page), route values can be reused in undesirable ways.</span></span>

  <span data-ttu-id="b4ae8-235">В */Pages/Store/Product.cshtml*:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-235">In */Pages/Store/Product.cshtml*:</span></span>

  ```cshtml
  @page "{id}"
  @Url.Page("/Login")
  ```

  <span data-ttu-id="b4ae8-236">В */Pages/Login.cshtml*:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-236">In */Pages/Login.cshtml*:</span></span>

  ```cshtml
  @page "{id?}"
  ```

  <span data-ttu-id="b4ae8-237">Если URI — `/Store/Product/18` в ASP.NET Core 2.1 или более ранней версии, ссылка, созданная на странице Store/Info с помощью `@Url.Page("/Login")` — `/Login/18`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-237">If the URI is `/Store/Product/18` in ASP.NET Core 2.1 or earlier, the link generated on the Store/Info page by `@Url.Page("/Login")` is `/Login/18`.</span></span> <span data-ttu-id="b4ae8-238">Значение `id` 18 используется повторно, хотя конечный объект ссылки является совсем другой частью приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-238">The `id` value of 18 is reused, even though the link destination is different part of the app entirely.</span></span> <span data-ttu-id="b4ae8-239">Значение маршрута `id` в контексте страницы `/Login`, вероятно, является значением идентификатора пользователя, а не кодом хранимого продукта.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-239">The `id` route value in the context of the `/Login` page is probably a user ID value, not a store product ID value.</span></span>

  <span data-ttu-id="b4ae8-240">При маршрутизации по конечным точкам в ASP.NET Core 2.2 или более поздней версии результатом является `/Login`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-240">In endpoint routing with ASP.NET Core 2.2 or later, the result is `/Login`.</span></span> <span data-ttu-id="b4ae8-241">Значения окружения не используются повторно, если конечный объект ссылки является другим действием или страницей.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-241">Ambient values aren't reused when the linked destination is a different action or page.</span></span>

* <span data-ttu-id="b4ae8-242">Синтаксис параметра кругового маршрута: символы прямой косой черты не кодируются при использовании синтаксиса универсального параметра с двумя звездочками (`**`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-242">Round-tripping route parameter syntax: Forward slashes aren't encoded when using a double-asterisk (`**`) catch-all parameter syntax.</span></span>

  <span data-ttu-id="b4ae8-243">Во время создания ссылки система маршрутизации кодирует значение, записанное в универсальном параметре с двумя звездочками (`**`) (например, `{**myparametername}`), за исключением прямой косой черты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-243">During link generation, the routing system encodes the value captured in a double-asterisk (`**`) catch-all parameter (for example, `{**myparametername}`) except the forward slashes.</span></span> <span data-ttu-id="b4ae8-244">Универсальный параметр с двумя звездочками поддерживается в маршрутизации на основе `IRouter` в ASP.NET Core 2.2 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-244">The double-asterisk catch-all is supported with `IRouter`-based routing in ASP.NET Core 2.2 or later.</span></span>

  <span data-ttu-id="b4ae8-245">Синтаксис универсального параметра с одной звездочкой в предыдущих версиях ASP.NET Core (`{*myparametername}`) поддерживается, и прямая косая черта кодируется.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-245">The single asterisk catch-all parameter syntax in prior versions of ASP.NET Core (`{*myparametername}`) remains supported, and forward slashes are encoded.</span></span>

  | <span data-ttu-id="b4ae8-246">Маршрут</span><span class="sxs-lookup"><span data-stu-id="b4ae8-246">Route</span></span>              | <span data-ttu-id="b4ae8-247">Ссылка, созданная с помощью</span><span class="sxs-lookup"><span data-stu-id="b4ae8-247">Link generated with</span></span><br>`Url.Action(new { category = "admin/products" })`&hellip; |
  | ------------------ | --------------------------------------------------------------------- |
  | `/search/{*page}`  | <span data-ttu-id="b4ae8-248">`/search/admin%2Fproducts` (прямая косая черта кодируется)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-248">`/search/admin%2Fproducts` (the forward slash is encoded)</span></span>             |
  | `/search/{**page}` | `/search/admin/products`                                              |

### <a name="middleware-example"></a><span data-ttu-id="b4ae8-249">Пример ПО промежуточного слоя</span><span class="sxs-lookup"><span data-stu-id="b4ae8-249">Middleware example</span></span>

<span data-ttu-id="b4ae8-250">В следующем примере ПО промежуточного слоя использует API <xref:Microsoft.AspNetCore.Routing.LinkGenerator>, чтобы создать ссылку на метод действия, который перечисляет хранимые продукты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-250">In the following example, a middleware uses the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API to create link to an action method that lists store products.</span></span> <span data-ttu-id="b4ae8-251">Использование генератора ссылок путем его внедрения в класс и вызова `GenerateLink` доступно для любого класса в приложении.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-251">Using the link generator by injecting it into a class and calling `GenerateLink` is available to any class in an app.</span></span>

```csharp
using Microsoft.AspNetCore.Routing;

public class ProductsLinkMiddleware
{
    private readonly LinkGenerator _linkGenerator;

    public ProductsLinkMiddleware(RequestDelegate next, LinkGenerator linkGenerator)
    {
        _linkGenerator = linkGenerator;
    }

    public async Task InvokeAsync(HttpContext httpContext)
    {
        var url = _linkGenerator.GetPathByAction("ListProducts", "Store");

        httpContext.Response.ContentType = "text/plain";

        await httpContext.Response.WriteAsync($"Go to {url} to see our products.");
    }
}
```

### <a name="create-routes"></a><span data-ttu-id="b4ae8-252">Создание маршрутов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-252">Create routes</span></span>

<span data-ttu-id="b4ae8-253">Большинство приложений создают маршруты, вызывая метод <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> или один из аналогичных методов расширения, определенных в интерфейсе <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-253">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="b4ae8-254">Все методы расширения <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> создают экземпляр <xref:Microsoft.AspNetCore.Routing.Route> и добавляют его в коллекцию маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-254">Any of the <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> extension methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="b4ae8-255"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> не принимает параметр обработчика маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-255"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> doesn't accept a route handler parameter.</span></span> <span data-ttu-id="b4ae8-256"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> только добавляет маршруты, которые обрабатываются <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-256"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="b4ae8-257">Дополнительные сведения о маршрутизации в MVC см. в разделе <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-257">To learn more about routing in MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="b4ae8-258">В следующем коде приводится пример вызова <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*>, используемого в типичном определении маршрута ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-258">The following code example is an example of a <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="b4ae8-259">Этот шаблон соответствует пути URL-адреса и извлекает значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-259">This template matches a URL path and extracts the route values.</span></span> <span data-ttu-id="b4ae8-260">Например, путь `/Products/Details/17` создает следующие значения маршрута: `{ controller = Products, action = Details, id = 17 }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-260">For example, the path `/Products/Details/17` generates the following route values: `{ controller = Products, action = Details, id = 17 }`.</span></span>

<span data-ttu-id="b4ae8-261">Значения маршрута определяются с помощью разделения пути URL-адреса на сегменты и сопоставления каждого сегмента с именем *параметра маршрута* в шаблоне маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-261">Route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="b4ae8-262">Параметры маршрута являются именованными.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-262">Route parameters are named.</span></span> <span data-ttu-id="b4ae8-263">Параметры определяются путем заключения имени параметра в фигурные скобки `{ ... }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-263">The parameters defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="b4ae8-264">Приведенный выше шаблон может также соответствовать пути URL-адреса `/`. В этом случае он предоставляет значения `{ controller = Home, action = Index }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-264">The preceding template could also match the URL path `/` and produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="b4ae8-265">Связано это с тем, что параметры маршрута `{controller}` и `{action}` имеют значения по умолчанию, а параметр маршрута `id` является необязательным.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-265">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="b4ae8-266">Значение по умолчанию для параметра маршрута определяется с помощью знака равенства (`=`), за которым следует значение после имени параметра.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-266">An equals sign (`=`) followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="b4ae8-267">Вопросительный знак (`?`) после имени параметра маршрута определяет параметр как необязательный.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-267">A question mark (`?`) after the route parameter name defines an optional parameter.</span></span>

<span data-ttu-id="b4ae8-268">Параметры маршрута со значением по умолчанию *всегда* предоставляют значения маршрута при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-268">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="b4ae8-269">Необязательные параметры не предоставляют значение маршрута, если нет соответствующего сегмента пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-269">Optional parameters don't produce a route value if there was no corresponding URL path segment.</span></span> <span data-ttu-id="b4ae8-270">Подробное описание сценариев и синтаксиса шаблона маршрута см. в разделе [Справочник по шаблонам маршрутов](#route-template-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-270">See the [Route template reference](#route-template-reference) section for a thorough description of route template scenarios and syntax.</span></span>

<span data-ttu-id="b4ae8-271">В следующем примере в определении параметра маршрута `{id:int}` определяется [ограничение маршрута](#route-constraint-reference) для параметра маршрута `id`:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-271">In the following example, the route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="b4ae8-272">Этот шаблон соответствует такому пути URL-адреса, как `/Products/Details/17`, но не `/Products/Details/Apples`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-272">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="b4ae8-273">Ограничения маршрута реализуют интерфейс <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> и проверяют значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-273">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="b4ae8-274">В этом примере значение маршрута `id` должно иметь возможность преобразования в целое число.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-274">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="b4ae8-275">Более подробное описание ограничений маршрутов, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-275">See [route-constraint-reference](#route-constraint-reference) for an explanation of route constraints provided by the framework.</span></span>

<span data-ttu-id="b4ae8-276">Дополнительные перегрузки <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> принимают значения для параметров `constraints`, `dataTokens` и `defaults`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-276">Additional overloads of <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="b4ae8-277">Типичное применение этих параметров состоит в передаче анонимно типизированного объекта, причем имена свойств анонимного типа соответствуют именам параметров маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-277">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="b4ae8-278">В следующих примерах <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> создаются эквивалентные маршруты:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-278">The following <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="b4ae8-279">Встроенный синтаксис определения ограничений и значений по умолчанию может быть удобнее для простых маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-279">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="b4ae8-280">Однако некоторые сценарии, например токены данных, не поддерживаются встроенным синтаксисом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-280">However, there are scenarios, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="b4ae8-281">В следующем примере показано еще несколько сценариев:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-281">The following example demonstrates a few additional scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{**article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="b4ae8-282">Предыдущий шаблон соответствует такому пути URL-адреса, как `/Blog/All-About-Routing/Introduction`, и извлекает значения `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-282">The preceding template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="b4ae8-283">Значения маршрута по умолчанию для `controller` и `action` предоставляются маршрутом несмотря на то, что в шаблоне нет соответствующих параметров маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-283">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="b4ae8-284">Значения по умолчанию можно указать в шаблоне маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-284">Default values can be specified in the route template.</span></span> <span data-ttu-id="b4ae8-285">Параметр маршрута `article` определяется как *универсальный* с помощью двух звездочек (`**`) перед именем.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-285">The `article` route parameter is defined as a *catch-all* by the appearance of an double asterisk (`**`) before the route parameter name.</span></span> <span data-ttu-id="b4ae8-286">Универсальные параметры маршрута служат для фиксации оставшейся части пути URL-адреса, а также могут соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-286">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="b4ae8-287">В следующем примере добавляются ограничения маршрута и токены данных:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-287">The following example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="b4ae8-288">Предыдущий шаблон будет соответствовать такому пути URL-адреса, как `/en-US/Products/5`, и будет извлекать значения `{ controller = Products, action = Details, id = 5 }` и токены данных `{ locale = en-US }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-288">The preceding template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![Токены в окне "Локальные"](routing/_static/tokens.png)

### <a name="route-class-url-generation"></a><span data-ttu-id="b4ae8-290">Формирование URL-адреса класса маршрута</span><span class="sxs-lookup"><span data-stu-id="b4ae8-290">Route class URL generation</span></span>

<span data-ttu-id="b4ae8-291">Класс <xref:Microsoft.AspNetCore.Routing.Route> может также формировать URL-адрес, объединяя набор значений маршрута с шаблоном маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-291">The <xref:Microsoft.AspNetCore.Routing.Route> class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="b4ae8-292">С логической точки зрения, этот процесс обратен сопоставлению пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-292">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="b4ae8-293">Чтобы лучше понять процесс формирования URL-адреса, представьте себе, какой URL-адрес нужно создать, а затем подумайте, как шаблон маршрута будет сопоставляться с этим URL-адресом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-293">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="b4ae8-294">Какие значения будут получены?</span><span class="sxs-lookup"><span data-stu-id="b4ae8-294">What values would be produced?</span></span> <span data-ttu-id="b4ae8-295">Примерно так производится формирование URL-адреса в классе <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-295">This is the rough equivalent of how URL generation works in the <xref:Microsoft.AspNetCore.Routing.Route> class.</span></span>

<span data-ttu-id="b4ae8-296">В следующем примере используется общий маршрут по умолчанию ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-296">The following example uses a general ASP.NET Core MVC default route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="b4ae8-297">При значениях маршрута `{ controller = Products, action = List }` создается URL-адрес `/Products/List`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-297">With the route values `{ controller = Products, action = List }`, the URL `/Products/List` is generated.</span></span> <span data-ttu-id="b4ae8-298">Значения маршрута заменяются на соответствующие параметры маршрута для образования пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-298">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="b4ae8-299">Так как `id` является необязательным параметром маршрута, URL-адрес успешно создается без значения для `id`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-299">Since `id` is an optional route parameter, the URL is successfully generated without a value for `id`.</span></span>

<span data-ttu-id="b4ae8-300">При значениях маршрута `{ controller = Home, action = Index }` создается URL-адрес `/`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-300">With the route values `{ controller = Home, action = Index }`, the URL `/` is generated.</span></span> <span data-ttu-id="b4ae8-301">Предоставленные значения маршрута соответствуют значениям по умолчанию, поэтому сегменты, соответствующие значениям по умолчанию, можно спокойно опустить.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-301">The provided route values match the default values, and the segments corresponding to the default values are safely omitted.</span></span>

<span data-ttu-id="b4ae8-302">Оба созданных URL-адреса будут совершать круговой путь с таким же определением маршрута (`/Home/Index` и `/`) и предоставлять те же значения маршрута, которые использовались для формирования URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-302">Both URLs generated round-trip with the following route definition (`/Home/Index` and `/`) produce the same route values that were used to generate the URL.</span></span>

> [!NOTE]
> <span data-ttu-id="b4ae8-303">Приложение, использующее платформу ASP.NET Core MVC, должно создавать URL-адреса с помощью объекта <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper>, а не вызывать маршрутизацию напрямую.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-303">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="b4ae8-304">Дополнительные сведения о формировании URL-адресов см. в [справочнике по формированию URL-адресов](#url-generation-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-304">For more information on URL generation, see the [Url generation reference](#url-generation-reference) section.</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="b4ae8-305">Использование ПО промежуточного слоя маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-305">Use Routing Middleware</span></span>

<span data-ttu-id="b4ae8-306">Ссылка на [метапакет Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) в файле проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-306">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

<span data-ttu-id="b4ae8-307">Добавьте маршрутизацию в контейнер службы в файле `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-307">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

<span data-ttu-id="b4ae8-308">Маршруты должны настраиваться в методе `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-308">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="b4ae8-309">В этом примере приложения используются следующие API:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-309">The sample app uses the following APIs:</span></span>

* <xref:Microsoft.AspNetCore.Routing.RouteBuilder>
* <span data-ttu-id="b4ae8-310"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> &ndash; — соответствует только HTTP-запросам GET.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-310"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> &ndash; Matches only HTTP GET requests.</span></span>
* <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>

[!code-csharp[](routing/samples/3.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

<span data-ttu-id="b4ae8-311">В таблице ниже приведены ответы с данными универсальными кодами ресурсов (URI).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-311">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="b4ae8-312">URI</span><span class="sxs-lookup"><span data-stu-id="b4ae8-312">URI</span></span>                    | <span data-ttu-id="b4ae8-313">Ответ</span><span class="sxs-lookup"><span data-stu-id="b4ae8-313">Response</span></span>                                          |
| ---------------------- | ------------------------------------------------- |
| `/package/create/3`    | <span data-ttu-id="b4ae8-314">Hello!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-314">Hello!</span></span> <span data-ttu-id="b4ae8-315">Значения маршрута: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="b4ae8-315">Route values: [operation, create], [id, 3]</span></span> |
| `/package/track/-3`    | <span data-ttu-id="b4ae8-316">Hello!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-316">Hello!</span></span> <span data-ttu-id="b4ae8-317">Значения маршрута: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="b4ae8-317">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/-3/`   | <span data-ttu-id="b4ae8-318">Hello!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-318">Hello!</span></span> <span data-ttu-id="b4ae8-319">Значения маршрута: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="b4ae8-319">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/`      | <span data-ttu-id="b4ae8-320">Запрос не дал результата, нет совпадений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-320">The request falls through, no match.</span></span>              |
| `GET /hello/Joe`       | <span data-ttu-id="b4ae8-321">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-321">Hi, Joe!</span></span>                                          |
| `POST /hello/Joe`      | <span data-ttu-id="b4ae8-322">Запрос не дал результата, совпадение только с HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-322">The request falls through, matches HTTP GET only.</span></span> |
| `GET /hello/Joe/Smith` | <span data-ttu-id="b4ae8-323">Запрос не дал результата, нет совпадений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-323">The request falls through, no match.</span></span>              |

<span data-ttu-id="b4ae8-324">Платформа предоставляет наборов методов расширения для создания маршрутов (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span><span class="sxs-lookup"><span data-stu-id="b4ae8-324">The framework provides a set of extension methods for creating routes (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span></span>

* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareVerb*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>

<span data-ttu-id="b4ae8-325">Методы `Map[Verb]` используют ограничения, чтобы ограничить маршрут к HTTP-команде в имени метода.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-325">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="b4ae8-326">Например, см. класс <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> и тип <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-326">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="b4ae8-327">Справочник по шаблону маршрута</span><span class="sxs-lookup"><span data-stu-id="b4ae8-327">Route template reference</span></span>

<span data-ttu-id="b4ae8-328">Токены в фигурных скобках (`{ ... }`) определяют *параметры маршрута*, которые будут привязаны при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-328">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="b4ae8-329">В сегменте маршрута можно определить несколько параметров маршрута, но они должны разделяться литеральным значением.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-329">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="b4ae8-330">Например, `{controller=Home}{action=Index}` будет недопустимым маршрутом, так как между `{controller}` и `{action}` нет литерального значения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-330">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="b4ae8-331">Эти параметры маршрута должны иметь имена, и для них могут быть определены дополнительные атрибуты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-331">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="b4ae8-332">Весь текст, кроме параметров маршрута (например, `{id}`) и разделителя пути `/`, должен соответствовать тексту в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-332">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="b4ae8-333">Сопоставление текста производится без учета регистра на основе декодированного представления путь URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-333">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="b4ae8-334">Для сопоставления с литеральным разделителем параметров маршрута (`{` или `}`) разделитель следует экранировать путем повтора символа (`{{` или `}}`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-334">To match a literal route parameter delimiter (`{` or `}`), escape the delimiter by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="b4ae8-335">Шаблоны URL-адресов, которые пытаются получить имя файла с необязательным расширением, имеют свои особенности.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-335">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="b4ae8-336">Например, рассмотрим шаблон `files/{filename}.{ext?}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-336">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="b4ae8-337">Когда значения для `filename` и `ext` существуют, заполняются оба значения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-337">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="b4ae8-338">Если в URL-адресе есть только значение для `filename`, маршрут совпадает, так как точка в конце (`.`) является необязательной.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-338">If only a value for `filename` exists in the URL, the route matches because the trailing period (`.`) is  optional.</span></span> <span data-ttu-id="b4ae8-339">Следующие URL-адреса соответствуют этому маршруту:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-339">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="b4ae8-340">Вы можете использовать звездочку (`*`) или две звездочки (`**`) в качестве префикса параметра маршрута для привязки к остальной части URI.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-340">You can use an asterisk (`*`) or double asterisk (`**`) as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="b4ae8-341">Такие параметры называются *универсальными*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-341">These are called a *catch-all* parameters.</span></span> <span data-ttu-id="b4ae8-342">Например, `blog/{**slug}` соответствует любому URI, начинающемуся с сегмента `/blog`, за которым следует любое значение, присваиваемое в качестве значения маршрута `slug`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-342">For example, `blog/{**slug}` matches any URI that starts with `/blog` and has any value following it, which is assigned to the `slug` route value.</span></span> <span data-ttu-id="b4ae8-343">Универсальные параметры также могут соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-343">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="b4ae8-344">Универсальный параметр экранирует соответствующие символы, если маршрут использует для формирования URL-адрес, включая символы разделителей пути (`/`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-344">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="b4ae8-345">Например, маршрут `foo/{*path}` со значениями маршрутов `{ path = "my/path" }` формирует `foo/my%2Fpath`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-345">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="b4ae8-346">Обратите внимание на экранированный знак косой черты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-346">Note the escaped forward slash.</span></span> <span data-ttu-id="b4ae8-347">В качестве символов разделителя кругового пути используйте префикс параметра маршрута `**`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-347">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="b4ae8-348">Маршрут `foo/{**path}` с `{ path = "my/path" }` формирует `foo/my/path`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-348">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

<span data-ttu-id="b4ae8-349">Параметры маршрута могут иметь *значения по умолчанию*. Они указываются после имени параметра и знака равенства (`=`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-349">Route parameters may have *default values* designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="b4ae8-350">Например, `{controller=Home}` определяет `Home` в качестве значения по умолчанию для `controller`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-350">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="b4ae8-351">Значение по умолчанию используется, если для параметра нет значения в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-351">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="b4ae8-352">Параметры маршрута могут быть необязательными (для этого необходимо добавить вопросительный знак (`?`) в конец имени параметра, например `id?`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-352">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="b4ae8-353">Различие между необязательными параметрами и параметрами маршрута по умолчанию в том, что вторые всегда имеют значения &mdash; необязательный параметр имеет значение, только если оно предоставлено URL-адресом запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-353">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value&mdash;an optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="b4ae8-354">Параметры маршрута могут иметь ограничения, которые должны соответствовать значению маршрута из URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-354">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="b4ae8-355">Добавив двоеточие (`:`) и имя ограничения после имени параметра маршрута, можно указать *встроенные ограничения* для параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-355">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="b4ae8-356">Если для ограничения требуются аргументы, они указываются в скобках (`(...)`) после имени ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-356">If the constraint requires arguments, they're enclosed in parentheses (`(...)`) after the constraint name.</span></span> <span data-ttu-id="b4ae8-357">Чтобы указать несколько встроенных ограничений, добавьте еще одно двоеточие (`:`) и имя ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-357">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span>

<span data-ttu-id="b4ae8-358">Имя и аргументы ограничения передаются в службу <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> для создания экземпляра интерфейса <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, который будет использоваться при обработке URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-358">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="b4ae8-359">Например, в шаблоне маршрута `blog/{article:minlength(10)}` определяется ограничение `minlength` с аргументом `10`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-359">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="b4ae8-360">Более подробное описание ограничений маршрутов и список ограничений, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-360">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="b4ae8-361">Параметры маршрута также могут иметь преобразователи параметров, которые преобразуют значение параметра при создании ссылок и сопоставлении действий и страниц с URL-адресами.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-361">Route parameters may also have parameter transformers, which transform a parameter's value when generating links and matching actions and pages to URLs.</span></span> <span data-ttu-id="b4ae8-362">Как и ограничения, преобразователи параметров можно включать в параметр маршрута, добавив двоеточие (`:`) и имя преобразователя после имени параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-362">Like constraints, parameter transformers can be added inline to a route parameter by adding a colon (`:`) and transformer name after the route parameter name.</span></span> <span data-ttu-id="b4ae8-363">Например, шаблон маршрута `blog/{article:slugify}` задает преобразователь `slugify`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-363">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span> <span data-ttu-id="b4ae8-364">Дополнительные сведения о преобразователях параметров см. в разделе [Справочник по преобразователям параметров](#parameter-transformer-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-364">For more information on parameter transformers, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

<span data-ttu-id="b4ae8-365">В приведенной ниже таблице показаны некоторые примеры шаблонов маршрутов и их поведение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-365">The following table demonstrates example route templates and their behavior.</span></span>

| <span data-ttu-id="b4ae8-366">Шаблон маршрута</span><span class="sxs-lookup"><span data-stu-id="b4ae8-366">Route Template</span></span>                           | <span data-ttu-id="b4ae8-367">Пример соответствующего URI</span><span class="sxs-lookup"><span data-stu-id="b4ae8-367">Example Matching URI</span></span>    | <span data-ttu-id="b4ae8-368">URI запроса&hellip;</span><span class="sxs-lookup"><span data-stu-id="b4ae8-368">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="b4ae8-369">Соответствует только одному пути `/hello`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-369">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="b4ae8-370">Соответствует и задает для параметра `Page` значение `Home`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-370">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="b4ae8-371">Соответствует и задает для параметра `Page` значение `Contact`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-371">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="b4ae8-372">Сопоставляется с контроллером `Products` и действием `List`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-372">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="b4ae8-373">Сопоставляется с контроллером `Products` и действием `Details` (`id` имеет значение 123).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-373">Maps to the `Products` controller and  `Details` action (`id` set to 123).</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="b4ae8-374">Сопоставляется с контроллером `Home` и методом `Index` (`id` пропускается).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-374">Maps to the `Home` controller and `Index` method (`id` is ignored).</span></span>        |

<span data-ttu-id="b4ae8-375">Использование шаблона — это, как правило, самый простой подход к маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-375">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="b4ae8-376">Ограничения и значения по умолчанию также могут указываться вне шаблона маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-376">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="b4ae8-377">Чтобы увидеть, как встроенные реализации маршрутизации, такие как <xref:Microsoft.AspNetCore.Routing.Route>, сопоставляются с запросами, включите [ведение журнала](xref:fundamentals/logging/index).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-377">Enable [Logging](xref:fundamentals/logging/index) to see how the built-in routing implementations, such as <xref:Microsoft.AspNetCore.Routing.Route>, match requests.</span></span>

## <a name="reserved-routing-names"></a><span data-ttu-id="b4ae8-378">Зарезервированные имена маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-378">Reserved routing names</span></span>

<span data-ttu-id="b4ae8-379">Следующие ключевые слова являются зарезервированными именами и не могут использоваться как имена маршрутов или параметры:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-379">The following keywords are reserved names and can't be used as route names or parameters:</span></span>

* `action`
* `area`
* `controller`
* `handler`
* `page`

## <a name="route-constraint-reference"></a><span data-ttu-id="b4ae8-380">Справочник по ограничениям маршрутов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-380">Route constraint reference</span></span>

<span data-ttu-id="b4ae8-381">Ограничения маршрута применяются, когда найдено соответствие входящему URL-адресу и путь URL-адреса был разобран на значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-381">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="b4ae8-382">Как правило, ограничения маршрута служат для проверки значения маршрута, связанного посредством шаблона маршрута, и принятия решения касательно того, является ли значение приемлемым (да или нет).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-382">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="b4ae8-383">Некоторые ограничения маршрута используют данные, не относящиеся к значению маршрута, для определения возможности маршрутизации запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-383">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="b4ae8-384">Например, <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> может принимать или отклонять запрос в зависимости от HTTP-команды.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-384">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="b4ae8-385">Ограничения используются в маршрутизации запросов и создании ссылок.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-385">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="b4ae8-386">Не используйте ограничения для **проверки входных данных**.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-386">Don't use constraints for **input validation**.</span></span> <span data-ttu-id="b4ae8-387">Если ограничения используются для **проверки входных данных**, недопустимые входные данные будут вызывать ошибку *404 (не найдено)* вместо ошибки *400 (неверный запрос)* с соответствующим сообщением.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-387">If constraints are used for **input validation**, invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="b4ae8-388">Ограничения маршрутов следует использовать для **разрешения неоднозначности** похожих маршрутов, а не для проверки входных данных определенного маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-388">Route constraints are used to **disambiguate** similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="b4ae8-389">В приведенной ниже таблице показаны примеры ограничения маршрутов и их ожидаемое поведение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-389">The following table demonstrates example route constraints and their expected behavior.</span></span>

| <span data-ttu-id="b4ae8-390">ограничение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-390">constraint</span></span> | <span data-ttu-id="b4ae8-391">Пример</span><span class="sxs-lookup"><span data-stu-id="b4ae8-391">Example</span></span> | <span data-ttu-id="b4ae8-392">Примеры совпадений</span><span class="sxs-lookup"><span data-stu-id="b4ae8-392">Example Matches</span></span> | <span data-ttu-id="b4ae8-393">Примечания</span><span class="sxs-lookup"><span data-stu-id="b4ae8-393">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="b4ae8-394">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-394">`123456789`, `-123456789`</span></span> | <span data-ttu-id="b4ae8-395">Соответствует любому целому числу</span><span class="sxs-lookup"><span data-stu-id="b4ae8-395">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="b4ae8-396">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-396">`true`, `FALSE`</span></span> | <span data-ttu-id="b4ae8-397">Соответствует `true` или `false` (без учета регистра)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-397">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="b4ae8-398">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-398">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="b4ae8-399">Соответствует допустимому значению `DateTime` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-399">Matches a valid `DateTime` value (in the invariant culture - see warning)</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="b4ae8-400">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-400">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="b4ae8-401">Соответствует допустимому значению `decimal` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-401">Matches a valid `decimal` value (in the invariant culture - see warning)</span></span> |
| `double` | `{weight:double}` | <span data-ttu-id="b4ae8-402">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-402">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="b4ae8-403">Соответствует допустимому значению `double` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-403">Matches a valid `double` value (in the invariant culture - see warning)</span></span> |
| `float` | `{weight:float}` | <span data-ttu-id="b4ae8-404">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-404">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="b4ae8-405">Соответствует допустимому значению `float` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-405">Matches a valid `float` value (in the invariant culture - see warning)</span></span> |
| `guid` | `{id:guid}` | <span data-ttu-id="b4ae8-406">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-406">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="b4ae8-407">Соответствует допустимому значению `Guid`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-407">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="b4ae8-408">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-408">`123456789`, `-123456789`</span></span> | <span data-ttu-id="b4ae8-409">Соответствует допустимому значению `long`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-409">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="b4ae8-410">Строка должна содержать не менее 4 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-410">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="b4ae8-411">Строка должна содержать не более 8 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-411">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="b4ae8-412">Длина строки должна составлять ровно 12 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-412">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="b4ae8-413">Строка должна содержать от 8 до 16 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-413">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="b4ae8-414">Целочисленное значение не меньше 18</span><span class="sxs-lookup"><span data-stu-id="b4ae8-414">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="b4ae8-415">Целочисленное значение не больше 120</span><span class="sxs-lookup"><span data-stu-id="b4ae8-415">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="b4ae8-416">Целочисленное значение от 18 до 120</span><span class="sxs-lookup"><span data-stu-id="b4ae8-416">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="b4ae8-417">Строка должна состоять из одной или нескольких букв (`a`-`z`, без учета регистра)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-417">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="b4ae8-418">Строка должна соответствовать регулярному выражению (см. советы по определению регулярного выражения)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-418">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="b4ae8-419">Определяет обязательное наличие значения, не относящегося к параметру, во время формирования URL-адреса</span><span class="sxs-lookup"><span data-stu-id="b4ae8-419">Used to enforce that a non-parameter value is present during URL generation</span></span> |

<span data-ttu-id="b4ae8-420">К одному параметру может применяться несколько разделенных запятой ограничений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-420">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="b4ae8-421">Например, следующее ограничение ограничивает параметр целочисленным значением 1 или больше:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-421">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="b4ae8-422">Ограничения маршрута, которые проверяют URL-адрес и могут быть преобразованы в тип CLR (например, `int` или `DateTime`), всегда используют инвариантные язык и региональные параметры.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-422">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="b4ae8-423">Эти ограничения предполагают, что URL-адрес является нелокализуемым.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-423">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="b4ae8-424">Предоставляемые платформой ограничения маршрутов не изменяют значения, хранящиеся в значениях маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-424">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="b4ae8-425">Все значения маршрута, переданные из URL-адреса, сохраняются как строки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-425">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="b4ae8-426">Например, ограничение `float` пытается преобразовать значение маршрута в число с плавающей запятой, но преобразованное значение служит только для проверки возможности такого преобразования.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-426">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="b4ae8-427">Регулярные выражения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-427">Regular expressions</span></span>

<span data-ttu-id="b4ae8-428">В платформе ASP.NET Core в конструктор регулярных выражений добавляются члены `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-428">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="b4ae8-429">Описание этих членов см. в разделе <xref:System.Text.RegularExpressions.RegexOptions>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-429">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="b4ae8-430">В регулярных выражениях применяются разделители и токены, аналогичные используемым функцией маршрутизации и в языке C#.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-430">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="b4ae8-431">Токены регулярного выражения должны быть экранированы.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-431">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="b4ae8-432">Чтобы использовать регулярное выражение `^\d{3}-\d{2}-\d{4}$` при маршрутизации, выражение должно иметь символы `\` (обратная косая черта), представленные в строке в виде символов `\\` (двойная обратная косая черта) в исходном файле C#, для экранирования escape-символов строки `\` (если не используются [буквальные строковые литералы](/dotnet/csharp/language-reference/keywords/string)).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-432">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in routing, the expression must have the `\` (single backslash) characters provided in the string as `\\` (double backslash) characters in the C# source file in order to escape the `\` string escape character (unless using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string)).</span></span> <span data-ttu-id="b4ae8-433">Чтобы экранировать символы разделения параметров маршрутизации (`{`, `}`, `[`, `]`), используйте их дважды в выражении (`{{`, `}`, `[[`, `]]`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-433">To escape routing parameter delimiter characters (`{`, `}`, `[`, `]`), double the characters in the expression (`{{`, `}`, `[[`, `]]`).</span></span> <span data-ttu-id="b4ae8-434">В следующей таблице показаны регулярные выражения и их экранированные варианты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-434">The following table shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="b4ae8-435">Регулярное выражение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-435">Regular Expression</span></span>    | <span data-ttu-id="b4ae8-436">Экранированное регулярное выражение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-436">Escaped Regular Expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="b4ae8-437">Регулярные выражения, используемые при маршрутизации, часто начинаются с символа карета (`^`) и соответствуют начальной позиции строки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-437">Regular expressions used in routing often start with the caret (`^`) character and match starting position of the string.</span></span> <span data-ttu-id="b4ae8-438">Выражения часто заканчиваются знаком доллара (`$`) и соответствуют концу строки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-438">The expressions often end with the dollar sign (`$`) character and match end of the string.</span></span> <span data-ttu-id="b4ae8-439">Благодаря символам `^` и `$` регулярное выражение сопоставляется со всем значением параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-439">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="b4ae8-440">Если символы `^` и `$` отсутствуют, регулярное выражение сопоставляется с любой подстрокой внутри строки, что обычно нежелательно.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-440">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="b4ae8-441">В следующей таблице представлен ряд примеров и объясняются причины соответствия или несоответствия.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-441">The following table provides examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="b4ae8-442">Выражение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-442">Expression</span></span>   | <span data-ttu-id="b4ae8-443">Строка</span><span class="sxs-lookup"><span data-stu-id="b4ae8-443">String</span></span>    | <span data-ttu-id="b4ae8-444">Соответствие</span><span class="sxs-lookup"><span data-stu-id="b4ae8-444">Match</span></span> | <span data-ttu-id="b4ae8-445">Добавление примечаний</span><span class="sxs-lookup"><span data-stu-id="b4ae8-445">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-446">hello</span><span class="sxs-lookup"><span data-stu-id="b4ae8-446">hello</span></span>     | <span data-ttu-id="b4ae8-447">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-447">Yes</span></span>   | <span data-ttu-id="b4ae8-448">Соответствие подстроки</span><span class="sxs-lookup"><span data-stu-id="b4ae8-448">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-449">123abc456</span><span class="sxs-lookup"><span data-stu-id="b4ae8-449">123abc456</span></span> | <span data-ttu-id="b4ae8-450">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-450">Yes</span></span>   | <span data-ttu-id="b4ae8-451">Соответствие подстроки</span><span class="sxs-lookup"><span data-stu-id="b4ae8-451">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-452">mz</span><span class="sxs-lookup"><span data-stu-id="b4ae8-452">mz</span></span>        | <span data-ttu-id="b4ae8-453">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-453">Yes</span></span>   | <span data-ttu-id="b4ae8-454">Соответствует выражению</span><span class="sxs-lookup"><span data-stu-id="b4ae8-454">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-455">MZ</span><span class="sxs-lookup"><span data-stu-id="b4ae8-455">MZ</span></span>        | <span data-ttu-id="b4ae8-456">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-456">Yes</span></span>   | <span data-ttu-id="b4ae8-457">Без учета регистра</span><span class="sxs-lookup"><span data-stu-id="b4ae8-457">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="b4ae8-458">hello</span><span class="sxs-lookup"><span data-stu-id="b4ae8-458">hello</span></span>     | <span data-ttu-id="b4ae8-459">Нет</span><span class="sxs-lookup"><span data-stu-id="b4ae8-459">No</span></span>    | <span data-ttu-id="b4ae8-460">См. замечания, касающиеся символов `^` и `$`, выше</span><span class="sxs-lookup"><span data-stu-id="b4ae8-460">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="b4ae8-461">123abc456</span><span class="sxs-lookup"><span data-stu-id="b4ae8-461">123abc456</span></span> | <span data-ttu-id="b4ae8-462">Нет</span><span class="sxs-lookup"><span data-stu-id="b4ae8-462">No</span></span>    | <span data-ttu-id="b4ae8-463">См. замечания, касающиеся символов `^` и `$`, выше</span><span class="sxs-lookup"><span data-stu-id="b4ae8-463">See `^` and `$` above</span></span> |

<span data-ttu-id="b4ae8-464">Дополнительные сведения о синтаксисе регулярных выражений см. в статье [Регулярные выражения в .NET Framework](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-464">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="b4ae8-465">Чтобы ограничить возможные значения параметра набором известных значений, используйте регулярное выражение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-465">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="b4ae8-466">Например, при использовании выражения `{action:regex(^(list|get|create)$)}` значение маршрута `action` будет соответствовать только `list`, `get` или `create`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-466">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="b4ae8-467">При передаче в словарь ограничений строка `^(list|get|create)$` будет эквивалентной.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-467">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="b4ae8-468">Ограничения, которые передаются в словарь ограничений (то есть не являются встроенными ограничениями шаблона) и не соответствуют одному из известных ограничений, также рассматриваются как регулярные выражения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-468">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="custom-route-constraints"></a><span data-ttu-id="b4ae8-469">Пользовательские ограничения маршрутов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-469">Custom Route Constraints</span></span>

<span data-ttu-id="b4ae8-470">Помимо встроенных ограничений маршрутов пользовательские ограничения маршрутов можно создать путем внедрения интерфейса <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-470">In addition to the built-in route constraints, custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="b4ae8-471">Интерфейс <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> содержит один метод, `Match`, который возвращает `true`, если ограничение удовлетворяется, и `false` — если нет.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-471">The <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface contains a single method, `Match`, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="b4ae8-472">Чтобы применить пользовательский метод <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, тип ограничения маршрута необходимо зарегистрировать с помощью <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> приложения в контейнере службы приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-472">To use a custom <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the app's service container.</span></span> <span data-ttu-id="b4ae8-473">Объект <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> — это словарь, который сопоставляет ключи ограничений пути с реализациями <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, которые проверяют эти ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-473">A <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> is a dictionary that maps route constraint keys to <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> implementations that validate those constraints.</span></span> <span data-ttu-id="b4ae8-474"><xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> приложения можно преобразовать в `Startup.ConfigureServices` как часть вызова [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) или путем настройки <xref:Microsoft.AspNetCore.Routing.RouteOptions> непосредственно с помощью `services.Configure<RouteOptions>`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-474">An app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="b4ae8-475">Например:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-475">For example:</span></span>

```csharp
services.AddRouting(options =>
{
    options.ConstraintMap.Add("customName", typeof(MyCustomConstraint));
});
```

<span data-ttu-id="b4ae8-476">Ограничения могут применяться к маршрутам обычным способом с использованием имени, указанного при регистрации типа ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-476">The constraint can then be applied to routes in the usual manner, using the name specified when registering the constraint type.</span></span> <span data-ttu-id="b4ae8-477">Например:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-477">For example:</span></span>

```csharp
[HttpGet("{id:customName}")]
public ActionResult<string> Get(string id)
```

## <a name="parameter-transformer-reference"></a><span data-ttu-id="b4ae8-478">Справочник по преобразователям параметров</span><span class="sxs-lookup"><span data-stu-id="b4ae8-478">Parameter transformer reference</span></span>

<span data-ttu-id="b4ae8-479">Преобразователи параметров:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-479">Parameter transformers:</span></span>

* <span data-ttu-id="b4ae8-480">Выполняются при формировании ссылки для <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-480">Execute when generating a link for a <xref:Microsoft.AspNetCore.Routing.Route>.</span></span>
* <span data-ttu-id="b4ae8-481">Реализуйте расширение `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-481">Implement `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span></span>
* <span data-ttu-id="b4ae8-482">Настраиваются с помощью <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-482">Are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>
* <span data-ttu-id="b4ae8-483">Принимают значение маршрута параметра и изменяют его на новое строковое значение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-483">Take the parameter's route value and transform it to a new string value.</span></span>
* <span data-ttu-id="b4ae8-484">Приводят к использованию преобразованного значения в сформированной ссылке.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-484">Result in using the transformed value in the generated link.</span></span>

<span data-ttu-id="b4ae8-485">Например, пользовательский преобразователь параметра `slugify` в шаблоне маршрута `blog\{article:slugify}` с `Url.Action(new { article = "MyTestArticle" })` формирует значение `blog\my-test-article`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-485">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span>

<span data-ttu-id="b4ae8-486">Чтобы использовать преобразователь параметров в шаблоне маршрута, сначала настройте его с помощью <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> в `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-486">To use a parameter transformer in a route pattern, configure it first using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddRouting(options =>
{
    // Replace the type and the name used to refer to it with your own
    // IOutboundParameterTransformer implementation
    options.ConstraintMap["slugify"] = typeof(SlugifyParameterTransformer);
});
```

<span data-ttu-id="b4ae8-487">Преобразователи параметров также используются платформами для преобразования URI, где разрешается конечная точка.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-487">Parameter transformers are used by the framework to transform the URI where an endpoint resolves.</span></span> <span data-ttu-id="b4ae8-488">Например, ASP.NET Core MVC с помощью преобразователей параметров преобразует значение маршрута, используемое для сопоставления `area`, `controller`, `action` и `page`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-488">For example, ASP.NET Core MVC uses parameter transformers to transform the route value used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller:slugify=Home}/{action:slugify=Index}/{id?}");
```

<span data-ttu-id="b4ae8-489">С помощью предыдущего маршрута действие `SubscriptionManagementController.GetAll()` сопоставляется с URI `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-489">With the preceding route, the action `SubscriptionManagementController.GetAll()` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="b4ae8-490">Преобразователь параметра не изменяет значения маршрута, используемые для формирования ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-490">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="b4ae8-491">Например, `Url.Action("GetAll", "SubscriptionManagement")` выводит `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-491">For example, `Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="b4ae8-492">ASP.NET Core предоставляет соглашения об API для использования преобразователей параметров со сформированными маршрутами:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-492">ASP.NET Core provides API conventions for using a parameter transformers with generated routes:</span></span>

* <span data-ttu-id="b4ae8-493">ASP.NET Core MVC поддерживает соглашение об API `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-493">ASP.NET Core MVC has the `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API convention.</span></span> <span data-ttu-id="b4ae8-494">Это соглашение применяет указанный преобразователь параметров ко всем маршрутам атрибутов в приложении.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-494">This convention applies a specified parameter transformer to all attribute routes in the app.</span></span> <span data-ttu-id="b4ae8-495">Преобразователь параметров преобразует маркеры маршрутов атрибутов по мере их замены.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-495">The parameter transformer transforms attribute route tokens as they are replaced.</span></span> <span data-ttu-id="b4ae8-496">Дополнительные сведения см. в разделе об [использовании преобразователя параметров для настройки замены маркеров](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-496">For more information, see [Use a parameter transformer to customize token replacement](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span></span>
* <span data-ttu-id="b4ae8-497">Razor Pages поддерживает соглашение об API `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-497">Razor Pages has the `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention` API convention.</span></span> <span data-ttu-id="b4ae8-498">Это соглашение применяет указанный преобразователь параметров ко всем автоматически обнаруженным страницам Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-498">This convention applies a specified parameter transformer to all automatically discovered Razor Pages.</span></span> <span data-ttu-id="b4ae8-499">Преобразователь параметров преобразует сегменты папок и имен файлов маршрутов Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-499">The parameter transformer transforms the folder and file name segments of Razor Pages routes.</span></span> <span data-ttu-id="b4ae8-500">Дополнительные сведения см. в разделе об [использовании преобразователя параметров для настройки маршрутов страниц](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-500">For more information, see [Use a parameter transformer to customize page routes](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span></span>

## <a name="url-generation-reference"></a><span data-ttu-id="b4ae8-501">Справочник по формированию URL-адресов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-501">URL generation reference</span></span>

<span data-ttu-id="b4ae8-502">В приведенном ниже примере показано, как создать ссылку на маршрут с использованием словаря значений маршрута и коллекции <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-502">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

<span data-ttu-id="b4ae8-503">В результате приведенного выше примера создается <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> со значением `/package/create/123`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-503">The <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="b4ae8-504">Словарь предоставляет значения маршрута `operation` и `id` шаблона "Отслеживание маршрута пакета", `package/{operation}/{id}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-504">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="b4ae8-505">Дополнительные сведения см. в примере кода в разделе [Использование ПО промежуточного слоя маршрутизации](#use-routing-middleware) или в [примере приложения](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-505">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="b4ae8-506">Второй параметр конструктора <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> — это коллекция *значений окружения*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-506">The second parameter to the <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="b4ae8-507">Значения окружения упрощают разработку, ограничивая число значений, которые необходимо указывать в определенном контексте запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-507">Ambient values are convenient to use because they limit the number of values a developer must specify within a request context.</span></span> <span data-ttu-id="b4ae8-508">Текущие значения маршрута текущего запроса считаются значениями окружения для создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-508">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="b4ae8-509">В приложении ASP.NET MVC в действии `About` контроллера `HomeController` не нужно задавать значение маршрута контроллера, указывающее на действие `Index` &mdash; используется значение окружения `Home`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-509">In an ASP.NET Core MVC app's `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="b4ae8-510">Значения окружения, которые не соответствуют параметру, игнорируются.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-510">Ambient values that don't match a parameter are ignored.</span></span> <span data-ttu-id="b4ae8-511">Значения окружения также не учитываются, когда явно указанное значение переопределяет значение окружения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-511">Ambient values are also ignored when an explicitly provided value overrides the ambient value.</span></span> <span data-ttu-id="b4ae8-512">Сопоставление выполняется слева направо в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-512">Matching occurs from left to right in the URL.</span></span>

<span data-ttu-id="b4ae8-513">Явно предоставленные значения, которые не соответствуют сегменту маршрута, добавляются в строку запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-513">Values explicitly provided but that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="b4ae8-514">В приведенной ниже таблице показан результат использования шаблона маршрута `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-514">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="b4ae8-515">Значения окружения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-515">Ambient Values</span></span>                     | <span data-ttu-id="b4ae8-516">Явные значения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-516">Explicit Values</span></span>                        | <span data-ttu-id="b4ae8-517">Результат</span><span class="sxs-lookup"><span data-stu-id="b4ae8-517">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="b4ae8-518">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-518">controller = "Home"</span></span>                | <span data-ttu-id="b4ae8-519">action = "About"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-519">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="b4ae8-520">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-520">controller = "Home"</span></span>                | <span data-ttu-id="b4ae8-521">controller = "Order", action = "About"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-521">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="b4ae8-522">controller = "Home", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-522">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="b4ae8-523">action = "About"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-523">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="b4ae8-524">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-524">controller = "Home"</span></span>                | <span data-ttu-id="b4ae8-525">action = "About", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-525">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="b4ae8-526">Если маршрут имеет значение по умолчанию, которое не соответствует параметру, и это значение предоставлено явным образом, оно должно соответствовать значению по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-526">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="b4ae8-527">Для этого маршрута ссылка будет создана только в том случае, если предоставлены соответствующие значения для `controller` и `action`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-527">Link generation only generates a link for this route when the matching values for `controller` and `action` are provided.</span></span>

## <a name="complex-segments"></a><span data-ttu-id="b4ae8-528">Сложные сегменты</span><span class="sxs-lookup"><span data-stu-id="b4ae8-528">Complex segments</span></span>

<span data-ttu-id="b4ae8-529">Сложные сегменты (например, `[Route("/x{token}y")]`) обрабатываются путем "нежадного" сопоставления литералов справа налево.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-529">Complex segments (for example `[Route("/x{token}y")]`) are processed by matching up literals from right to left in a non-greedy way.</span></span> <span data-ttu-id="b4ae8-530">Подробные сведения о сопоставлении сложных сегментов см. в [этом коде](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-530">See [this code](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) for a detailed explanation of how complex segments are matched.</span></span> <span data-ttu-id="b4ae8-531">[Пример кода](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) не используется в ASP.NET Core, но он предоставляет подробное объяснение сложных сегментов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-531">The [code sample](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) is not used by ASP.NET Core, but it provides a good explanation of complex segments.</span></span>
<!-- While that code is no longer used by ASP.NET Core for complex segment matching, it provides a good match to the current algorithm. The [current code](https://github.com/aspnet/AspNetCore/blob/91514c9af7e0f4c44029b51f05a01c6fe4c96e4c/src/Http/Routing/src/Matching/DfaMatcherBuilder.cs#L227-L244) is too abstracted from matching to be useful for understanding complex segment matching.
-->

## <a name="configuring-endpoint-metadata"></a><span data-ttu-id="b4ae8-532">Настройка метаданных конечной точки</span><span class="sxs-lookup"><span data-stu-id="b4ae8-532">Configuring endpoint metadata</span></span>

<span data-ttu-id="b4ae8-533">Сведения о настройке метаданных конечной точки см. на следующих веб-страницах:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-533">The following links provide information on configuring endpoint metadata:</span></span>

* [<span data-ttu-id="b4ae8-534">Включение CORS с маршрутизацией конечных точек</span><span class="sxs-lookup"><span data-stu-id="b4ae8-534">Enable Cors with endpoint routing</span></span>](xref:security/cors#enable-cors-with-endpoint-routing)
* <span data-ttu-id="b4ae8-535">[Пример IAuthorizationPolicyProvider](https://github.com/aspnet/AspNetCore/tree/release/3.0/src/Security/samples/CustomPolicyProvider) с использованием настраиваемого атрибута `[MinimumAgeAuthorize]`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-535">[IAuthorizationPolicyProvider sample](https://github.com/aspnet/AspNetCore/tree/release/3.0/src/Security/samples/CustomPolicyProvider) using a custom `[MinimumAgeAuthorize]` attribute</span></span>
* <span data-ttu-id="b4ae8-536">[Тестирование проверки подлинности с использованием атрибута [Authorize]](xref:security/authentication/identity#test-identity)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-536">[Test authentication with the [Authorize] attribute](xref:security/authentication/identity#test-identity)</span></span>
* <xref:Microsoft.AspNetCore.Builder.AuthorizationEndpointConventionBuilderExtensions.RequireAuthorization*>
* <span data-ttu-id="b4ae8-537">[Выбор схемы с использованием атрибута [Authorize]](xref:security/authorization/limitingidentitybyscheme#selecting-the-scheme-with-the-authorize-attribute)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-537">[Selecting the scheme with the [Authorize] attribute](xref:security/authorization/limitingidentitybyscheme#selecting-the-scheme-with-the-authorize-attribute)</span></span>
* <span data-ttu-id="b4ae8-538">[применение политик с использованием атрибута [Authorize]](xref:security/authorization/policies#applying-policies-to-mvc-controllers)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-538">[Applying policies using the [Authorize] attribute](xref:security/authorization/policies#applying-policies-to-mvc-controllers)</span></span>
* <xref:security/authorization/roles>

<a name="hostmatch"></a>

## <a name="host-matching-in-routes-with-requirehost"></a><span data-ttu-id="b4ae8-539">Сопоставление узлов в маршрутах с помощью RequireHost</span><span class="sxs-lookup"><span data-stu-id="b4ae8-539">Host matching in routes with RequireHost</span></span>

<span data-ttu-id="b4ae8-540">`RequireHost` применяет к ограничение маршруту, которому требуется указанный узел.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-540">`RequireHost` applies a constraint to the route which requires the specified host.</span></span> <span data-ttu-id="b4ae8-541">Параметр `RequireHost` или `[Host]` может иметь следующее значение:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-541">The `RequireHost` or `[Host]` parameter can be:</span></span>

* <span data-ttu-id="b4ae8-542">Узел: `www.domain.com` (соответствует `www.domain.com` с любым портом)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-542">Host: `www.domain.com` (matches `www.domain.com` with any port)</span></span>
* <span data-ttu-id="b4ae8-543">Узел с подстановочным знаком: `*.domain.com` (соответствует `www.domain.com`, `subdomain.domain.com` или `www.subdomain.domain.com` для любого порта)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-543">Host with wildcard: `*.domain.com` (matches `www.domain.com`, `subdomain.domain.com`, or `www.subdomain.domain.com` on any port)</span></span>
* <span data-ttu-id="b4ae8-544">Порт: `*:5000` (соответствует порту 5000 с любым узлом)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-544">Port: `*:5000` (matches port 5000 with any host)</span></span>
* <span data-ttu-id="b4ae8-545">Узел и порт: `www.domain.com:5000`, `*.domain.com:5000` (соответствует узлу и порту)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-545">Host and port: `www.domain.com:5000`, `*.domain.com:5000` (matches host and port)</span></span>

<span data-ttu-id="b4ae8-546">С помощью `RequireHost` или `[Host]` можно указать несколько параметров.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-546">Multiple parameters can be specified using `RequireHost` or `[Host]`.</span></span> <span data-ttu-id="b4ae8-547">Ограничение будет соответствовать узлам, допустимым для любого из параметров.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-547">The constraint will match hosts valid for any of the parameters.</span></span> <span data-ttu-id="b4ae8-548">Например, `[Host("domain.com", "*.domain.com")]` будет соответствовать `domain.com`, `www.domain.com` или `subdomain.domain.com`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-548">For example, `[Host("domain.com", "*.domain.com")]` will match `domain.com`, `www.domain.com`, or `subdomain.domain.com`.</span></span>

<span data-ttu-id="b4ae8-549">Следующий код использует `RequireHost`, чтобы запрашивать указанный узел в маршруте:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-549">The following code uses `RequireHost` to require the specified host on the route:</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    app.UseRouting();

    app.UseEndpoints(endpoints =>
    {
        endpoints.MapGet("/", context => context.Response.WriteAsync("Hi Contoso!"))
            .RequireHost("contoso.com");
        endpoints.MapGet("/", context => context.Response.WriteAsync("Hi AdventureWorks!"))
            .RequireHost("adventure-works.com");
        endpoints.MapHealthChecks("/healthz").RequireHost("*:8080");
    });
}
```

<span data-ttu-id="b4ae8-550">Следующий код использует атрибут `[Host]`, чтобы запрашивать указанный узел в контроллере:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-550">The following code uses the `[Host]` attribute to require the specified host on the controller:</span></span>

```csharp
[Host("contoso.com", "adventure-works.com")]
public class HomeController : Controller
{
    private readonly ILogger<HomeController> _logger;

    public HomeController(ILogger<HomeController> logger)
    {
        _logger = logger;
    }

    public IActionResult Index()
    {
        return View();
    }

    [Host("example.com:8080")]
    public IActionResult Privacy()
    {
        return View();
    }

}
```

<span data-ttu-id="b4ae8-551">Если атрибут `[Host]` применяется как к контроллеру, так и к методу действия, выполняется следующее.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-551">When the `[Host]` attribute is applied to both the controller and action method:</span></span>

* <span data-ttu-id="b4ae8-552">Используется атрибут действия.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-552">The attribute on the action is used.</span></span>
* <span data-ttu-id="b4ae8-553">Атрибут контроллера не учитывается.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-553">The controller attribute is ignored.</span></span>

::: moniker-end

::: moniker range="= aspnetcore-2.2"

<span data-ttu-id="b4ae8-554">Маршрутизация отвечает за сопоставление URI запросов с конечными точками и отправку входящих запросов к этим конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-554">Routing is responsible for mapping request URIs to endpoints and dispatching incoming requests to those endpoints.</span></span> <span data-ttu-id="b4ae8-555">Маршруты определяются в приложении и настраиваются при его запуске.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-555">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="b4ae8-556">Маршрут может также извлекать значения из содержащегося в запросе URL-адреса, которые затем используются для обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-556">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="b4ae8-557">С помощью сведений о маршрутах из приложения маршрутизация также может формировать URL-адреса, которые сопоставляются с конечными точками.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-557">Using route information from the app, routing is also able to generate URLs that map to endpoints.</span></span>

<span data-ttu-id="b4ae8-558">Чтобы использовать новейшие сценарии маршрутизации в ASP.NET Core 2.2, укажите [совместимую версию](xref:mvc/compatibility-version) для регистрации служб MVC в `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-558">To use the latest routing scenarios in ASP.NET Core 2.2, specify the [compatibility version](xref:mvc/compatibility-version) to the MVC services registration in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc()
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_2);
```

<span data-ttu-id="b4ae8-559">Параметр <xref:Microsoft.AspNetCore.Mvc.MvcOptions.EnableEndpointRouting> определяет, должна ли маршрутизация внутренне использовать логику, основанную на конечных точках, или логику, основанную на <xref:Microsoft.AspNetCore.Routing.IRouter>, в ASP.NET Core 2.1 или более ранней версии.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-559">The <xref:Microsoft.AspNetCore.Mvc.MvcOptions.EnableEndpointRouting> option determines if routing should internally use endpoint-based logic or the <xref:Microsoft.AspNetCore.Routing.IRouter>-based logic of ASP.NET Core 2.1 or earlier.</span></span> <span data-ttu-id="b4ae8-560">Если установлена совместимая версия 2.2 или более поздняя, значение по умолчанию — `true`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-560">When the compatibility version is set to 2.2 or later, the default value is `true`.</span></span> <span data-ttu-id="b4ae8-561">Задайте значение `false`, чтобы использовать предыдущую логику маршрутизации:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-561">Set the value to `false` to use the prior routing logic:</span></span>

```csharp
// Use the routing logic of ASP.NET Core 2.1 or earlier:
services.AddMvc(options => options.EnableEndpointRouting = false)
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_2);
```

<span data-ttu-id="b4ae8-562">Дополнительные сведения о маршрутизации на основе <xref:Microsoft.AspNetCore.Routing.IRouter> см. в разделе [о версии ASP.NET Core 2.1 в этой статье](/aspnet/core/fundamentals/routing?view=aspnetcore-2.1).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-562">For more information on <xref:Microsoft.AspNetCore.Routing.IRouter>-based routing, see the [ASP.NET Core 2.1 version of this topic](/aspnet/core/fundamentals/routing?view=aspnetcore-2.1).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="b4ae8-563">В этом документе рассматривается низкоуровневая маршрутизация ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-563">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="b4ae8-564">Сведения о маршрутизации ASP.NET Core MVC см. в разделе <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-564">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span> <span data-ttu-id="b4ae8-565">Сведения о соглашениях о маршрутизации в Razor Pages см. в разделе <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-565">For information on routing conventions in Razor Pages, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="b4ae8-566">[Просмотреть или скачать образец кода](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([как скачивать](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="b4ae8-566">[View or download sample code](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="b4ae8-567">Основы маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-567">Routing basics</span></span>

<span data-ttu-id="b4ae8-568">Для большинства приложений следует выбрать базовую описательную схему маршрутизации таким образом, чтобы URL-адреса были удобочитаемыми и осмысленными.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-568">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="b4ae8-569">Традиционный маршрут по умолчанию `{controller=Home}/{action=Index}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-569">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="b4ae8-570">Поддерживает основную и описательную схемы маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-570">Supports a basic and descriptive routing scheme.</span></span>
* <span data-ttu-id="b4ae8-571">Является отправной точкой для приложений на базе пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-571">Is a useful starting point for UI-based apps.</span></span>

<span data-ttu-id="b4ae8-572">Как правило, в зонах приложения с высоким трафиком и в особых случаях (например, конечные точки блога, интернет-магазина) добавляются дополнительные краткие маршруты с использованием [маршрутизации с помощью атрибутов](xref:mvc/controllers/routing#attribute-routing) или выделенные традиционные маршруты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-572">Developers commonly add additional terse routes to high-traffic areas of an app in specialized situations (for example, blog and ecommerce endpoints) using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span>

<span data-ttu-id="b4ae8-573">Веб-интерфейсы API должны использовать маршрутизацию с помощью атрибутов, чтобы моделировать функциональность приложения в качестве набора ресурсов, где операции представлены с помощью команд HTTP.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-573">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="b4ae8-574">Это означает, что многие операции (например, GET, POST) на одном логическом ресурсе будут использовать одинаковый URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-574">This means that many operations (for example, GET, POST) on the same logical resource will use the same URL.</span></span> <span data-ttu-id="b4ae8-575">Маршрутизация с помощью атрибутов обеспечивает необходимый уровень контроля, позволяющий тщательно разработать схему общедоступных конечных точек API-интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-575">Attribute routing provides a level of control that's needed to carefully design an API's public endpoint layout.</span></span>

<span data-ttu-id="b4ae8-576">Приложения Razor Pages используют стандартную маршрутизацию по умолчанию для предоставления именованных ресурсов в папке *Pages* приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-576">Razor Pages apps use default conventional routing to serve named resources in the *Pages* folder of an app.</span></span> <span data-ttu-id="b4ae8-577">Доступны дополнительные соглашения, которые позволяют настроить поведение маршрутизации Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-577">Additional conventions are available that allow you to customize Razor Pages routing behavior.</span></span> <span data-ttu-id="b4ae8-578">Дополнительные сведения см. в разделах <xref:razor-pages/index> и <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-578">For more information, see <xref:razor-pages/index> and <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="b4ae8-579">Благодаря поддержке создания URL-адресов приложение можно разрабатывать без жесткого программирования URL-адресов для связывания компонентов приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-579">URL generation support allows the app to be developed without hard-coding URLs to link the app together.</span></span> <span data-ttu-id="b4ae8-580">Это обеспечивает начало работы с основной конфигурацией маршрутизации и изменение маршрутов после определения схемы ресурсов приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-580">This support allows for starting with a basic routing configuration and modifying the routes after the app's resource layout is determined.</span></span>

<span data-ttu-id="b4ae8-581">Маршрутизация использует *конечные точки* (`Endpoint`) для представления логических конечных точек в приложении.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-581">Routing uses *endpoints* (`Endpoint`) to represent logical endpoints in an app.</span></span>

<span data-ttu-id="b4ae8-582">Конечная точка определяет делегат для обработки запросов и коллекцию произвольных метаданных.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-582">An endpoint defines a delegate to process requests and a collection of arbitrary metadata.</span></span> <span data-ttu-id="b4ae8-583">Метаданные используются для реализации сквозной функциональности на основе политик и конфигурации каждой конечной точки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-583">The metadata is used implement cross-cutting concerns based on policies and configuration attached to each endpoint.</span></span>

<span data-ttu-id="b4ae8-584">Система маршрутизации обладает следующими характеристиками:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-584">The routing system has the following characteristics:</span></span>

* <span data-ttu-id="b4ae8-585">Синтаксис шаблона маршрута используется для определения маршрутов с помощью параметров размеченного маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-585">Route template syntax is used to define routes with tokenized route parameters.</span></span>
* <span data-ttu-id="b4ae8-586">Допускается конфигурация конечной точки в стандартном стиле и с атрибутами.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-586">Conventional-style and attribute-style endpoint configuration is permitted.</span></span>
* <span data-ttu-id="b4ae8-587"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> используется для определения того, содержит ли параметр URL-адреса допустимое значение для ограничения заданной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-587"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> is used to determine whether a URL parameter contains a valid value for a given endpoint constraint.</span></span>
* <span data-ttu-id="b4ae8-588">Модели приложения, такие как MVC и Razor Pages, регистрируют все свои конечные точки, имеющие предсказуемую реализацию сценариев маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-588">App models, such as MVC/Razor Pages, register all of their endpoints, which have a predictable implementation of routing scenarios.</span></span>
* <span data-ttu-id="b4ae8-589">Реализация маршрутизации принимает решения о маршрутизации в нужном месте конвейера ПО промежуточного слоя.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-589">The routing implementation makes routing decisions wherever desired in the middleware pipeline.</span></span>
* <span data-ttu-id="b4ae8-590">ПО промежуточного слоя, которое появляется после ПО промежуточного слоя маршрутизации, может проверить результат принятия решений о конечной точке, принятое ПО промежуточного слоя маршрутизации для заданного URI запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-590">Middleware that appears after a Routing Middleware can inspect the result of the Routing Middleware's endpoint decision for a given request URI.</span></span>
* <span data-ttu-id="b4ae8-591">Можно перечислить все конечные точки в приложении в любом месте конвейера ПО промежуточного слоя.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-591">It's possible to enumerate all of the endpoints in the app anywhere in the middleware pipeline.</span></span>
* <span data-ttu-id="b4ae8-592">Приложение может использовать маршрутизацию для формирования URL-адресов (например, для перенаправления или ссылок) на основе сведений о конечной точке, что позволяет избежать жесткого задания URL-адресов и упрощает поддержку.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-592">An app can use routing to generate URLs (for example, for redirection or links) based on endpoint information and thus avoid hard-coded URLs, which helps maintainability.</span></span>
* <span data-ttu-id="b4ae8-593">Формирование URL-адреса основано на адресах, которые поддерживают произвольную расширяемость:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-593">URL generation is based on addresses, which support arbitrary extensibility:</span></span>

  * <span data-ttu-id="b4ae8-594">API генератора ссылок (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) может быть разрешено в любом месте с помощью [внедрения зависимостей (DI)](xref:fundamentals/dependency-injection) для формирования URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-594">The Link Generator API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) can be resolved anywhere using [dependency injection (DI)](xref:fundamentals/dependency-injection) to generate URLs.</span></span>
  * <span data-ttu-id="b4ae8-595">Если API генератора ссылок недоступно через внедрение зависимостей, <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> предлагает методы для создания URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-595">Where the Link Generator API isn't available via DI, <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offers methods to build URLs.</span></span>

> [!NOTE]
> <span data-ttu-id="b4ae8-596">С появлением маршрутизации по конечным точкам в ASP.NET Core 2.2 связывание конечных точек стало ограничено действиями и страницами MVC и Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-596">With the release of endpoint routing in ASP.NET Core 2.2, endpoint linking is limited to MVC/Razor Pages actions and pages.</span></span> <span data-ttu-id="b4ae8-597">Расширение функций связывания конечных точек планируется в будущих выпусках.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-597">The expansions of endpoint-linking capabilities is planned for future releases.</span></span>

<span data-ttu-id="b4ae8-598">Функция маршрутизации подключается к конвейеру [ПО промежуточного слоя](xref:fundamentals/middleware/index) с помощью класса <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-598">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="b4ae8-599">[ASP.NET Core MVC](xref:mvc/overview) добавляет функцию маршрутизации в конвейер ПО промежуточного слоя в процессе настройки и обрабатывает маршрутизацию в приложениях MVC и Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-599">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration and handles routing in MVC and Razor Pages apps.</span></span> <span data-ttu-id="b4ae8-600">Сведения об использовании маршрутизации в виде отдельного компонента см. в руководстве по [использованию ПО промежуточного слоя маршрутизации](#use-routing-middleware).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-600">To learn how to use routing as a standalone component, see the [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="b4ae8-601">Соответствие URL-адресов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-601">URL matching</span></span>

<span data-ttu-id="b4ae8-602">Сопоставление URL-адресов — это процесс, с помощью которого функция маршрутизации отправляет входящий запрос в *конечную точку*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-602">URL matching is the process by which routing dispatches an incoming request to an *endpoint*.</span></span> <span data-ttu-id="b4ae8-603">Этот процесс основывается на данных в пути URL-адреса, но может быть расширен для учета любых данных в запросе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-603">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="b4ae8-604">Возможность отправки запросов в отдельные обработчики имеет первостепенное значение для масштабирования размера и сложности приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-604">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="b4ae8-605">Система маршрутизации в маршрутизации по конечным точкам принимает все решения об отправке.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-605">The routing system in endpoint routing is responsible for all dispatching decisions.</span></span> <span data-ttu-id="b4ae8-606">Так как ПО промежуточного слоя применяет политики в зависимости от выбранной конечной точки, очень важно, чтобы любое решение, которое может повлиять на отправку или применение политик безопасности, принималось внутри системы маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-606">Since the middleware applies policies based on the selected endpoint, it's important that any decision that can affect dispatching or the application of security policies is made inside the routing system.</span></span>

<span data-ttu-id="b4ae8-607">Когда делегат конечной точки выполняется, свойствам [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) присваиваются значения с учетом уже выполненной на текущий момент обработки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-607">When the endpoint delegate is executed, the properties of [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) are set to appropriate values based on the request processing performed thus far.</span></span>

<span data-ttu-id="b4ae8-608">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) — это словарь *значений маршрута*, полученных из маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-608">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="b4ae8-609">Как правило, эти значения определяются путем разбивки URL-адреса на сегменты и могут использоваться для принятия входных данных пользователя или принятия дальнейших решений об отправке в приложении.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-609">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="b4ae8-610">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) — это контейнер свойств с дополнительными данными, связанными с соответствующим маршрутом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-610">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="b4ae8-611">Свойства <xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> обеспечивают связывание данных состояния с каждым маршрутом, что позволяет приложению принимать решения в зависимости от соответствующего маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-611"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> are provided to support associating state data with each route so that the app can make decisions based on which route matched.</span></span> <span data-ttu-id="b4ae8-612">Эти значения определяются разработчиком и никоим образом **не** влияют на поведение маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-612">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="b4ae8-613">Кроме того, значения, спрятанные в токенах [RouteData.DataToken](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*), могут быть любого типа в отличие от значений [RouteData.Value](xref:Microsoft.AspNetCore.Routing.RouteData.Values), которые должны легко преобразовываться в строки и из строк.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-613">Additionally, values stashed in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) can be of any type, in contrast to [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), which must be convertible to and from strings.</span></span>

<span data-ttu-id="b4ae8-614">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) — это список маршрутов, которые участвовали в успешном сопоставлении с запросом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-614">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="b4ae8-615">Маршруты могут быть вложены друг в друга.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-615">Routes can be nested inside of one another.</span></span> <span data-ttu-id="b4ae8-616">Свойство <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> отражает путь по логическому дереву маршрутов, который привел к совпадению.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-616">The <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="b4ae8-617">Как правило, первый элемент в свойстве <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> — это коллекция маршрутов, используемая для формирования URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-617">Generally, the first item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="b4ae8-618">Последний элемент в свойстве <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> — это соответствующий обработчик маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-618">The last item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route handler that matched.</span></span>

<a name="lg"></a>

### <a name="url-generation-with-linkgenerator"></a><span data-ttu-id="b4ae8-619">Создание URL-адреса с помощью LinkGenerator</span><span class="sxs-lookup"><span data-stu-id="b4ae8-619">URL generation with LinkGenerator</span></span>

<span data-ttu-id="b4ae8-620">Формирование URL-адреса — это процесс создания пути URL-адреса функцией маршрутизации на основе набора значений маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-620">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="b4ae8-621">Он обеспечивает логическое разделение конечных точек и URL-адресов, по которым к ним осуществляется доступ.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-621">This allows for a logical separation between your endpoints and the URLs that access them.</span></span>

<span data-ttu-id="b4ae8-622">Маршрутизация по конечным точкам включает в себя API генератора ссылок (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-622">Endpoint routing includes the Link Generator API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>).</span></span> <span data-ttu-id="b4ae8-623"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> — это отдельная служба, которую можно получить посредством внедрения зависимостей.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-623"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is a singleton service that can be retrieved from DI.</span></span> <span data-ttu-id="b4ae8-624">API можно использовать вне контекста выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-624">The API can be used outside of the context of an executing request.</span></span> <span data-ttu-id="b4ae8-625"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> MVC и сценарии, которые зависят от <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, такие как [вспомогательные функции тегов](xref:mvc/views/tag-helpers/intro), вспомогательные методы HTML и [результаты действий](xref:mvc/controllers/actions), используют генератор ссылок для предоставления возможностей создания ссылок.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-625">MVC's <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> and scenarios that rely on <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, such as [Tag Helpers](xref:mvc/views/tag-helpers/intro), HTML Helpers, and [Action Results](xref:mvc/controllers/actions), use the link generator to provide link generating capabilities.</span></span>

<span data-ttu-id="b4ae8-626">Генератор ссылок использует концепции *адреса* и *схем адресов*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-626">The link generator is backed by the concept of an *address* and *address schemes*.</span></span> <span data-ttu-id="b4ae8-627">Схема адресов — это способ определения конечных точек, которые должны рассматриваться для создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-627">An address scheme is a way of determining the endpoints that should be considered for link generation.</span></span> <span data-ttu-id="b4ae8-628">Например, сценарии с именем маршрута и значениями маршрута, с которыми многие пользователи знакомы по MVC и Razor Pages, реализуются как схема адресов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-628">For example, the route name and route values scenarios many users are familiar with from MVC/Razor Pages are implemented as an address scheme.</span></span>

<span data-ttu-id="b4ae8-629">Генератор ссылок может установить связь с действиями и страницами MVC и Razor Pages с помощью следующих методов расширения:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-629">The link generator can link to MVC/Razor Pages actions and pages via the following extension methods:</span></span>

* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetPathByAction*>
* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetUriByAction*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetPathByPage*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetUriByPage*>

<span data-ttu-id="b4ae8-630">Перегрузка этих методов принимает аргументы, которые включают `HttpContext`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-630">An overload of these methods accepts arguments that include the `HttpContext`.</span></span> <span data-ttu-id="b4ae8-631">Эти методы являются функциональными эквивалентами `Url.Action` и `Url.Page`, но предлагают дополнительную гибкость и параметры.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-631">These methods are functionally equivalent to `Url.Action` and `Url.Page` but offer additional flexibility and options.</span></span>

<span data-ttu-id="b4ae8-632">Методы `GetPath*` наиболее схожи с `Url.Action` и `Url.Page` в том, что создают URI, содержащий абсолютный путь.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-632">The `GetPath*` methods are most similar to `Url.Action` and `Url.Page` in that they generate a URI containing an absolute path.</span></span> <span data-ttu-id="b4ae8-633">Методы `GetUri*` всегда создают абсолютный URI, содержащий схему и узел.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-633">The `GetUri*` methods always generate an absolute URI containing a scheme and host.</span></span> <span data-ttu-id="b4ae8-634">Методы, которые принимают `HttpContext`, создают URI в контексте выполнения запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-634">The methods that accept an `HttpContext` generate a URI in the context of the executing request.</span></span> <span data-ttu-id="b4ae8-635">Используются значения окружения маршрута, базовый URL-адрес, схема и узел из выполняющегося запроса, если не указано иное.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-635">The ambient route values, URL base path, scheme, and host from the executing request are used unless overridden.</span></span>

<span data-ttu-id="b4ae8-636"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> вызывается с адресом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-636"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is called with an address.</span></span> <span data-ttu-id="b4ae8-637">Создание URI происходит в два этапа:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-637">Generating a URI occurs in two steps:</span></span>

1. <span data-ttu-id="b4ae8-638">Адрес привязан к списку конечных точек, соответствующих адресу.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-638">An address is bound to a list of endpoints that match the address.</span></span>
1. <span data-ttu-id="b4ae8-639">`RoutePattern` конечной точки вычисляется, пока не будет найден шаблон маршрута, который соответствует предоставленным значениям.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-639">Each endpoint's `RoutePattern` is evaluated until a route pattern that matches the supplied values is found.</span></span> <span data-ttu-id="b4ae8-640">Полученный результат объединяется с другими частями URI, предоставленными генератору ссылок и возвращенными.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-640">The resulting output is combined with the other URI parts supplied to the link generator and returned.</span></span>

<span data-ttu-id="b4ae8-641">Методы, предоставляемые <xref:Microsoft.AspNetCore.Routing.LinkGenerator>, поддерживают стандартные возможности создания ссылки для любого типа адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-641">The methods provided by <xref:Microsoft.AspNetCore.Routing.LinkGenerator> support standard link generation capabilities for any type of address.</span></span> <span data-ttu-id="b4ae8-642">Самый удобный способ использовать генератор ссылки — через методы расширения, которые выполняют операции для определенного типа адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-642">The most convenient way to use the link generator is through extension methods that perform operations for a specific address type.</span></span>

| <span data-ttu-id="b4ae8-643">Метод расширения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-643">Extension Method</span></span>   | <span data-ttu-id="b4ae8-644">ОПИСАНИЕ</span><span class="sxs-lookup"><span data-stu-id="b4ae8-644">Description</span></span>                                                         |
| ------------------ | ------------------------------------------------------------------- |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*> | <span data-ttu-id="b4ae8-645">Создает URI с абсолютным путем на основе предоставленных значений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-645">Generates a URI with an absolute path based on the provided values.</span></span> |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetUriByAddress*> | <span data-ttu-id="b4ae8-646">Создает абсолютный URI на основе предоставленных значений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-646">Generates an absolute URI based on the provided values.</span></span>             |

> [!WARNING]
> <span data-ttu-id="b4ae8-647">Обратите внимание на следующие последствия вызова методов <xref:Microsoft.AspNetCore.Routing.LinkGenerator>:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-647">Pay attention to the following implications of calling <xref:Microsoft.AspNetCore.Routing.LinkGenerator> methods:</span></span>
>
> * <span data-ttu-id="b4ae8-648">Используйте методы расширения `GetUri*` с осторожностью в конфигурации приложения, которая не проверяет заголовок входящих запросов `Host`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-648">Use `GetUri*` extension methods with caution in an app configuration that doesn't validate the `Host` header of incoming requests.</span></span> <span data-ttu-id="b4ae8-649">Если не проверить заголовок входящих запросов `Host`, входные данные в запросе без доверия могут отправляться обратно клиенту в URI в представлении или странице.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-649">If the `Host` header of incoming requests isn't validated, untrusted request input can be sent back to the client in URIs in a view/page.</span></span> <span data-ttu-id="b4ae8-650">Рекомендуется, чтобы все рабочие приложения настраивали свой сервер на проверку заголовка `Host` относительно известных допустимых значений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-650">We recommend that all production apps configure their server to validate the `Host` header against known valid values.</span></span>
>
> * <span data-ttu-id="b4ae8-651">Используйте <xref:Microsoft.AspNetCore.Routing.LinkGenerator> с осторожностью в ПО промежуточного слоя в сочетании с `Map` или `MapWhen`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-651">Use <xref:Microsoft.AspNetCore.Routing.LinkGenerator> with caution in middleware in combination with `Map` or `MapWhen`.</span></span> <span data-ttu-id="b4ae8-652">`Map*` изменяет базовый путь выполняющегося запроса, что влияет на выходные данные создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-652">`Map*` changes the base path of the executing request, which affects the output of link generation.</span></span> <span data-ttu-id="b4ae8-653">Все API <xref:Microsoft.AspNetCore.Routing.LinkGenerator> разрешают указание базового пути.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-653">All of the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> APIs allow specifying a base path.</span></span> <span data-ttu-id="b4ae8-654">Всегда указывайте пустой базовый путь для отмены влияния `Map*` на создание ссылок.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-654">Always specify an empty base path to undo `Map*`'s affect on link generation.</span></span>

## <a name="differences-from-earlier-versions-of-routing"></a><span data-ttu-id="b4ae8-655">Отличия от более ранних версий маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-655">Differences from earlier versions of routing</span></span>

<span data-ttu-id="b4ae8-656">Существует несколько различий между маршрутизацией по конечным точкам в ASP.NET Core 2.2 или более поздней версии и более ранними версиями маршрутизации в ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-656">A few differences exist between endpoint routing in ASP.NET Core 2.2 or later and earlier versions of routing in ASP.NET Core:</span></span>

* <span data-ttu-id="b4ae8-657">Система маршрутизации по конечным точкам не поддерживает расширяемость на основе <xref:Microsoft.AspNetCore.Routing.IRouter>, включая наследование от <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-657">The endpoint routing system doesn't support <xref:Microsoft.AspNetCore.Routing.IRouter>-based extensibility, including inheriting from <xref:Microsoft.AspNetCore.Routing.Route>.</span></span>

* <span data-ttu-id="b4ae8-658">Маршрутизация по конечным точкам не поддерживает [WebApiCompatShim](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.WebApiCompatShim).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-658">Endpoint routing doesn't support [WebApiCompatShim](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.WebApiCompatShim).</span></span> <span data-ttu-id="b4ae8-659">Используйте [совместимую версию](xref:mvc/compatibility-version) 2.1 (`.SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`), чтобы продолжить использование оболочек совместимости.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-659">Use the 2.1 [compatibility version](xref:mvc/compatibility-version) (`.SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`) to continue using the compatibility shim.</span></span>

* <span data-ttu-id="b4ae8-660">Маршрутизация по конечным точкам иначе обрабатывает регистр созданных URI при использовании стандартных маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-660">Endpoint Routing has different behavior for the casing of generated URIs when using conventional routes.</span></span>

  <span data-ttu-id="b4ae8-661">Рассмотрим следующий шаблон маршрута по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-661">Consider the following default route template:</span></span>

  ```csharp
  app.UseMvc(routes =>
  {
      routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
  });
  ```

  <span data-ttu-id="b4ae8-662">Предположим, вы создаете ссылку на действие с помощью следующего маршрута:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-662">Suppose you generate a link to an action using the following route:</span></span>

  ```csharp
  var link = Url.Action("ReadPost", "blog", new { id = 17, });
  ```

  <span data-ttu-id="b4ae8-663">С помощью маршрутизации на основе <xref:Microsoft.AspNetCore.Routing.IRouter> этот код создает URI из `/blog/ReadPost/17`, который учитывает регистр предоставленного значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-663">With <xref:Microsoft.AspNetCore.Routing.IRouter>-based routing, this code generates a URI of `/blog/ReadPost/17`, which respects the casing of the provided route value.</span></span> <span data-ttu-id="b4ae8-664">Маршрутизация по конечным точкам в ASP.NET Core 2.2 или более поздней версии создает `/Blog/ReadPost/17` ("Blog" — с прописной буквы).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-664">Endpoint routing in ASP.NET Core 2.2 or later produces `/Blog/ReadPost/17` ("Blog" is capitalized).</span></span> <span data-ttu-id="b4ae8-665">Маршрутизация по конечным точкам предоставляет интерфейс `IOutboundParameterTransformer`, который можно использовать для настройки этого поведения на глобальном уровне или применения других соглашения для сопоставления URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-665">Endpoint routing provides the `IOutboundParameterTransformer` interface that can be used to customize this behavior globally or to apply different conventions for mapping URLs.</span></span>

  <span data-ttu-id="b4ae8-666">Дополнительные сведения см. в разделе [Справочник по преобразователям параметров](#parameter-transformer-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-666">For more information, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

* <span data-ttu-id="b4ae8-667">Создание ссылок, используемых MVC и Razor Pages со стандартными маршрутами, работает иначе при попытке сослаться на контроллер/действие или страницу, которые не существуют.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-667">Link Generation used by MVC/Razor Pages with conventional routes behaves differently when attempting to link to an controller/action or page that doesn't exist.</span></span>

  <span data-ttu-id="b4ae8-668">Рассмотрим следующий шаблон маршрута по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-668">Consider the following default route template:</span></span>

  ```csharp
  app.UseMvc(routes =>
  {
      routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
  });
  ```

  <span data-ttu-id="b4ae8-669">Предположим, вы создаете ссылку на действие с помощью шаблона по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-669">Suppose you generate a link to an action using the default template with the following:</span></span>

  ```csharp
  var link = Url.Action("ReadPost", "Blog", new { id = 17, });
  ```

  <span data-ttu-id="b4ae8-670">С маршрутизацией на основе `IRouter` результатом всегда будет `/Blog/ReadPost/17`, даже если `BlogController` не существует или не имеет метода действия `ReadPost`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-670">With `IRouter`-based routing, the result is always `/Blog/ReadPost/17`, even if the `BlogController` doesn't exist or doesn't have a `ReadPost` action method.</span></span> <span data-ttu-id="b4ae8-671">Как и ожидалось, маршрутизация по конечным точкам в ASP.NET Core 2.2 или более поздней версии создает `/Blog/ReadPost/17`, если метод действия существует.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-671">As expected, endpoint routing in ASP.NET Core 2.2 or later produces `/Blog/ReadPost/17` if the action method exists.</span></span> <span data-ttu-id="b4ae8-672">*Но маршрутизация по конечным точкам создает пустую строку, если действие не существует.*</span><span class="sxs-lookup"><span data-stu-id="b4ae8-672">*However, endpoint routing produces an empty string if the action doesn't exist.*</span></span> <span data-ttu-id="b4ae8-673">По существу, маршрутизация по конечным точкам не предполагает, что конечная точка существует, если действие не существует.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-673">Conceptually, endpoint routing doesn't assume that the endpoint exists if the action doesn't exist.</span></span>

* <span data-ttu-id="b4ae8-674">*Алгоритм отмены значения окружения* при создании ссылок работает иначе при маршрутизации по конечным точкам.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-674">The link generation *ambient value invalidation algorithm* behaves differently when used with endpoint routing.</span></span>

  <span data-ttu-id="b4ae8-675">*Отмена значения окружения* — это алгоритм, который решает, какие значения маршрута из текущего выполняемого запроса (значения окружения) могут использоваться в операции создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-675">*Ambient value invalidation* is the algorithm that decides which route values from the currently executing request (the ambient values) can be used in link generation operations.</span></span> <span data-ttu-id="b4ae8-676">Стандартная маршрутизация всегда отменяет лишние значения маршрута при привязке к другому действию.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-676">Conventional routing always invalidated extra route values when linking to a different action.</span></span> <span data-ttu-id="b4ae8-677">Маршрутизация с помощью атрибутов работала иначе до выпуска ASP.NET Core 2.2.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-677">Attribute routing didn't have this behavior prior to the release of ASP.NET Core 2.2.</span></span> <span data-ttu-id="b4ae8-678">В более ранних версиях ASP.NET Core ссылки на другое действие, которые используют те же имена параметров маршрута, приводили к ошибкам создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-678">In earlier versions of ASP.NET Core, links to another action that use the same route parameter names resulted in link generation errors.</span></span> <span data-ttu-id="b4ae8-679">В ASP.NET Core 2.2 или более поздней версии обе формы маршрутизации отменяют значения при привязке к другому действию.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-679">In ASP.NET Core 2.2 or later, both forms of routing invalidate values when linking to another action.</span></span>

  <span data-ttu-id="b4ae8-680">Рассмотрим следующий пример в ASP.NET Core 2.1 или более ранней версии.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-680">Consider the following example in ASP.NET Core 2.1 or earlier.</span></span> <span data-ttu-id="b4ae8-681">При привязке к другому действию (или странице) значения маршрута могут использоваться повторно нежелательным образом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-681">When linking to another action (or another page), route values can be reused in undesirable ways.</span></span>

  <span data-ttu-id="b4ae8-682">В */Pages/Store/Product.cshtml*:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-682">In */Pages/Store/Product.cshtml*:</span></span>

  ```cshtml
  @page "{id}"
  @Url.Page("/Login")
  ```

  <span data-ttu-id="b4ae8-683">В */Pages/Login.cshtml*:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-683">In */Pages/Login.cshtml*:</span></span>

  ```cshtml
  @page "{id?}"
  ```

  <span data-ttu-id="b4ae8-684">Если URI — `/Store/Product/18` в ASP.NET Core 2.1 или более ранней версии, ссылка, созданная на странице Store/Info с помощью `@Url.Page("/Login")` — `/Login/18`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-684">If the URI is `/Store/Product/18` in ASP.NET Core 2.1 or earlier, the link generated on the Store/Info page by `@Url.Page("/Login")` is `/Login/18`.</span></span> <span data-ttu-id="b4ae8-685">Значение `id` 18 используется повторно, хотя конечный объект ссылки является совсем другой частью приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-685">The `id` value of 18 is reused, even though the link destination is different part of the app entirely.</span></span> <span data-ttu-id="b4ae8-686">Значение маршрута `id` в контексте страницы `/Login`, вероятно, является значением идентификатора пользователя, а не кодом хранимого продукта.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-686">The `id` route value in the context of the `/Login` page is probably a user ID value, not a store product ID value.</span></span>

  <span data-ttu-id="b4ae8-687">При маршрутизации по конечным точкам в ASP.NET Core 2.2 или более поздней версии результатом является `/Login`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-687">In endpoint routing with ASP.NET Core 2.2 or later, the result is `/Login`.</span></span> <span data-ttu-id="b4ae8-688">Значения окружения не используются повторно, если конечный объект ссылки является другим действием или страницей.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-688">Ambient values aren't reused when the linked destination is a different action or page.</span></span>

* <span data-ttu-id="b4ae8-689">Синтаксис параметра кругового маршрута: символы прямой косой черты не кодируются при использовании синтаксиса универсального параметра с двумя звездочками (`**`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-689">Round-tripping route parameter syntax: Forward slashes aren't encoded when using a double-asterisk (`**`) catch-all parameter syntax.</span></span>

  <span data-ttu-id="b4ae8-690">Во время создания ссылки система маршрутизации кодирует значение, записанное в универсальном параметре с двумя звездочками (`**`) (например, `{**myparametername}`), за исключением прямой косой черты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-690">During link generation, the routing system encodes the value captured in a double-asterisk (`**`) catch-all parameter (for example, `{**myparametername}`) except the forward slashes.</span></span> <span data-ttu-id="b4ae8-691">Универсальный параметр с двумя звездочками поддерживается в маршрутизации на основе `IRouter` в ASP.NET Core 2.2 или более поздней версии.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-691">The double-asterisk catch-all is supported with `IRouter`-based routing in ASP.NET Core 2.2 or later.</span></span>

  <span data-ttu-id="b4ae8-692">Синтаксис универсального параметра с одной звездочкой в предыдущих версиях ASP.NET Core (`{*myparametername}`) поддерживается, и прямая косая черта кодируется.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-692">The single asterisk catch-all parameter syntax in prior versions of ASP.NET Core (`{*myparametername}`) remains supported, and forward slashes are encoded.</span></span>

  | <span data-ttu-id="b4ae8-693">Маршрут</span><span class="sxs-lookup"><span data-stu-id="b4ae8-693">Route</span></span>              | <span data-ttu-id="b4ae8-694">Ссылка, созданная с помощью</span><span class="sxs-lookup"><span data-stu-id="b4ae8-694">Link generated with</span></span><br>`Url.Action(new { category = "admin/products" })`&hellip; |
  | ------------------ | --------------------------------------------------------------------- |
  | `/search/{*page}`  | <span data-ttu-id="b4ae8-695">`/search/admin%2Fproducts` (прямая косая черта кодируется)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-695">`/search/admin%2Fproducts` (the forward slash is encoded)</span></span>             |
  | `/search/{**page}` | `/search/admin/products`                                              |

### <a name="middleware-example"></a><span data-ttu-id="b4ae8-696">Пример ПО промежуточного слоя</span><span class="sxs-lookup"><span data-stu-id="b4ae8-696">Middleware example</span></span>

<span data-ttu-id="b4ae8-697">В следующем примере ПО промежуточного слоя использует API <xref:Microsoft.AspNetCore.Routing.LinkGenerator>, чтобы создать ссылку на метод действия, который перечисляет хранимые продукты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-697">In the following example, a middleware uses the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API to create link to an action method that lists store products.</span></span> <span data-ttu-id="b4ae8-698">Использование генератора ссылок путем его внедрения в класс и вызова `GenerateLink` доступно для любого класса в приложении.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-698">Using the link generator by injecting it into a class and calling `GenerateLink` is available to any class in an app.</span></span>

```csharp
using Microsoft.AspNetCore.Routing;

public class ProductsLinkMiddleware
{
    private readonly LinkGenerator _linkGenerator;

    public ProductsLinkMiddleware(RequestDelegate next, LinkGenerator linkGenerator)
    {
        _linkGenerator = linkGenerator;
    }

    public async Task InvokeAsync(HttpContext httpContext)
    {
        var url = _linkGenerator.GetPathByAction("ListProducts", "Store");

        httpContext.Response.ContentType = "text/plain";

        await httpContext.Response.WriteAsync($"Go to {url} to see our products.");
    }
}
```

### <a name="create-routes"></a><span data-ttu-id="b4ae8-699">Создание маршрутов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-699">Create routes</span></span>

<span data-ttu-id="b4ae8-700">Большинство приложений создают маршруты, вызывая метод <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> или один из аналогичных методов расширения, определенных в интерфейсе <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-700">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="b4ae8-701">Все методы расширения <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> создают экземпляр <xref:Microsoft.AspNetCore.Routing.Route> и добавляют его в коллекцию маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-701">Any of the <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> extension methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="b4ae8-702"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> не принимает параметр обработчика маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-702"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> doesn't accept a route handler parameter.</span></span> <span data-ttu-id="b4ae8-703"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> только добавляет маршруты, которые обрабатываются <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-703"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="b4ae8-704">Дополнительные сведения о маршрутизации в MVC см. в разделе <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-704">To learn more about routing in MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="b4ae8-705">В следующем коде приводится пример вызова <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*>, используемого в типичном определении маршрута ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-705">The following code example is an example of a <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="b4ae8-706">Этот шаблон соответствует пути URL-адреса и извлекает значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-706">This template matches a URL path and extracts the route values.</span></span> <span data-ttu-id="b4ae8-707">Например, путь `/Products/Details/17` создает следующие значения маршрута: `{ controller = Products, action = Details, id = 17 }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-707">For example, the path `/Products/Details/17` generates the following route values: `{ controller = Products, action = Details, id = 17 }`.</span></span>

<span data-ttu-id="b4ae8-708">Значения маршрута определяются с помощью разделения пути URL-адреса на сегменты и сопоставления каждого сегмента с именем *параметра маршрута* в шаблоне маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-708">Route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="b4ae8-709">Параметры маршрута являются именованными.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-709">Route parameters are named.</span></span> <span data-ttu-id="b4ae8-710">Параметры определяются путем заключения имени параметра в фигурные скобки `{ ... }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-710">The parameters defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="b4ae8-711">Приведенный выше шаблон может также соответствовать пути URL-адреса `/`. В этом случае он предоставляет значения `{ controller = Home, action = Index }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-711">The preceding template could also match the URL path `/` and produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="b4ae8-712">Связано это с тем, что параметры маршрута `{controller}` и `{action}` имеют значения по умолчанию, а параметр маршрута `id` является необязательным.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-712">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="b4ae8-713">Значение по умолчанию для параметра маршрута определяется с помощью знака равенства (`=`), за которым следует значение после имени параметра.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-713">An equals sign (`=`) followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="b4ae8-714">Вопросительный знак (`?`) после имени параметра маршрута определяет параметр как необязательный.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-714">A question mark (`?`) after the route parameter name defines an optional parameter.</span></span>

<span data-ttu-id="b4ae8-715">Параметры маршрута со значением по умолчанию *всегда* предоставляют значения маршрута при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-715">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="b4ae8-716">Необязательные параметры не предоставляют значение маршрута, если нет соответствующего сегмента пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-716">Optional parameters don't produce a route value if there was no corresponding URL path segment.</span></span> <span data-ttu-id="b4ae8-717">Подробное описание сценариев и синтаксиса шаблона маршрута см. в разделе [Справочник по шаблонам маршрутов](#route-template-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-717">See the [Route template reference](#route-template-reference) section for a thorough description of route template scenarios and syntax.</span></span>

<span data-ttu-id="b4ae8-718">В следующем примере в определении параметра маршрута `{id:int}` определяется [ограничение маршрута](#route-constraint-reference) для параметра маршрута `id`:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-718">In the following example, the route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="b4ae8-719">Этот шаблон соответствует такому пути URL-адреса, как `/Products/Details/17`, но не `/Products/Details/Apples`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-719">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="b4ae8-720">Ограничения маршрута реализуют интерфейс <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> и проверяют значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-720">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="b4ae8-721">В этом примере значение маршрута `id` должно иметь возможность преобразования в целое число.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-721">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="b4ae8-722">Более подробное описание ограничений маршрутов, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-722">See [route-constraint-reference](#route-constraint-reference) for an explanation of route constraints provided by the framework.</span></span>

<span data-ttu-id="b4ae8-723">Дополнительные перегрузки <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> принимают значения для параметров `constraints`, `dataTokens` и `defaults`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-723">Additional overloads of <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="b4ae8-724">Типичное применение этих параметров состоит в передаче анонимно типизированного объекта, причем имена свойств анонимного типа соответствуют именам параметров маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-724">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="b4ae8-725">В следующих примерах <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> создаются эквивалентные маршруты:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-725">The following <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="b4ae8-726">Встроенный синтаксис определения ограничений и значений по умолчанию может быть удобнее для простых маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-726">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="b4ae8-727">Однако некоторые сценарии, например токены данных, не поддерживаются встроенным синтаксисом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-727">However, there are scenarios, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="b4ae8-728">В следующем примере показано еще несколько сценариев:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-728">The following example demonstrates a few additional scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{**article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="b4ae8-729">Предыдущий шаблон соответствует такому пути URL-адреса, как `/Blog/All-About-Routing/Introduction`, и извлекает значения `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-729">The preceding template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="b4ae8-730">Значения маршрута по умолчанию для `controller` и `action` предоставляются маршрутом несмотря на то, что в шаблоне нет соответствующих параметров маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-730">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="b4ae8-731">Значения по умолчанию можно указать в шаблоне маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-731">Default values can be specified in the route template.</span></span> <span data-ttu-id="b4ae8-732">Параметр маршрута `article` определяется как *универсальный* с помощью двух звездочек (`**`) перед именем.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-732">The `article` route parameter is defined as a *catch-all* by the appearance of an double asterisk (`**`) before the route parameter name.</span></span> <span data-ttu-id="b4ae8-733">Универсальные параметры маршрута служат для фиксации оставшейся части пути URL-адреса, а также могут соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-733">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="b4ae8-734">В следующем примере добавляются ограничения маршрута и токены данных:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-734">The following example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="b4ae8-735">Предыдущий шаблон будет соответствовать такому пути URL-адреса, как `/en-US/Products/5`, и будет извлекать значения `{ controller = Products, action = Details, id = 5 }` и токены данных `{ locale = en-US }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-735">The preceding template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![Токены в окне "Локальные"](routing/_static/tokens.png)

### <a name="route-class-url-generation"></a><span data-ttu-id="b4ae8-737">Формирование URL-адреса класса маршрута</span><span class="sxs-lookup"><span data-stu-id="b4ae8-737">Route class URL generation</span></span>

<span data-ttu-id="b4ae8-738">Класс <xref:Microsoft.AspNetCore.Routing.Route> может также формировать URL-адрес, объединяя набор значений маршрута с шаблоном маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-738">The <xref:Microsoft.AspNetCore.Routing.Route> class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="b4ae8-739">С логической точки зрения, этот процесс обратен сопоставлению пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-739">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="b4ae8-740">Чтобы лучше понять процесс формирования URL-адреса, представьте себе, какой URL-адрес нужно создать, а затем подумайте, как шаблон маршрута будет сопоставляться с этим URL-адресом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-740">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="b4ae8-741">Какие значения будут получены?</span><span class="sxs-lookup"><span data-stu-id="b4ae8-741">What values would be produced?</span></span> <span data-ttu-id="b4ae8-742">Примерно так производится формирование URL-адреса в классе <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-742">This is the rough equivalent of how URL generation works in the <xref:Microsoft.AspNetCore.Routing.Route> class.</span></span>

<span data-ttu-id="b4ae8-743">В следующем примере используется общий маршрут по умолчанию ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-743">The following example uses a general ASP.NET Core MVC default route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="b4ae8-744">При значениях маршрута `{ controller = Products, action = List }` создается URL-адрес `/Products/List`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-744">With the route values `{ controller = Products, action = List }`, the URL `/Products/List` is generated.</span></span> <span data-ttu-id="b4ae8-745">Значения маршрута заменяются на соответствующие параметры маршрута для образования пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-745">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="b4ae8-746">Так как `id` является необязательным параметром маршрута, URL-адрес успешно создается без значения для `id`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-746">Since `id` is an optional route parameter, the URL is successfully generated without a value for `id`.</span></span>

<span data-ttu-id="b4ae8-747">При значениях маршрута `{ controller = Home, action = Index }` создается URL-адрес `/`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-747">With the route values `{ controller = Home, action = Index }`, the URL `/` is generated.</span></span> <span data-ttu-id="b4ae8-748">Предоставленные значения маршрута соответствуют значениям по умолчанию, поэтому сегменты, соответствующие значениям по умолчанию, можно спокойно опустить.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-748">The provided route values match the default values, and the segments corresponding to the default values are safely omitted.</span></span>

<span data-ttu-id="b4ae8-749">Оба созданных URL-адреса будут совершать круговой путь с таким же определением маршрута (`/Home/Index` и `/`) и предоставлять те же значения маршрута, которые использовались для формирования URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-749">Both URLs generated round-trip with the following route definition (`/Home/Index` and `/`) produce the same route values that were used to generate the URL.</span></span>

> [!NOTE]
> <span data-ttu-id="b4ae8-750">Приложение, использующее платформу ASP.NET Core MVC, должно создавать URL-адреса с помощью объекта <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper>, а не вызывать маршрутизацию напрямую.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-750">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="b4ae8-751">Дополнительные сведения о формировании URL-адресов см. в [справочнике по формированию URL-адресов](#url-generation-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-751">For more information on URL generation, see the [Url generation reference](#url-generation-reference) section.</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="b4ae8-752">Использование ПО промежуточного слоя маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-752">Use Routing Middleware</span></span>

<span data-ttu-id="b4ae8-753">Ссылка на [метапакет Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) в файле проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-753">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

<span data-ttu-id="b4ae8-754">Добавьте маршрутизацию в контейнер службы в файле `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-754">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

<span data-ttu-id="b4ae8-755">Маршруты должны настраиваться в методе `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-755">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="b4ae8-756">В этом примере приложения используются следующие API:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-756">The sample app uses the following APIs:</span></span>

* <xref:Microsoft.AspNetCore.Routing.RouteBuilder>
* <span data-ttu-id="b4ae8-757"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> &ndash; — соответствует только HTTP-запросам GET.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-757"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> &ndash; Matches only HTTP GET requests.</span></span>
* <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

<span data-ttu-id="b4ae8-758">В таблице ниже приведены ответы с данными универсальными кодами ресурсов (URI).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-758">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="b4ae8-759">URI</span><span class="sxs-lookup"><span data-stu-id="b4ae8-759">URI</span></span>                    | <span data-ttu-id="b4ae8-760">Ответ</span><span class="sxs-lookup"><span data-stu-id="b4ae8-760">Response</span></span>                                          |
| ---------------------- | ------------------------------------------------- |
| `/package/create/3`    | <span data-ttu-id="b4ae8-761">Hello!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-761">Hello!</span></span> <span data-ttu-id="b4ae8-762">Значения маршрута: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="b4ae8-762">Route values: [operation, create], [id, 3]</span></span> |
| `/package/track/-3`    | <span data-ttu-id="b4ae8-763">Hello!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-763">Hello!</span></span> <span data-ttu-id="b4ae8-764">Значения маршрута: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="b4ae8-764">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/-3/`   | <span data-ttu-id="b4ae8-765">Hello!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-765">Hello!</span></span> <span data-ttu-id="b4ae8-766">Значения маршрута: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="b4ae8-766">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/`      | <span data-ttu-id="b4ae8-767">Запрос не дал результата, нет совпадений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-767">The request falls through, no match.</span></span>              |
| `GET /hello/Joe`       | <span data-ttu-id="b4ae8-768">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-768">Hi, Joe!</span></span>                                          |
| `POST /hello/Joe`      | <span data-ttu-id="b4ae8-769">Запрос не дал результата, совпадение только с HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-769">The request falls through, matches HTTP GET only.</span></span> |
| `GET /hello/Joe/Smith` | <span data-ttu-id="b4ae8-770">Запрос не дал результата, нет совпадений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-770">The request falls through, no match.</span></span>              |

<span data-ttu-id="b4ae8-771">Платформа предоставляет наборов методов расширения для создания маршрутов (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span><span class="sxs-lookup"><span data-stu-id="b4ae8-771">The framework provides a set of extension methods for creating routes (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span></span>

* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareVerb*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>

<span data-ttu-id="b4ae8-772">Методы `Map[Verb]` используют ограничения, чтобы ограничить маршрут к HTTP-команде в имени метода.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-772">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="b4ae8-773">Например, см. класс <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> и тип <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-773">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="b4ae8-774">Справочник по шаблону маршрута</span><span class="sxs-lookup"><span data-stu-id="b4ae8-774">Route template reference</span></span>

<span data-ttu-id="b4ae8-775">Токены в фигурных скобках (`{ ... }`) определяют *параметры маршрута*, которые будут привязаны при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-775">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="b4ae8-776">В сегменте маршрута можно определить несколько параметров маршрута, но они должны разделяться литеральным значением.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-776">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="b4ae8-777">Например, `{controller=Home}{action=Index}` будет недопустимым маршрутом, так как между `{controller}` и `{action}` нет литерального значения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-777">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="b4ae8-778">Эти параметры маршрута должны иметь имена, и для них могут быть определены дополнительные атрибуты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-778">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="b4ae8-779">Весь текст, кроме параметров маршрута (например, `{id}`) и разделителя пути `/`, должен соответствовать тексту в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-779">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="b4ae8-780">Сопоставление текста производится без учета регистра на основе декодированного представления путь URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-780">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="b4ae8-781">Для сопоставления с литеральным разделителем параметров маршрута (`{` или `}`) разделитель следует экранировать путем повтора символа (`{{` или `}}`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-781">To match a literal route parameter delimiter (`{` or `}`), escape the delimiter by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="b4ae8-782">Шаблоны URL-адресов, которые пытаются получить имя файла с необязательным расширением, имеют свои особенности.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-782">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="b4ae8-783">Например, рассмотрим шаблон `files/{filename}.{ext?}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-783">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="b4ae8-784">Когда значения для `filename` и `ext` существуют, заполняются оба значения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-784">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="b4ae8-785">Если в URL-адресе есть только значение для `filename`, маршрут совпадает, так как точка в конце (`.`) является необязательной.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-785">If only a value for `filename` exists in the URL, the route matches because the trailing period (`.`) is  optional.</span></span> <span data-ttu-id="b4ae8-786">Следующие URL-адреса соответствуют этому маршруту:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-786">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="b4ae8-787">Вы можете использовать звездочку (`*`) или две звездочки (`**`) в качестве префикса параметра маршрута для привязки к остальной части URI.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-787">You can use an asterisk (`*`) or double asterisk (`**`) as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="b4ae8-788">Такие параметры называются *универсальными*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-788">These are called a *catch-all* parameters.</span></span> <span data-ttu-id="b4ae8-789">Например, `blog/{**slug}` соответствует любому URI, начинающемуся с сегмента `/blog`, за которым следует любое значение, присваиваемое в качестве значения маршрута `slug`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-789">For example, `blog/{**slug}` matches any URI that starts with `/blog` and has any value following it, which is assigned to the `slug` route value.</span></span> <span data-ttu-id="b4ae8-790">Универсальные параметры также могут соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-790">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="b4ae8-791">Универсальный параметр экранирует соответствующие символы, если маршрут использует для формирования URL-адрес, включая символы разделителей пути (`/`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-791">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="b4ae8-792">Например, маршрут `foo/{*path}` со значениями маршрутов `{ path = "my/path" }` формирует `foo/my%2Fpath`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-792">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="b4ae8-793">Обратите внимание на экранированный знак косой черты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-793">Note the escaped forward slash.</span></span> <span data-ttu-id="b4ae8-794">В качестве символов разделителя кругового пути используйте префикс параметра маршрута `**`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-794">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="b4ae8-795">Маршрут `foo/{**path}` с `{ path = "my/path" }` формирует `foo/my/path`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-795">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

<span data-ttu-id="b4ae8-796">Параметры маршрута могут иметь *значения по умолчанию*. Они указываются после имени параметра и знака равенства (`=`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-796">Route parameters may have *default values* designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="b4ae8-797">Например, `{controller=Home}` определяет `Home` в качестве значения по умолчанию для `controller`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-797">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="b4ae8-798">Значение по умолчанию используется, если для параметра нет значения в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-798">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="b4ae8-799">Параметры маршрута могут быть необязательными (для этого необходимо добавить вопросительный знак (`?`) в конец имени параметра, например `id?`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-799">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="b4ae8-800">Различие между необязательными параметрами и параметрами маршрута по умолчанию в том, что вторые всегда имеют значения &mdash; необязательный параметр имеет значение, только если оно предоставлено URL-адресом запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-800">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value&mdash;an optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="b4ae8-801">Параметры маршрута могут иметь ограничения, которые должны соответствовать значению маршрута из URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-801">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="b4ae8-802">Добавив двоеточие (`:`) и имя ограничения после имени параметра маршрута, можно указать *встроенные ограничения* для параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-802">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="b4ae8-803">Если для ограничения требуются аргументы, они указываются в скобках (`(...)`) после имени ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-803">If the constraint requires arguments, they're enclosed in parentheses (`(...)`) after the constraint name.</span></span> <span data-ttu-id="b4ae8-804">Чтобы указать несколько встроенных ограничений, добавьте еще одно двоеточие (`:`) и имя ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-804">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span>

<span data-ttu-id="b4ae8-805">Имя и аргументы ограничения передаются в службу <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> для создания экземпляра интерфейса <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, который будет использоваться при обработке URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-805">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="b4ae8-806">Например, в шаблоне маршрута `blog/{article:minlength(10)}` определяется ограничение `minlength` с аргументом `10`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-806">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="b4ae8-807">Более подробное описание ограничений маршрутов и список ограничений, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-807">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="b4ae8-808">Параметры маршрута также могут иметь преобразователи параметров, которые преобразуют значение параметра при создании ссылок и сопоставлении действий и страниц с URL-адресами.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-808">Route parameters may also have parameter transformers, which transform a parameter's value when generating links and matching actions and pages to URLs.</span></span> <span data-ttu-id="b4ae8-809">Как и ограничения, преобразователи параметров можно включать в параметр маршрута, добавив двоеточие (`:`) и имя преобразователя после имени параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-809">Like constraints, parameter transformers can be added inline to a route parameter by adding a colon (`:`) and transformer name after the route parameter name.</span></span> <span data-ttu-id="b4ae8-810">Например, шаблон маршрута `blog/{article:slugify}` задает преобразователь `slugify`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-810">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span> <span data-ttu-id="b4ae8-811">Дополнительные сведения о преобразователях параметров см. в разделе [Справочник по преобразователям параметров](#parameter-transformer-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-811">For more information on parameter transformers, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

<span data-ttu-id="b4ae8-812">В приведенной ниже таблице показаны некоторые примеры шаблонов маршрутов и их поведение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-812">The following table demonstrates example route templates and their behavior.</span></span>

| <span data-ttu-id="b4ae8-813">Шаблон маршрута</span><span class="sxs-lookup"><span data-stu-id="b4ae8-813">Route Template</span></span>                           | <span data-ttu-id="b4ae8-814">Пример соответствующего URI</span><span class="sxs-lookup"><span data-stu-id="b4ae8-814">Example Matching URI</span></span>    | <span data-ttu-id="b4ae8-815">URI запроса&hellip;</span><span class="sxs-lookup"><span data-stu-id="b4ae8-815">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="b4ae8-816">Соответствует только одному пути `/hello`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-816">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="b4ae8-817">Соответствует и задает для параметра `Page` значение `Home`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-817">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="b4ae8-818">Соответствует и задает для параметра `Page` значение `Contact`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-818">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="b4ae8-819">Сопоставляется с контроллером `Products` и действием `List`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-819">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="b4ae8-820">Сопоставляется с контроллером `Products` и действием `Details` (`id` имеет значение 123).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-820">Maps to the `Products` controller and  `Details` action (`id` set to 123).</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="b4ae8-821">Сопоставляется с контроллером `Home` и методом `Index` (`id` пропускается).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-821">Maps to the `Home` controller and `Index` method (`id` is ignored).</span></span>        |

<span data-ttu-id="b4ae8-822">Использование шаблона — это, как правило, самый простой подход к маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-822">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="b4ae8-823">Ограничения и значения по умолчанию также могут указываться вне шаблона маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-823">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="b4ae8-824">Чтобы увидеть, как встроенные реализации маршрутизации, такие как <xref:Microsoft.AspNetCore.Routing.Route>, сопоставляются с запросами, включите [ведение журнала](xref:fundamentals/logging/index).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-824">Enable [Logging](xref:fundamentals/logging/index) to see how the built-in routing implementations, such as <xref:Microsoft.AspNetCore.Routing.Route>, match requests.</span></span>

## <a name="reserved-routing-names"></a><span data-ttu-id="b4ae8-825">Зарезервированные имена маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-825">Reserved routing names</span></span>

<span data-ttu-id="b4ae8-826">Следующие ключевые слова являются зарезервированными именами и не могут использоваться как имена маршрутов или параметры:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-826">The following keywords are reserved names and can't be used as route names or parameters:</span></span>

* `action`
* `area`
* `controller`
* `handler`
* `page`

## <a name="route-constraint-reference"></a><span data-ttu-id="b4ae8-827">Справочник по ограничениям маршрутов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-827">Route constraint reference</span></span>

<span data-ttu-id="b4ae8-828">Ограничения маршрута применяются, когда найдено соответствие входящему URL-адресу и путь URL-адреса был разобран на значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-828">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="b4ae8-829">Как правило, ограничения маршрута служат для проверки значения маршрута, связанного посредством шаблона маршрута, и принятия решения касательно того, является ли значение приемлемым (да или нет).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-829">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="b4ae8-830">Некоторые ограничения маршрута используют данные, не относящиеся к значению маршрута, для определения возможности маршрутизации запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-830">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="b4ae8-831">Например, <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> может принимать или отклонять запрос в зависимости от HTTP-команды.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-831">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="b4ae8-832">Ограничения используются в маршрутизации запросов и создании ссылок.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-832">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="b4ae8-833">Не используйте ограничения для **проверки входных данных**.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-833">Don't use constraints for **input validation**.</span></span> <span data-ttu-id="b4ae8-834">Если ограничения используются для **проверки входных данных**, недопустимые входные данные будут вызывать ошибку *404 (не найдено)* вместо ошибки *400 (неверный запрос)* с соответствующим сообщением.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-834">If constraints are used for **input validation**, invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="b4ae8-835">Ограничения маршрутов следует использовать для **разрешения неоднозначности** похожих маршрутов, а не для проверки входных данных определенного маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-835">Route constraints are used to **disambiguate** similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="b4ae8-836">В приведенной ниже таблице показаны примеры ограничения маршрутов и их ожидаемое поведение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-836">The following table demonstrates example route constraints and their expected behavior.</span></span>

| <span data-ttu-id="b4ae8-837">ограничение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-837">constraint</span></span> | <span data-ttu-id="b4ae8-838">Пример</span><span class="sxs-lookup"><span data-stu-id="b4ae8-838">Example</span></span> | <span data-ttu-id="b4ae8-839">Примеры совпадений</span><span class="sxs-lookup"><span data-stu-id="b4ae8-839">Example Matches</span></span> | <span data-ttu-id="b4ae8-840">Примечания</span><span class="sxs-lookup"><span data-stu-id="b4ae8-840">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="b4ae8-841">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-841">`123456789`, `-123456789`</span></span> | <span data-ttu-id="b4ae8-842">Соответствует любому целому числу</span><span class="sxs-lookup"><span data-stu-id="b4ae8-842">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="b4ae8-843">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-843">`true`, `FALSE`</span></span> | <span data-ttu-id="b4ae8-844">Соответствует `true` или `false` (без учета регистра)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-844">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="b4ae8-845">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-845">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="b4ae8-846">Соответствует допустимому значению `DateTime` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-846">Matches a valid `DateTime` value (in the invariant culture - see warning)</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="b4ae8-847">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-847">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="b4ae8-848">Соответствует допустимому значению `decimal` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-848">Matches a valid `decimal` value (in the invariant culture - see warning)</span></span> |
| `double` | `{weight:double}` | <span data-ttu-id="b4ae8-849">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-849">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="b4ae8-850">Соответствует допустимому значению `double` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-850">Matches a valid `double` value (in the invariant culture - see warning)</span></span> |
| `float` | `{weight:float}` | <span data-ttu-id="b4ae8-851">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-851">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="b4ae8-852">Соответствует допустимому значению `float` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-852">Matches a valid `float` value (in the invariant culture - see warning)</span></span> |
| `guid` | `{id:guid}` | <span data-ttu-id="b4ae8-853">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-853">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="b4ae8-854">Соответствует допустимому значению `Guid`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-854">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="b4ae8-855">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-855">`123456789`, `-123456789`</span></span> | <span data-ttu-id="b4ae8-856">Соответствует допустимому значению `long`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-856">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="b4ae8-857">Строка должна содержать не менее 4 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-857">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="b4ae8-858">Строка должна содержать не более 8 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-858">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="b4ae8-859">Длина строки должна составлять ровно 12 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-859">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="b4ae8-860">Строка должна содержать от 8 до 16 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-860">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="b4ae8-861">Целочисленное значение не меньше 18</span><span class="sxs-lookup"><span data-stu-id="b4ae8-861">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="b4ae8-862">Целочисленное значение не больше 120</span><span class="sxs-lookup"><span data-stu-id="b4ae8-862">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="b4ae8-863">Целочисленное значение от 18 до 120</span><span class="sxs-lookup"><span data-stu-id="b4ae8-863">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="b4ae8-864">Строка должна состоять из одной или нескольких букв (`a`-`z`, без учета регистра)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-864">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="b4ae8-865">Строка должна соответствовать регулярному выражению (см. советы по определению регулярного выражения)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-865">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="b4ae8-866">Определяет обязательное наличие значения, не относящегося к параметру, во время формирования URL-адреса</span><span class="sxs-lookup"><span data-stu-id="b4ae8-866">Used to enforce that a non-parameter value is present during URL generation</span></span> |

<span data-ttu-id="b4ae8-867">К одному параметру может применяться несколько разделенных запятой ограничений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-867">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="b4ae8-868">Например, следующее ограничение ограничивает параметр целочисленным значением 1 или больше:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-868">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="b4ae8-869">Ограничения маршрута, которые проверяют URL-адрес и могут быть преобразованы в тип CLR (например, `int` или `DateTime`), всегда используют инвариантные язык и региональные параметры.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-869">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="b4ae8-870">Эти ограничения предполагают, что URL-адрес является нелокализуемым.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-870">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="b4ae8-871">Предоставляемые платформой ограничения маршрутов не изменяют значения, хранящиеся в значениях маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-871">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="b4ae8-872">Все значения маршрута, переданные из URL-адреса, сохраняются как строки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-872">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="b4ae8-873">Например, ограничение `float` пытается преобразовать значение маршрута в число с плавающей запятой, но преобразованное значение служит только для проверки возможности такого преобразования.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-873">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="b4ae8-874">Регулярные выражения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-874">Regular expressions</span></span>

<span data-ttu-id="b4ae8-875">В платформе ASP.NET Core в конструктор регулярных выражений добавляются члены `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-875">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="b4ae8-876">Описание этих членов см. в разделе <xref:System.Text.RegularExpressions.RegexOptions>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-876">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="b4ae8-877">В регулярных выражениях применяются разделители и токены, аналогичные используемым функцией маршрутизации и в языке C#.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-877">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="b4ae8-878">Токены регулярного выражения должны быть экранированы.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-878">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="b4ae8-879">Чтобы использовать регулярное выражение `^\d{3}-\d{2}-\d{4}$` при маршрутизации, выражение должно иметь символы `\` (обратная косая черта), представленные в строке в виде символов `\\` (двойная обратная косая черта) в исходном файле C#, для экранирования escape-символов строки `\` (если не используются [буквальные строковые литералы](/dotnet/csharp/language-reference/keywords/string)).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-879">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in routing, the expression must have the `\` (single backslash) characters provided in the string as `\\` (double backslash) characters in the C# source file in order to escape the `\` string escape character (unless using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string)).</span></span> <span data-ttu-id="b4ae8-880">Чтобы экранировать символы разделения параметров маршрутизации (`{`, `}`, `[`, `]`), используйте их дважды в выражении (`{{`, `}`, `[[`, `]]`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-880">To escape routing parameter delimiter characters (`{`, `}`, `[`, `]`), double the characters in the expression (`{{`, `}`, `[[`, `]]`).</span></span> <span data-ttu-id="b4ae8-881">В следующей таблице показаны регулярные выражения и их экранированные варианты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-881">The following table shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="b4ae8-882">Регулярное выражение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-882">Regular Expression</span></span>    | <span data-ttu-id="b4ae8-883">Экранированное регулярное выражение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-883">Escaped Regular Expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="b4ae8-884">Регулярные выражения, используемые при маршрутизации, часто начинаются с символа карета (`^`) и соответствуют начальной позиции строки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-884">Regular expressions used in routing often start with the caret (`^`) character and match starting position of the string.</span></span> <span data-ttu-id="b4ae8-885">Выражения часто заканчиваются знаком доллара (`$`) и соответствуют концу строки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-885">The expressions often end with the dollar sign (`$`) character and match end of the string.</span></span> <span data-ttu-id="b4ae8-886">Благодаря символам `^` и `$` регулярное выражение сопоставляется со всем значением параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-886">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="b4ae8-887">Если символы `^` и `$` отсутствуют, регулярное выражение сопоставляется с любой подстрокой внутри строки, что обычно нежелательно.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-887">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="b4ae8-888">В следующей таблице представлен ряд примеров и объясняются причины соответствия или несоответствия.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-888">The following table provides examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="b4ae8-889">Выражение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-889">Expression</span></span>   | <span data-ttu-id="b4ae8-890">Строка</span><span class="sxs-lookup"><span data-stu-id="b4ae8-890">String</span></span>    | <span data-ttu-id="b4ae8-891">Соответствие</span><span class="sxs-lookup"><span data-stu-id="b4ae8-891">Match</span></span> | <span data-ttu-id="b4ae8-892">Добавление примечаний</span><span class="sxs-lookup"><span data-stu-id="b4ae8-892">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-893">hello</span><span class="sxs-lookup"><span data-stu-id="b4ae8-893">hello</span></span>     | <span data-ttu-id="b4ae8-894">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-894">Yes</span></span>   | <span data-ttu-id="b4ae8-895">Соответствие подстроки</span><span class="sxs-lookup"><span data-stu-id="b4ae8-895">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-896">123abc456</span><span class="sxs-lookup"><span data-stu-id="b4ae8-896">123abc456</span></span> | <span data-ttu-id="b4ae8-897">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-897">Yes</span></span>   | <span data-ttu-id="b4ae8-898">Соответствие подстроки</span><span class="sxs-lookup"><span data-stu-id="b4ae8-898">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-899">mz</span><span class="sxs-lookup"><span data-stu-id="b4ae8-899">mz</span></span>        | <span data-ttu-id="b4ae8-900">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-900">Yes</span></span>   | <span data-ttu-id="b4ae8-901">Соответствует выражению</span><span class="sxs-lookup"><span data-stu-id="b4ae8-901">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-902">MZ</span><span class="sxs-lookup"><span data-stu-id="b4ae8-902">MZ</span></span>        | <span data-ttu-id="b4ae8-903">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-903">Yes</span></span>   | <span data-ttu-id="b4ae8-904">Без учета регистра</span><span class="sxs-lookup"><span data-stu-id="b4ae8-904">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="b4ae8-905">hello</span><span class="sxs-lookup"><span data-stu-id="b4ae8-905">hello</span></span>     | <span data-ttu-id="b4ae8-906">Нет</span><span class="sxs-lookup"><span data-stu-id="b4ae8-906">No</span></span>    | <span data-ttu-id="b4ae8-907">См. замечания, касающиеся символов `^` и `$`, выше</span><span class="sxs-lookup"><span data-stu-id="b4ae8-907">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="b4ae8-908">123abc456</span><span class="sxs-lookup"><span data-stu-id="b4ae8-908">123abc456</span></span> | <span data-ttu-id="b4ae8-909">Нет</span><span class="sxs-lookup"><span data-stu-id="b4ae8-909">No</span></span>    | <span data-ttu-id="b4ae8-910">См. замечания, касающиеся символов `^` и `$`, выше</span><span class="sxs-lookup"><span data-stu-id="b4ae8-910">See `^` and `$` above</span></span> |

<span data-ttu-id="b4ae8-911">Дополнительные сведения о синтаксисе регулярных выражений см. в статье [Регулярные выражения в .NET Framework](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-911">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="b4ae8-912">Чтобы ограничить возможные значения параметра набором известных значений, используйте регулярное выражение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-912">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="b4ae8-913">Например, при использовании выражения `{action:regex(^(list|get|create)$)}` значение маршрута `action` будет соответствовать только `list`, `get` или `create`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-913">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="b4ae8-914">При передаче в словарь ограничений строка `^(list|get|create)$` будет эквивалентной.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-914">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="b4ae8-915">Ограничения, которые передаются в словарь ограничений (то есть не являются встроенными ограничениями шаблона) и не соответствуют одному из известных ограничений, также рассматриваются как регулярные выражения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-915">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="custom-route-constraints"></a><span data-ttu-id="b4ae8-916">Пользовательские ограничения маршрутов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-916">Custom Route Constraints</span></span>

<span data-ttu-id="b4ae8-917">Помимо встроенных ограничений маршрутов пользовательские ограничения маршрутов можно создать путем внедрения интерфейса <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-917">In addition to the built-in route constraints, custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="b4ae8-918">Интерфейс <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> содержит один метод, `Match`, который возвращает `true`, если ограничение удовлетворяется, и `false` — если нет.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-918">The <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface contains a single method, `Match`, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="b4ae8-919">Чтобы применить пользовательский метод <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, тип ограничения маршрута необходимо зарегистрировать с помощью <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> приложения в контейнере службы приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-919">To use a custom <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the app's service container.</span></span> <span data-ttu-id="b4ae8-920">Объект <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> — это словарь, который сопоставляет ключи ограничений пути с реализациями <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, которые проверяют эти ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-920">A <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> is a dictionary that maps route constraint keys to <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> implementations that validate those constraints.</span></span> <span data-ttu-id="b4ae8-921"><xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> приложения можно преобразовать в `Startup.ConfigureServices` как часть вызова [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) или путем настройки <xref:Microsoft.AspNetCore.Routing.RouteOptions> непосредственно с помощью `services.Configure<RouteOptions>`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-921">An app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="b4ae8-922">Например:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-922">For example:</span></span>

```csharp
services.AddRouting(options =>
{
    options.ConstraintMap.Add("customName", typeof(MyCustomConstraint));
});
```

<span data-ttu-id="b4ae8-923">Ограничения могут применяться к маршрутам обычным способом с использованием имени, указанного при регистрации типа ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-923">The constraint can then be applied to routes in the usual manner, using the name specified when registering the constraint type.</span></span> <span data-ttu-id="b4ae8-924">Например:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-924">For example:</span></span>

```csharp
[HttpGet("{id:customName}")]
public ActionResult<string> Get(string id)
```

## <a name="parameter-transformer-reference"></a><span data-ttu-id="b4ae8-925">Справочник по преобразователям параметров</span><span class="sxs-lookup"><span data-stu-id="b4ae8-925">Parameter transformer reference</span></span>

<span data-ttu-id="b4ae8-926">Преобразователи параметров:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-926">Parameter transformers:</span></span>

* <span data-ttu-id="b4ae8-927">Выполняются при формировании ссылки для <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-927">Execute when generating a link for a <xref:Microsoft.AspNetCore.Routing.Route>.</span></span>
* <span data-ttu-id="b4ae8-928">Реализуйте расширение `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-928">Implement `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span></span>
* <span data-ttu-id="b4ae8-929">Настраиваются с помощью <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-929">Are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>
* <span data-ttu-id="b4ae8-930">Принимают значение маршрута параметра и изменяют его на новое строковое значение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-930">Take the parameter's route value and transform it to a new string value.</span></span>
* <span data-ttu-id="b4ae8-931">Приводят к использованию преобразованного значения в сформированной ссылке.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-931">Result in using the transformed value in the generated link.</span></span>

<span data-ttu-id="b4ae8-932">Например, пользовательский преобразователь параметра `slugify` в шаблоне маршрута `blog\{article:slugify}` с `Url.Action(new { article = "MyTestArticle" })` формирует значение `blog\my-test-article`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-932">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span>

<span data-ttu-id="b4ae8-933">Чтобы использовать преобразователь параметров в шаблоне маршрута, сначала настройте его с помощью <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> в `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-933">To use a parameter transformer in a route pattern, configure it first using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddRouting(options =>
{
    // Replace the type and the name used to refer to it with your own
    // IOutboundParameterTransformer implementation
    options.ConstraintMap["slugify"] = typeof(SlugifyParameterTransformer);
});
```

<span data-ttu-id="b4ae8-934">Преобразователи параметров также используются платформами для преобразования URI, где разрешается конечная точка.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-934">Parameter transformers are used by the framework to transform the URI where an endpoint resolves.</span></span> <span data-ttu-id="b4ae8-935">Например, ASP.NET Core MVC с помощью преобразователей параметров преобразует значение маршрута, используемое для сопоставления `area`, `controller`, `action` и `page`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-935">For example, ASP.NET Core MVC uses parameter transformers to transform the route value used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller:slugify=Home}/{action:slugify=Index}/{id?}");
```

<span data-ttu-id="b4ae8-936">С помощью предыдущего маршрута действие `SubscriptionManagementController.GetAll()` сопоставляется с URI `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-936">With the preceding route, the action `SubscriptionManagementController.GetAll()` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="b4ae8-937">Преобразователь параметра не изменяет значения маршрута, используемые для формирования ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-937">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="b4ae8-938">Например, `Url.Action("GetAll", "SubscriptionManagement")` выводит `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-938">For example, `Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="b4ae8-939">ASP.NET Core предоставляет соглашения об API для использования преобразователей параметров со сформированными маршрутами:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-939">ASP.NET Core provides API conventions for using a parameter transformers with generated routes:</span></span>

* <span data-ttu-id="b4ae8-940">ASP.NET Core MVC поддерживает соглашение об API `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-940">ASP.NET Core MVC has the `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API convention.</span></span> <span data-ttu-id="b4ae8-941">Это соглашение применяет указанный преобразователь параметров ко всем маршрутам атрибутов в приложении.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-941">This convention applies a specified parameter transformer to all attribute routes in the app.</span></span> <span data-ttu-id="b4ae8-942">Преобразователь параметров преобразует маркеры маршрутов атрибутов по мере их замены.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-942">The parameter transformer transforms attribute route tokens as they are replaced.</span></span> <span data-ttu-id="b4ae8-943">Дополнительные сведения см. в разделе об [использовании преобразователя параметров для настройки замены маркеров](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-943">For more information, see [Use a parameter transformer to customize token replacement](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span></span>
* <span data-ttu-id="b4ae8-944">Razor Pages поддерживает соглашение об API `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-944">Razor Pages has the `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention` API convention.</span></span> <span data-ttu-id="b4ae8-945">Это соглашение применяет указанный преобразователь параметров ко всем автоматически обнаруженным страницам Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-945">This convention applies a specified parameter transformer to all automatically discovered Razor Pages.</span></span> <span data-ttu-id="b4ae8-946">Преобразователь параметров преобразует сегменты папок и имен файлов маршрутов Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-946">The parameter transformer transforms the folder and file name segments of Razor Pages routes.</span></span> <span data-ttu-id="b4ae8-947">Дополнительные сведения см. в разделе об [использовании преобразователя параметров для настройки маршрутов страниц](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-947">For more information, see [Use a parameter transformer to customize page routes](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span></span>

## <a name="url-generation-reference"></a><span data-ttu-id="b4ae8-948">Справочник по формированию URL-адресов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-948">URL generation reference</span></span>

<span data-ttu-id="b4ae8-949">В приведенном ниже примере показано, как создать ссылку на маршрут с использованием словаря значений маршрута и коллекции <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-949">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

<span data-ttu-id="b4ae8-950">В результате приведенного выше примера создается <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> со значением `/package/create/123`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-950">The <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="b4ae8-951">Словарь предоставляет значения маршрута `operation` и `id` шаблона "Отслеживание маршрута пакета", `package/{operation}/{id}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-951">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="b4ae8-952">Дополнительные сведения см. в примере кода в разделе [Использование ПО промежуточного слоя маршрутизации](#use-routing-middleware) или в [примере приложения](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-952">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="b4ae8-953">Второй параметр конструктора <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> — это коллекция *значений окружения*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-953">The second parameter to the <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="b4ae8-954">Значения окружения упрощают разработку, ограничивая число значений, которые необходимо указывать в определенном контексте запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-954">Ambient values are convenient to use because they limit the number of values a developer must specify within a request context.</span></span> <span data-ttu-id="b4ae8-955">Текущие значения маршрута текущего запроса считаются значениями окружения для создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-955">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="b4ae8-956">В приложении ASP.NET MVC в действии `About` контроллера `HomeController` не нужно задавать значение маршрута контроллера, указывающее на действие `Index` &mdash; используется значение окружения `Home`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-956">In an ASP.NET Core MVC app's `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="b4ae8-957">Значения окружения, которые не соответствуют параметру, игнорируются.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-957">Ambient values that don't match a parameter are ignored.</span></span> <span data-ttu-id="b4ae8-958">Значения окружения также не учитываются, когда явно указанное значение переопределяет значение окружения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-958">Ambient values are also ignored when an explicitly provided value overrides the ambient value.</span></span> <span data-ttu-id="b4ae8-959">Сопоставление выполняется слева направо в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-959">Matching occurs from left to right in the URL.</span></span>

<span data-ttu-id="b4ae8-960">Явно предоставленные значения, которые не соответствуют сегменту маршрута, добавляются в строку запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-960">Values explicitly provided but that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="b4ae8-961">В приведенной ниже таблице показан результат использования шаблона маршрута `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-961">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="b4ae8-962">Значения окружения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-962">Ambient Values</span></span>                     | <span data-ttu-id="b4ae8-963">Явные значения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-963">Explicit Values</span></span>                        | <span data-ttu-id="b4ae8-964">Результат</span><span class="sxs-lookup"><span data-stu-id="b4ae8-964">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="b4ae8-965">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-965">controller = "Home"</span></span>                | <span data-ttu-id="b4ae8-966">action = "About"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-966">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="b4ae8-967">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-967">controller = "Home"</span></span>                | <span data-ttu-id="b4ae8-968">controller = "Order", action = "About"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-968">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="b4ae8-969">controller = "Home", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-969">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="b4ae8-970">action = "About"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-970">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="b4ae8-971">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-971">controller = "Home"</span></span>                | <span data-ttu-id="b4ae8-972">action = "About", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-972">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="b4ae8-973">Если маршрут имеет значение по умолчанию, которое не соответствует параметру, и это значение предоставлено явным образом, оно должно соответствовать значению по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-973">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="b4ae8-974">Для этого маршрута ссылка будет создана только в том случае, если предоставлены соответствующие значения для `controller` и `action`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-974">Link generation only generates a link for this route when the matching values for `controller` and `action` are provided.</span></span>

## <a name="complex-segments"></a><span data-ttu-id="b4ae8-975">Сложные сегменты</span><span class="sxs-lookup"><span data-stu-id="b4ae8-975">Complex segments</span></span>

<span data-ttu-id="b4ae8-976">Сложные сегменты (например, `[Route("/x{token}y")]`) обрабатываются путем "нежадного" сопоставления литералов справа налево.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-976">Complex segments (for example `[Route("/x{token}y")]`) are processed by matching up literals from right to left in a non-greedy way.</span></span> <span data-ttu-id="b4ae8-977">Подробные сведения о сопоставлении сложных сегментов см. в [этом коде](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-977">See [this code](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) for a detailed explanation of how complex segments are matched.</span></span> <span data-ttu-id="b4ae8-978">[Пример кода](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) не используется в ASP.NET Core, но он предоставляет подробное объяснение сложных сегментов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-978">The [code sample](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) is not used by ASP.NET Core, but it provides a good explanation of complex segments.</span></span>
<!-- While that code is no longer used by ASP.NET Core for complex segment matching, it provides a good match to the current algorithm. The [current code](https://github.com/aspnet/AspNetCore/blob/91514c9af7e0f4c44029b51f05a01c6fe4c96e4c/src/Http/Routing/src/Matching/DfaMatcherBuilder.cs#L227-L244) is too abstracted from matching to be useful for understanding complex segment matching.
-->

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="b4ae8-979">Маршрутизация отвечает за сопоставление URI запросов с обработчиками маршрутов и отправку входящих запросов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-979">Routing is responsible for mapping request URIs to route handlers and dispatching an incoming requests.</span></span> <span data-ttu-id="b4ae8-980">Маршруты определяются в приложении и настраиваются при его запуске.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-980">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="b4ae8-981">Маршрут может также извлекать значения из содержащегося в запросе URL-адреса, которые затем используются для обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-981">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="b4ae8-982">С помощью настроенных маршрутов из приложения маршрутизация создает URL-адреса, которые сопоставляются с обработчиками маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-982">Using configured routes from the app, routing is able to generate URLs that map to route handlers.</span></span>

<span data-ttu-id="b4ae8-983">Чтобы использовать новейшие сценарии маршрутизации в ASP.NET Core 2.1, укажите [совместимую версию](xref:mvc/compatibility-version) для регистрации служб MVC в `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-983">To use the latest routing scenarios in ASP.NET Core 2.1, specify the [compatibility version](xref:mvc/compatibility-version) to the MVC services registration in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc()
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_1);
```

> [!IMPORTANT]
> <span data-ttu-id="b4ae8-984">В этом документе рассматривается низкоуровневая маршрутизация ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-984">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="b4ae8-985">Сведения о маршрутизации ASP.NET Core MVC см. в разделе <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-985">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span> <span data-ttu-id="b4ae8-986">Сведения о соглашениях о маршрутизации в Razor Pages см. в разделе <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-986">For information on routing conventions in Razor Pages, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="b4ae8-987">[Просмотреть или скачать образец кода](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([как скачивать](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="b4ae8-987">[View or download sample code](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="b4ae8-988">Основы маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-988">Routing basics</span></span>

<span data-ttu-id="b4ae8-989">Для большинства приложений следует выбрать базовую описательную схему маршрутизации таким образом, чтобы URL-адреса были удобочитаемыми и осмысленными.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-989">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="b4ae8-990">Традиционный маршрут по умолчанию `{controller=Home}/{action=Index}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-990">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="b4ae8-991">Поддерживает основную и описательную схемы маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-991">Supports a basic and descriptive routing scheme.</span></span>
* <span data-ttu-id="b4ae8-992">Является отправной точкой для приложений на базе пользовательского интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-992">Is a useful starting point for UI-based apps.</span></span>

<span data-ttu-id="b4ae8-993">Как правило, в зонах приложения с высоким трафиком и в особых случаях (например, конечные точки блога, интернет-магазина) добавляются дополнительные краткие маршруты с использованием [маршрутизации с помощью атрибутов](xref:mvc/controllers/routing#attribute-routing) или выделенные традиционные маршруты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-993">Developers commonly add additional terse routes to high-traffic areas of an app in specialized situations (for example, blog and ecommerce endpoints) using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span>

<span data-ttu-id="b4ae8-994">Веб-интерфейсы API должны использовать маршрутизацию с помощью атрибутов, чтобы моделировать функциональность приложения в качестве набора ресурсов, где операции представлены с помощью команд HTTP.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-994">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="b4ae8-995">Это означает, что многие операции (например, GET, POST) на одном логическом ресурсе будут использовать одинаковый URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-995">This means that many operations (for example, GET, POST) on the same logical resource will use the same URL.</span></span> <span data-ttu-id="b4ae8-996">Маршрутизация с помощью атрибутов обеспечивает необходимый уровень контроля, позволяющий тщательно разработать схему общедоступных конечных точек API-интерфейса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-996">Attribute routing provides a level of control that's needed to carefully design an API's public endpoint layout.</span></span>

<span data-ttu-id="b4ae8-997">Приложения Razor Pages используют стандартную маршрутизацию по умолчанию для предоставления именованных ресурсов в папке *Pages* приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-997">Razor Pages apps use default conventional routing to serve named resources in the *Pages* folder of an app.</span></span> <span data-ttu-id="b4ae8-998">Доступны дополнительные соглашения, которые позволяют настроить поведение маршрутизации Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-998">Additional conventions are available that allow you to customize Razor Pages routing behavior.</span></span> <span data-ttu-id="b4ae8-999">Дополнительные сведения см. в разделах <xref:razor-pages/index> и <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-999">For more information, see <xref:razor-pages/index> and <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="b4ae8-1000">Благодаря поддержке создания URL-адресов приложение можно разрабатывать без жесткого программирования URL-адресов для связывания компонентов приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1000">URL generation support allows the app to be developed without hard-coding URLs to link the app together.</span></span> <span data-ttu-id="b4ae8-1001">Это обеспечивает начало работы с основной конфигурацией маршрутизации и изменение маршрутов после определения схемы ресурсов приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1001">This support allows for starting with a basic routing configuration and modifying the routes after the app's resource layout is determined.</span></span>

<span data-ttu-id="b4ae8-1002">Маршрутизация использует *маршруты* (реализации интерфейса <xref:Microsoft.AspNetCore.Routing.IRouter>) в следующих целях:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1002">Routing uses *routes* (implementations of <xref:Microsoft.AspNetCore.Routing.IRouter>) to:</span></span>

* <span data-ttu-id="b4ae8-1003">для сопоставления входящих запросов с *обработчиками маршрутов*;</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1003">Map incoming requests to *route handlers*.</span></span>
* <span data-ttu-id="b4ae8-1004">для создания URL-адресов, используемых в ответах.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1004">Generate the URLs used in responses.</span></span>

<span data-ttu-id="b4ae8-1005">По умолчанию приложение имеет одну коллекцию маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1005">By default, an app has a single collection of routes.</span></span> <span data-ttu-id="b4ae8-1006">Когда запрос прибывает, маршруты в коллекции обрабатываются в порядке, в котором они существуют в коллекции.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1006">When a request arrives, the routes in the collection are processed in the order that they exist in the collection.</span></span> <span data-ttu-id="b4ae8-1007">Платформа пытается сопоставить URL-адрес входящего запроса с маршрутом в коллекции, вызывая метод <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> для каждого маршрута в коллекции.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1007">The framework attempts to match an incoming request URL to a route in the collection by calling the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in the collection.</span></span> <span data-ttu-id="b4ae8-1008">Отклик может использовать маршрутизацию для формирования URL-адресов (например, для перенаправления или ссылок) на основе сведений о маршруте, что позволяет избежать жесткого задания URL-адресов и упрощает поддержку.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1008">A response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid hard-coded URLs, which helps maintainability.</span></span>

<span data-ttu-id="b4ae8-1009">Система маршрутизации обладает следующими характеристиками:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1009">The routing system has the following characteristics:</span></span>

* <span data-ttu-id="b4ae8-1010">Синтаксис шаблона маршрута используется для определения маршрутов с помощью параметров размеченного маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1010">Route template syntax is used to define routes with tokenized route parameters.</span></span>
* <span data-ttu-id="b4ae8-1011">Допускается конфигурация конечной точки в стандартном стиле и с атрибутами.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1011">Conventional-style and attribute-style endpoint configuration is permitted.</span></span>
* <span data-ttu-id="b4ae8-1012"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> используется для определения того, содержит ли параметр URL-адреса допустимое значение для ограничения заданной конечной точки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1012"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> is used to determine whether a URL parameter contains a valid value for a given endpoint constraint.</span></span>
* <span data-ttu-id="b4ae8-1013">Модели приложения, такие как MVC и Razor Pages, регистрируют все свои маршруты, имеющие предсказуемую реализацию сценариев маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1013">App models, such as MVC/Razor Pages, register all of their routes, which have a predictable implementation of routing scenarios.</span></span>
* <span data-ttu-id="b4ae8-1014">Отклик может использовать маршрутизацию для формирования URL-адресов (например, для перенаправления или ссылок) на основе сведений о маршруте, что позволяет избежать жесткого задания URL-адресов и упрощает поддержку.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1014">A response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid hard-coded URLs, which helps maintainability.</span></span>
* <span data-ttu-id="b4ae8-1015">Формирование URL-адреса основано на маршрутах, которые поддерживают произвольную расширяемость.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1015">URL generation is based on routes, which support arbitrary extensibility.</span></span> <span data-ttu-id="b4ae8-1016"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> предоставляет методы для создания URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1016"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offers methods to build URLs.</span></span>

<span data-ttu-id="b4ae8-1017">Функция маршрутизации подключается к конвейеру [ПО промежуточного слоя](xref:fundamentals/middleware/index) с помощью класса <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1017">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="b4ae8-1018">[ASP.NET Core MVC](xref:mvc/overview) добавляет функцию маршрутизации в конвейер ПО промежуточного слоя в процессе настройки и обрабатывает маршрутизацию в приложениях MVC и Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1018">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration and handles routing in MVC and Razor Pages apps.</span></span> <span data-ttu-id="b4ae8-1019">Сведения об использовании маршрутизации в виде отдельного компонента см. в руководстве по [использованию ПО промежуточного слоя маршрутизации](#use-routing-middleware).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1019">To learn how to use routing as a standalone component, see the [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="b4ae8-1020">Соответствие URL-адресов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1020">URL matching</span></span>

<span data-ttu-id="b4ae8-1021">Соответствие URL-адресов — это процесс, с помощью которого функция маршрутизации отправляет входящий запрос в *обработчик*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1021">URL matching is the process by which routing dispatches an incoming request to a *handler*.</span></span> <span data-ttu-id="b4ae8-1022">Этот процесс основывается на данных в пути URL-адреса, но может быть расширен для учета любых данных в запросе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1022">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="b4ae8-1023">Возможность отправки запросов в отдельные обработчики имеет первостепенное значение для масштабирования размера и сложности приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1023">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="b4ae8-1024">Входящие запросы поступают в объект <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>, который вызывает метод <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> для каждого маршрута по порядку.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1024">Incoming requests enter the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>, which calls the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in sequence.</span></span> <span data-ttu-id="b4ae8-1025">Экземпляр <xref:Microsoft.AspNetCore.Routing.IRouter> решает, следует ли *обрабатывать* запрос, присваивая свойству [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) значение <xref:Microsoft.AspNetCore.Http.RequestDelegate>, отличное от NULL.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1025">The <xref:Microsoft.AspNetCore.Routing.IRouter> instance chooses whether to *handle* the request by setting the [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) to a non-null <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="b4ae8-1026">Если маршрут задает обработчик для запроса, обработка маршрутов останавливается и обработчик вызывается для обработки запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1026">If a route sets a handler for the request, route processing stops, and the handler is invoked to process the request.</span></span> <span data-ttu-id="b4ae8-1027">Если обработчик маршрута для обработки запроса не найден, ПО промежуточного слоя передает запрос следующему ПО промежуточного слоя в конвейере запросов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1027">If no route handler is found to process the request, the middleware hands the request off to the next middleware in the request pipeline.</span></span>

<span data-ttu-id="b4ae8-1028">Основные входные данные метода <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> — это объект [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*), связанный с текущим запросом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1028">The primary input to <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is the [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*) associated with the current request.</span></span> <span data-ttu-id="b4ae8-1029">[RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler) и [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) — это выходные значения, заданные после нахождения соответствующего маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1029">The [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler) and [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) are outputs set after a route is matched.</span></span>

<span data-ttu-id="b4ae8-1030">При нахождении соответствия, которое вызывает <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*>, свойствам [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) также присваиваются значения с учетом уже выполненной на текущий момент обработки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1030">A match that calls <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> also sets the properties of the [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) to appropriate values based on the request processing performed thus far.</span></span>

<span data-ttu-id="b4ae8-1031">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) — это словарь *значений маршрута*, полученных из маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1031">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="b4ae8-1032">Как правило, эти значения определяются путем разбивки URL-адреса на сегменты и могут использоваться для принятия входных данных пользователя или принятия дальнейших решений об отправке в приложении.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1032">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="b4ae8-1033">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) — это контейнер свойств с дополнительными данными, связанными с соответствующим маршрутом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1033">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="b4ae8-1034">Свойства <xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> обеспечивают связывание данных состояния с каждым маршрутом, что позволяет приложению принимать решения в зависимости от соответствующего маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1034"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> are provided to support associating state data with each route so that the app can make decisions based on which route matched.</span></span> <span data-ttu-id="b4ae8-1035">Эти значения определяются разработчиком и никоим образом **не** влияют на поведение маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1035">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="b4ae8-1036">Кроме того, значения, спрятанные в токенах [RouteData.DataToken](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*), могут быть любого типа в отличие от значений [RouteData.Value](xref:Microsoft.AspNetCore.Routing.RouteData.Values), которые должны легко преобразовываться в строки и из строк.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1036">Additionally, values stashed in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) can be of any type, in contrast to [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), which must be convertible to and from strings.</span></span>

<span data-ttu-id="b4ae8-1037">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) — это список маршрутов, которые участвовали в успешном сопоставлении с запросом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1037">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="b4ae8-1038">Маршруты могут быть вложены друг в друга.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1038">Routes can be nested inside of one another.</span></span> <span data-ttu-id="b4ae8-1039">Свойство <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> отражает путь по логическому дереву маршрутов, который привел к совпадению.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1039">The <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="b4ae8-1040">Как правило, первый элемент в свойстве <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> — это коллекция маршрутов, используемая для формирования URL-адресов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1040">Generally, the first item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="b4ae8-1041">Последний элемент в свойстве <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> — это соответствующий обработчик маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1041">The last item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route handler that matched.</span></span>

<a name="lg"></a>

### <a name="url-generation"></a><span data-ttu-id="b4ae8-1042">Формирование URL-адреса</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1042">URL generation</span></span>

<span data-ttu-id="b4ae8-1043">Формирование URL-адреса — это процесс создания пути URL-адреса функцией маршрутизации на основе набора значений маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1043">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="b4ae8-1044">Он обеспечивает логическое разделение обработчиков маршрутов и URL-адресов, которые получают к ним доступ.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1044">This allows for a logical separation between route handlers and the URLs that access them.</span></span>

<span data-ttu-id="b4ae8-1045">Формирование URL-адреса — это итеративный процесс, который начинается с того, что пользовательский код или код платформы вызывает метод <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> коллекции маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1045">URL generation follows a similar iterative process, but it starts with user or framework code calling into the <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method of the route collection.</span></span> <span data-ttu-id="b4ae8-1046">Метод <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> каждого *маршрута* вызывается по очереди, пока не будет возвращен объект <xref:Microsoft.AspNetCore.Routing.VirtualPathData>, отличный от NULL.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1046">Each *route* has its <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method called in sequence until a non-null <xref:Microsoft.AspNetCore.Routing.VirtualPathData> is returned.</span></span>

<span data-ttu-id="b4ae8-1047">Основные входные параметры метода <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*>:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1047">The primary inputs to <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> are:</span></span>

* [<span data-ttu-id="b4ae8-1048">VirtualPathContext.HttpContext</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1048">VirtualPathContext.HttpContext</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext)
* [<span data-ttu-id="b4ae8-1049">VirtualPathContext.Values</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1049">VirtualPathContext.Values</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values)
* [<span data-ttu-id="b4ae8-1050">VirtualPathContext.AmbientValues</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1050">VirtualPathContext.AmbientValues</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues)

<span data-ttu-id="b4ae8-1051">Для определения возможности создания URL-адреса и включаемых значений в первую очередь используются значения, передаваемые в свойствах <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> и <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1051">Routes primarily use the route values provided by <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> and <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> to decide whether it's possible to generate a URL and what values to include.</span></span> <span data-ttu-id="b4ae8-1052"><xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> — это набор значений маршрута, полученных в результате сопоставления текущего запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1052">The <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> are the set of route values that were produced from matching the current request.</span></span> <span data-ttu-id="b4ae8-1053">В свою очередь, <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> — это значения, определяющие способ создания нужного URL-адреса для текущей операции.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1053">In contrast, <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> are the route values that specify how to generate the desired URL for the current operation.</span></span> <span data-ttu-id="b4ae8-1054"><xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext> предоставляется в том случае, если маршруту необходимо получить службы или дополнительные данные, связанные с текущим контекстом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1054">The <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext> is provided in case a route should obtain services or additional data associated with the current context.</span></span>

> [!TIP]
> <span data-ttu-id="b4ae8-1055">Можно рассматривать [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) как набор переопределений для [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1055">Think of [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) as a set of overrides for the [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span></span> <span data-ttu-id="b4ae8-1056">При формировании URL-адреса производится попытка повторного использования значений маршрута из текущего запроса для создания URL-адресов для ссылок с помощью того же маршрута или значений маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1056">URL generation attempts to reuse route values from the current request to generate URLs for links using the same route or route values.</span></span>

<span data-ttu-id="b4ae8-1057">Выходные данные метода <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> содержатся в объекте <xref:Microsoft.AspNetCore.Routing.VirtualPathData>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1057">The output of <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> is a <xref:Microsoft.AspNetCore.Routing.VirtualPathData>.</span></span> <span data-ttu-id="b4ae8-1058">Объект <xref:Microsoft.AspNetCore.Routing.VirtualPathData> аналогичен <xref:Microsoft.AspNetCore.Routing.RouteData>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1058"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> is a parallel of <xref:Microsoft.AspNetCore.Routing.RouteData>.</span></span> <span data-ttu-id="b4ae8-1059"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> содержит <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> для выходного URL-адреса, а также ряд дополнительных свойств, которые должны быть заданы маршрутом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1059"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> contains the <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> for the output URL and some additional properties that should be set by the route.</span></span>

<span data-ttu-id="b4ae8-1060">Свойство [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) содержит *виртуальный путь*, создаваемый маршрутом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1060">The [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) property contains the *virtual path* produced by the route.</span></span> <span data-ttu-id="b4ae8-1061">В зависимости от ситуации путь может требовать дальнейшей обработки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1061">Depending on your needs, you may need to process the path further.</span></span> <span data-ttu-id="b4ae8-1062">Чтобы представить созданный URL-адрес в формате HTML, добавьте в его начало базовый путь приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1062">If you want to render the generated URL in HTML, prepend the base path of the app.</span></span>

<span data-ttu-id="b4ae8-1063">[VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) — это ссылка на маршрут, который успешно создал URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1063">The [VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) is a reference to the route that successfully generated the URL.</span></span>

<span data-ttu-id="b4ae8-1064">Свойства [VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) представляют собой словарь дополнительных данных, связанных с маршрутом, который создал URL-адрес.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1064">The [VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) properties is a dictionary of additional data related to the route that generated the URL.</span></span> <span data-ttu-id="b4ae8-1065">Это эквивалент объекта [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1065">This is the parallel of [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span></span>

### <a name="create-routes"></a><span data-ttu-id="b4ae8-1066">Создание маршрутов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1066">Create routes</span></span>

<span data-ttu-id="b4ae8-1067">Маршрутизация предоставляет класс <xref:Microsoft.AspNetCore.Routing.Route> в качестве стандартной реализации <xref:Microsoft.AspNetCore.Routing.IRouter>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1067">Routing provides the <xref:Microsoft.AspNetCore.Routing.Route> class as the standard implementation of <xref:Microsoft.AspNetCore.Routing.IRouter>.</span></span> <span data-ttu-id="b4ae8-1068">Класс <xref:Microsoft.AspNetCore.Routing.Route> использует синтаксис *шаблона маршрута* для определения шаблонов, которые будут сопоставляться с путем URL-адреса при вызове метода <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1068"><xref:Microsoft.AspNetCore.Routing.Route> uses the *route template* syntax to define patterns to match against the URL path when <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is called.</span></span> <span data-ttu-id="b4ae8-1069">При вызове метода <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> объект <xref:Microsoft.AspNetCore.Routing.Route> будет использовать тот же шаблон маршрута для создания URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1069"><xref:Microsoft.AspNetCore.Routing.Route> uses the same route template to generate a URL when <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> is called.</span></span>

<span data-ttu-id="b4ae8-1070">Большинство приложений создают маршруты, вызывая метод <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> или один из аналогичных методов расширения, определенных в интерфейсе <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1070">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="b4ae8-1071">Все методы расширения <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> создают экземпляр <xref:Microsoft.AspNetCore.Routing.Route> и добавляют его в коллекцию маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1071">Any of the <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> extension methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="b4ae8-1072"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> не принимает параметр обработчика маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1072"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> doesn't accept a route handler parameter.</span></span> <span data-ttu-id="b4ae8-1073"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> только добавляет маршруты, которые обрабатываются <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1073"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="b4ae8-1074">Обработчиком по умолчанию является `IRouter`, и обработчик может не обработать запрос.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1074">The default handler is an `IRouter`, and the handler might not handle the request.</span></span> <span data-ttu-id="b4ae8-1075">Например, ASP.NET Core MVC обычно настраивается в качестве обработчика по умолчанию, который обрабатывает только те запросы, которые соответствуют доступным контроллеру и действию.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1075">For example, ASP.NET Core MVC is typically configured as a default handler that only handles requests that match an available controller and action.</span></span> <span data-ttu-id="b4ae8-1076">Дополнительные сведения о маршрутизации в MVC см. в разделе <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1076">To learn more about routing in MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="b4ae8-1077">В следующем коде приводится пример вызова <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*>, используемого в типичном определении маршрута ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1077">The following code example is an example of a <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="b4ae8-1078">Этот шаблон соответствует пути URL-адреса и извлекает значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1078">This template matches a URL path and extracts the route values.</span></span> <span data-ttu-id="b4ae8-1079">Например, путь `/Products/Details/17` создает следующие значения маршрута: `{ controller = Products, action = Details, id = 17 }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1079">For example, the path `/Products/Details/17` generates the following route values: `{ controller = Products, action = Details, id = 17 }`.</span></span>

<span data-ttu-id="b4ae8-1080">Значения маршрута определяются с помощью разделения пути URL-адреса на сегменты и сопоставления каждого сегмента с именем *параметра маршрута* в шаблоне маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1080">Route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="b4ae8-1081">Параметры маршрута являются именованными.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1081">Route parameters are named.</span></span> <span data-ttu-id="b4ae8-1082">Параметры определяются путем заключения имени параметра в фигурные скобки `{ ... }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1082">The parameters defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="b4ae8-1083">Приведенный выше шаблон может также соответствовать пути URL-адреса `/`. В этом случае он предоставляет значения `{ controller = Home, action = Index }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1083">The preceding template could also match the URL path `/` and produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="b4ae8-1084">Связано это с тем, что параметры маршрута `{controller}` и `{action}` имеют значения по умолчанию, а параметр маршрута `id` является необязательным.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1084">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="b4ae8-1085">Значение по умолчанию для параметра маршрута определяется с помощью знака равенства (`=`), за которым следует значение после имени параметра.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1085">An equals sign (`=`) followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="b4ae8-1086">Вопросительный знак (`?`) после имени параметра маршрута определяет параметр как необязательный.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1086">A question mark (`?`) after the route parameter name defines an optional parameter.</span></span>

<span data-ttu-id="b4ae8-1087">Параметры маршрута со значением по умолчанию *всегда* предоставляют значения маршрута при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1087">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="b4ae8-1088">Необязательные параметры не предоставляют значение маршрута, если нет соответствующего сегмента пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1088">Optional parameters don't produce a route value if there was no corresponding URL path segment.</span></span> <span data-ttu-id="b4ae8-1089">Подробное описание сценариев и синтаксиса шаблона маршрута см. в разделе [Справочник по шаблонам маршрутов](#route-template-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1089">See the [Route template reference](#route-template-reference) section for a thorough description of route template scenarios and syntax.</span></span>

<span data-ttu-id="b4ae8-1090">В следующем примере в определении параметра маршрута `{id:int}` определяется [ограничение маршрута](#route-constraint-reference) для параметра маршрута `id`:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1090">In the following example, the route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="b4ae8-1091">Этот шаблон соответствует такому пути URL-адреса, как `/Products/Details/17`, но не `/Products/Details/Apples`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1091">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="b4ae8-1092">Ограничения маршрута реализуют интерфейс <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> и проверяют значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1092">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="b4ae8-1093">В этом примере значение маршрута `id` должно иметь возможность преобразования в целое число.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1093">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="b4ae8-1094">Более подробное описание ограничений маршрутов, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1094">See [route-constraint-reference](#route-constraint-reference) for an explanation of route constraints provided by the framework.</span></span>

<span data-ttu-id="b4ae8-1095">Дополнительные перегрузки <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> принимают значения для параметров `constraints`, `dataTokens` и `defaults`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1095">Additional overloads of <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="b4ae8-1096">Типичное применение этих параметров состоит в передаче анонимно типизированного объекта, причем имена свойств анонимного типа соответствуют именам параметров маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1096">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="b4ae8-1097">В следующих примерах <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> создаются эквивалентные маршруты:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1097">The following <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="b4ae8-1098">Встроенный синтаксис определения ограничений и значений по умолчанию может быть удобнее для простых маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1098">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="b4ae8-1099">Однако некоторые сценарии, например токены данных, не поддерживаются встроенным синтаксисом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1099">However, there are scenarios, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="b4ae8-1100">В следующем примере показано еще несколько сценариев:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1100">The following example demonstrates a few additional scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{*article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="b4ae8-1101">Предыдущий шаблон соответствует такому пути URL-адреса, как `/Blog/All-About-Routing/Introduction`, и извлекает значения `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1101">The preceding template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="b4ae8-1102">Значения маршрута по умолчанию для `controller` и `action` предоставляются маршрутом несмотря на то, что в шаблоне нет соответствующих параметров маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1102">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="b4ae8-1103">Значения по умолчанию можно указать в шаблоне маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1103">Default values can be specified in the route template.</span></span> <span data-ttu-id="b4ae8-1104">Параметр маршрута `article` определяется как *универсальный* с помощью звездочки (`*`) перед его именем.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1104">The `article` route parameter is defined as a *catch-all* by the appearance of an asterisk (`*`) before the route parameter name.</span></span> <span data-ttu-id="b4ae8-1105">Универсальные параметры маршрута служат для фиксации оставшейся части пути URL-адреса, а также могут соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1105">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="b4ae8-1106">В следующем примере добавляются ограничения маршрута и токены данных:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1106">The following example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="b4ae8-1107">Предыдущий шаблон будет соответствовать такому пути URL-адреса, как `/en-US/Products/5`, и будет извлекать значения `{ controller = Products, action = Details, id = 5 }` и токены данных `{ locale = en-US }`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1107">The preceding template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![Токены в окне "Локальные"](routing/_static/tokens.png)

### <a name="route-class-url-generation"></a><span data-ttu-id="b4ae8-1109">Формирование URL-адреса класса маршрута</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1109">Route class URL generation</span></span>

<span data-ttu-id="b4ae8-1110">Класс <xref:Microsoft.AspNetCore.Routing.Route> может также формировать URL-адрес, объединяя набор значений маршрута с шаблоном маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1110">The <xref:Microsoft.AspNetCore.Routing.Route> class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="b4ae8-1111">С логической точки зрения, этот процесс обратен сопоставлению пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1111">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="b4ae8-1112">Чтобы лучше понять процесс формирования URL-адреса, представьте себе, какой URL-адрес нужно создать, а затем подумайте, как шаблон маршрута будет сопоставляться с этим URL-адресом.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1112">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="b4ae8-1113">Какие значения будут получены?</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1113">What values would be produced?</span></span> <span data-ttu-id="b4ae8-1114">Примерно так производится формирование URL-адреса в классе <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1114">This is the rough equivalent of how URL generation works in the <xref:Microsoft.AspNetCore.Routing.Route> class.</span></span>

<span data-ttu-id="b4ae8-1115">В следующем примере используется общий маршрут по умолчанию ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1115">The following example uses a general ASP.NET Core MVC default route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="b4ae8-1116">При значениях маршрута `{ controller = Products, action = List }` создается URL-адрес `/Products/List`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1116">With the route values `{ controller = Products, action = List }`, the URL `/Products/List` is generated.</span></span> <span data-ttu-id="b4ae8-1117">Значения маршрута заменяются на соответствующие параметры маршрута для образования пути URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1117">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="b4ae8-1118">Так как `id` является необязательным параметром маршрута, URL-адрес успешно создается без значения для `id`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1118">Since `id` is an optional route parameter, the URL is successfully generated without a value for `id`.</span></span>

<span data-ttu-id="b4ae8-1119">При значениях маршрута `{ controller = Home, action = Index }` создается URL-адрес `/`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1119">With the route values `{ controller = Home, action = Index }`, the URL `/` is generated.</span></span> <span data-ttu-id="b4ae8-1120">Предоставленные значения маршрута соответствуют значениям по умолчанию, поэтому сегменты, соответствующие значениям по умолчанию, можно спокойно опустить.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1120">The provided route values match the default values, and the segments corresponding to the default values are safely omitted.</span></span>

<span data-ttu-id="b4ae8-1121">Оба созданных URL-адреса будут совершать круговой путь с таким же определением маршрута (`/Home/Index` и `/`) и предоставлять те же значения маршрута, которые использовались для формирования URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1121">Both URLs generated round-trip with the following route definition (`/Home/Index` and `/`) produce the same route values that were used to generate the URL.</span></span>

> [!NOTE]
> <span data-ttu-id="b4ae8-1122">Приложение, использующее платформу ASP.NET Core MVC, должно создавать URL-адреса с помощью объекта <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper>, а не вызывать маршрутизацию напрямую.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1122">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="b4ae8-1123">Дополнительные сведения о формировании URL-адресов см. в [справочнике по формированию URL-адресов](#url-generation-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1123">For more information on URL generation, see the [Url generation reference](#url-generation-reference) section.</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="b4ae8-1124">Использование ПО промежуточного слоя маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1124">Use Routing Middleware</span></span>

<span data-ttu-id="b4ae8-1125">Ссылка на [метапакет Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) в файле проекта приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1125">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

<span data-ttu-id="b4ae8-1126">Добавьте маршрутизацию в контейнер службы в файле `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1126">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

<span data-ttu-id="b4ae8-1127">Маршруты должны настраиваться в методе `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1127">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="b4ae8-1128">В этом примере приложения используются следующие API:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1128">The sample app uses the following APIs:</span></span>

* <xref:Microsoft.AspNetCore.Routing.RouteBuilder>
* <span data-ttu-id="b4ae8-1129"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> &ndash; — соответствует только HTTP-запросам GET.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1129"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> &ndash; Matches only HTTP GET requests.</span></span>
* <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

<span data-ttu-id="b4ae8-1130">В таблице ниже приведены ответы с данными универсальными кодами ресурсов (URI).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1130">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="b4ae8-1131">URI</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1131">URI</span></span>                    | <span data-ttu-id="b4ae8-1132">Ответ</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1132">Response</span></span>                                          |
| ---------------------- | ------------------------------------------------- |
| `/package/create/3`    | <span data-ttu-id="b4ae8-1133">Hello!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1133">Hello!</span></span> <span data-ttu-id="b4ae8-1134">Значения маршрута: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1134">Route values: [operation, create], [id, 3]</span></span> |
| `/package/track/-3`    | <span data-ttu-id="b4ae8-1135">Hello!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1135">Hello!</span></span> <span data-ttu-id="b4ae8-1136">Значения маршрута: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1136">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/-3/`   | <span data-ttu-id="b4ae8-1137">Hello!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1137">Hello!</span></span> <span data-ttu-id="b4ae8-1138">Значения маршрута: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1138">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/`      | <span data-ttu-id="b4ae8-1139">Запрос не дал результата, нет совпадений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1139">The request falls through, no match.</span></span>              |
| `GET /hello/Joe`       | <span data-ttu-id="b4ae8-1140">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1140">Hi, Joe!</span></span>                                          |
| `POST /hello/Joe`      | <span data-ttu-id="b4ae8-1141">Запрос не дал результата, совпадение только с HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1141">The request falls through, matches HTTP GET only.</span></span> |
| `GET /hello/Joe/Smith` | <span data-ttu-id="b4ae8-1142">Запрос не дал результата, нет совпадений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1142">The request falls through, no match.</span></span>              |

<span data-ttu-id="b4ae8-1143">Если вы настраиваете один маршрут, вызовите <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>, передав экземпляр `IRouter`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1143">If you're configuring a single route, call <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> passing in an `IRouter` instance.</span></span> <span data-ttu-id="b4ae8-1144">Использовать <xref:Microsoft.AspNetCore.Routing.RouteBuilder> не нужно.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1144">You won't need to use <xref:Microsoft.AspNetCore.Routing.RouteBuilder>.</span></span>

<span data-ttu-id="b4ae8-1145">Платформа предоставляет наборов методов расширения для создания маршрутов (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1145">The framework provides a set of extension methods for creating routes (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span></span>

* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareVerb*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>

<span data-ttu-id="b4ae8-1146">Некоторые из перечисленных методов, такие как <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>, требуют <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1146">Some of listed methods, such as <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>, require a <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="b4ae8-1147"><xref:Microsoft.AspNetCore.Http.RequestDelegate> используется в качестве *обработчика маршрутов* при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1147">The <xref:Microsoft.AspNetCore.Http.RequestDelegate> is used as the *route handler* when the route matches.</span></span> <span data-ttu-id="b4ae8-1148">Другие методы из этого семейства позволяют настраивать конвейер ПО промежуточного слоя, который будет использоваться в качестве обработчика маршрутов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1148">Other methods in this family allow configuring a middleware pipeline for use as the route handler.</span></span> <span data-ttu-id="b4ae8-1149">Если метод `Map*` не принимает обработчик, например <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>, он будет использовать объект <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1149">If the `Map*` method doesn't accept a handler, such as <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>, it uses the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span>

<span data-ttu-id="b4ae8-1150">Методы `Map[Verb]` используют ограничения, чтобы ограничить маршрут к HTTP-команде в имени метода.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1150">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="b4ae8-1151">Например, см. класс <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> и тип <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1151">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="b4ae8-1152">Справочник по шаблону маршрута</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1152">Route template reference</span></span>

<span data-ttu-id="b4ae8-1153">Токены в фигурных скобках (`{ ... }`) определяют *параметры маршрута*, которые будут привязаны при совпадении маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1153">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="b4ae8-1154">В сегменте маршрута можно определить несколько параметров маршрута, но они должны разделяться литеральным значением.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1154">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="b4ae8-1155">Например, `{controller=Home}{action=Index}` будет недопустимым маршрутом, так как между `{controller}` и `{action}` нет литерального значения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1155">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="b4ae8-1156">Эти параметры маршрута должны иметь имена, и для них могут быть определены дополнительные атрибуты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1156">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="b4ae8-1157">Весь текст, кроме параметров маршрута (например, `{id}`) и разделителя пути `/`, должен соответствовать тексту в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1157">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="b4ae8-1158">Сопоставление текста производится без учета регистра на основе декодированного представления путь URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1158">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="b4ae8-1159">Для сопоставления с литеральным разделителем параметров маршрута (`{` или `}`) разделитель следует экранировать путем повтора символа (`{{` или `}}`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1159">To match a literal route parameter delimiter (`{` or `}`), escape the delimiter by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="b4ae8-1160">Шаблоны URL-адресов, которые пытаются получить имя файла с необязательным расширением, имеют свои особенности.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1160">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="b4ae8-1161">Например, рассмотрим шаблон `files/{filename}.{ext?}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1161">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="b4ae8-1162">Когда значения для `filename` и `ext` существуют, заполняются оба значения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1162">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="b4ae8-1163">Если в URL-адресе есть только значение для `filename`, маршрут совпадает, так как точка в конце (`.`) является необязательной.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1163">If only a value for `filename` exists in the URL, the route matches because the trailing period (`.`) is  optional.</span></span> <span data-ttu-id="b4ae8-1164">Следующие URL-адреса соответствуют этому маршруту:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1164">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="b4ae8-1165">Вы можете использовать звездочку (`*`) в качестве префикса параметра маршрута для привязки к остальной части URI.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1165">You can use the asterisk (`*`) as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="b4ae8-1166">Такой параметр называется *универсальным*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1166">This is called a *catch-all* parameter.</span></span> <span data-ttu-id="b4ae8-1167">Например, `blog/{*slug}` соответствует любому URI, начинающемуся с сегмента `/blog`, за которым следует любое значение, присваиваемое в качестве значения маршрута `slug`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1167">For example, `blog/{*slug}` matches any URI that starts with `/blog` and has any value following it, which is assigned to the `slug` route value.</span></span> <span data-ttu-id="b4ae8-1168">Универсальные параметры также могут соответствовать пустой строке.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1168">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="b4ae8-1169">Универсальный параметр экранирует соответствующие символы, если маршрут использует для формирования URL-адрес, включая символы разделителей пути (`/`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1169">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="b4ae8-1170">Например, маршрут `foo/{*path}` со значениями маршрутов `{ path = "my/path" }` формирует `foo/my%2Fpath`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1170">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="b4ae8-1171">Обратите внимание на экранированный знак косой черты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1171">Note the escaped forward slash.</span></span>

<span data-ttu-id="b4ae8-1172">Параметры маршрута могут иметь *значения по умолчанию*. Они указываются после имени параметра и знака равенства (`=`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1172">Route parameters may have *default values* designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="b4ae8-1173">Например, `{controller=Home}` определяет `Home` в качестве значения по умолчанию для `controller`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1173">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="b4ae8-1174">Значение по умолчанию используется, если для параметра нет значения в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1174">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="b4ae8-1175">Параметры маршрута могут быть необязательными (для этого необходимо добавить вопросительный знак (`?`) в конец имени параметра, например `id?`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1175">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="b4ae8-1176">Различие между необязательными параметрами и параметрами маршрута по умолчанию в том, что вторые всегда имеют значения &mdash; необязательный параметр имеет значение, только если оно предоставлено URL-адресом запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1176">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value&mdash;an optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="b4ae8-1177">Параметры маршрута могут иметь ограничения, которые должны соответствовать значению маршрута из URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1177">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="b4ae8-1178">Добавив двоеточие (`:`) и имя ограничения после имени параметра маршрута, можно указать *встроенные ограничения* для параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1178">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="b4ae8-1179">Если для ограничения требуются аргументы, они указываются в скобках (`(...)`) после имени ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1179">If the constraint requires arguments, they're enclosed in parentheses (`(...)`) after the constraint name.</span></span> <span data-ttu-id="b4ae8-1180">Чтобы указать несколько встроенных ограничений, добавьте еще одно двоеточие (`:`) и имя ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1180">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span>

<span data-ttu-id="b4ae8-1181">Имя и аргументы ограничения передаются в службу <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> для создания экземпляра интерфейса <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, который будет использоваться при обработке URL-адреса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1181">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="b4ae8-1182">Например, в шаблоне маршрута `blog/{article:minlength(10)}` определяется ограничение `minlength` с аргументом `10`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1182">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="b4ae8-1183">Более подробное описание ограничений маршрутов и список ограничений, предоставляемых платформой, см. в разделе [Справочник по ограничениям маршрутов](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1183">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="b4ae8-1184">В приведенной ниже таблице показаны некоторые примеры шаблонов маршрутов и их поведение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1184">The following table demonstrates example route templates and their behavior.</span></span>

| <span data-ttu-id="b4ae8-1185">Шаблон маршрута</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1185">Route Template</span></span>                           | <span data-ttu-id="b4ae8-1186">Пример соответствующего URI</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1186">Example Matching URI</span></span>    | <span data-ttu-id="b4ae8-1187">URI запроса&hellip;</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1187">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="b4ae8-1188">Соответствует только одному пути `/hello`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1188">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="b4ae8-1189">Соответствует и задает для параметра `Page` значение `Home`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1189">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="b4ae8-1190">Соответствует и задает для параметра `Page` значение `Contact`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1190">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="b4ae8-1191">Сопоставляется с контроллером `Products` и действием `List`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1191">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="b4ae8-1192">Сопоставляется с контроллером `Products` и действием `Details` (`id` имеет значение 123).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1192">Maps to the `Products` controller and  `Details` action (`id` set to 123).</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="b4ae8-1193">Сопоставляется с контроллером `Home` и методом `Index` (`id` пропускается).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1193">Maps to the `Home` controller and `Index` method (`id` is ignored).</span></span>        |

<span data-ttu-id="b4ae8-1194">Использование шаблона — это, как правило, самый простой подход к маршрутизации.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1194">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="b4ae8-1195">Ограничения и значения по умолчанию также могут указываться вне шаблона маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1195">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="b4ae8-1196">Чтобы увидеть, как встроенные реализации маршрутизации, такие как <xref:Microsoft.AspNetCore.Routing.Route>, сопоставляются с запросами, включите [ведение журнала](xref:fundamentals/logging/index).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1196">Enable [Logging](xref:fundamentals/logging/index) to see how the built-in routing implementations, such as <xref:Microsoft.AspNetCore.Routing.Route>, match requests.</span></span>

## <a name="reserved-routing-names"></a><span data-ttu-id="b4ae8-1197">Зарезервированные имена маршрутизации</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1197">Reserved routing names</span></span>

<span data-ttu-id="b4ae8-1198">Следующие ключевые слова являются зарезервированными именами и не могут использоваться как имена маршрутов или параметры:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1198">The following keywords are reserved names and can't be used as route names or parameters:</span></span>

* `action`
* `area`
* `controller`
* `handler`
* `page`

## <a name="route-constraint-reference"></a><span data-ttu-id="b4ae8-1199">Справочник по ограничениям маршрутов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1199">Route constraint reference</span></span>

<span data-ttu-id="b4ae8-1200">Ограничения маршрута применяются, когда найдено соответствие входящему URL-адресу и путь URL-адреса был разобран на значения маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1200">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="b4ae8-1201">Как правило, ограничения маршрута служат для проверки значения маршрута, связанного посредством шаблона маршрута, и принятия решения касательно того, является ли значение приемлемым (да или нет).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1201">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="b4ae8-1202">Некоторые ограничения маршрута используют данные, не относящиеся к значению маршрута, для определения возможности маршрутизации запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1202">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="b4ae8-1203">Например, <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> может принимать или отклонять запрос в зависимости от HTTP-команды.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1203">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="b4ae8-1204">Ограничения используются в маршрутизации запросов и создании ссылок.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1204">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="b4ae8-1205">Не используйте ограничения для **проверки входных данных**.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1205">Don't use constraints for **input validation**.</span></span> <span data-ttu-id="b4ae8-1206">Если ограничения используются для **проверки входных данных**, недопустимые входные данные будут вызывать ошибку *404 (не найдено)* вместо ошибки *400 (неверный запрос)* с соответствующим сообщением.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1206">If constraints are used for **input validation**, invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="b4ae8-1207">Ограничения маршрутов следует использовать для **разрешения неоднозначности** похожих маршрутов, а не для проверки входных данных определенного маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1207">Route constraints are used to **disambiguate** similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="b4ae8-1208">В приведенной ниже таблице показаны примеры ограничения маршрутов и их ожидаемое поведение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1208">The following table demonstrates example route constraints and their expected behavior.</span></span>

| <span data-ttu-id="b4ae8-1209">ограничение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1209">constraint</span></span> | <span data-ttu-id="b4ae8-1210">Пример</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1210">Example</span></span> | <span data-ttu-id="b4ae8-1211">Примеры совпадений</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1211">Example Matches</span></span> | <span data-ttu-id="b4ae8-1212">Примечания</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1212">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="b4ae8-1213">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1213">`123456789`, `-123456789`</span></span> | <span data-ttu-id="b4ae8-1214">Соответствует любому целому числу</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1214">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="b4ae8-1215">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1215">`true`, `FALSE`</span></span> | <span data-ttu-id="b4ae8-1216">Соответствует `true` или `false` (без учета регистра)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1216">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="b4ae8-1217">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1217">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="b4ae8-1218">Соответствует допустимому значению `DateTime` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1218">Matches a valid `DateTime` value (in the invariant culture - see warning)</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="b4ae8-1219">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1219">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="b4ae8-1220">Соответствует допустимому значению `decimal` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1220">Matches a valid `decimal` value (in the invariant culture - see warning)</span></span> |
| `double` | `{weight:double}` | <span data-ttu-id="b4ae8-1221">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1221">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="b4ae8-1222">Соответствует допустимому значению `double` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1222">Matches a valid `double` value (in the invariant culture - see warning)</span></span> |
| `float` | `{weight:float}` | <span data-ttu-id="b4ae8-1223">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1223">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="b4ae8-1224">Соответствует допустимому значению `float` (для инвариантного языка и региональных параметров — см. предупреждение)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1224">Matches a valid `float` value (in the invariant culture - see warning)</span></span> |
| `guid` | `{id:guid}` | <span data-ttu-id="b4ae8-1225">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1225">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="b4ae8-1226">Соответствует допустимому значению `Guid`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1226">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="b4ae8-1227">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1227">`123456789`, `-123456789`</span></span> | <span data-ttu-id="b4ae8-1228">Соответствует допустимому значению `long`</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1228">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="b4ae8-1229">Строка должна содержать не менее 4 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1229">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="b4ae8-1230">Строка должна содержать не более 8 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1230">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="b4ae8-1231">Длина строки должна составлять ровно 12 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1231">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="b4ae8-1232">Строка должна содержать от 8 до 16 символов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1232">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="b4ae8-1233">Целочисленное значение не меньше 18</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1233">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="b4ae8-1234">Целочисленное значение не больше 120</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1234">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="b4ae8-1235">Целочисленное значение от 18 до 120</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1235">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="b4ae8-1236">Строка должна состоять из одной или нескольких букв (`a`-`z`, без учета регистра)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1236">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="b4ae8-1237">Строка должна соответствовать регулярному выражению (см. советы по определению регулярного выражения)</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1237">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="b4ae8-1238">Определяет обязательное наличие значения, не относящегося к параметру, во время формирования URL-адреса</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1238">Used to enforce that a non-parameter value is present during URL generation</span></span> |

<span data-ttu-id="b4ae8-1239">К одному параметру может применяться несколько разделенных запятой ограничений.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1239">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="b4ae8-1240">Например, следующее ограничение ограничивает параметр целочисленным значением 1 или больше:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1240">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="b4ae8-1241">Ограничения маршрута, которые проверяют URL-адрес и могут быть преобразованы в тип CLR (например, `int` или `DateTime`), всегда используют инвариантные язык и региональные параметры.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1241">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="b4ae8-1242">Эти ограничения предполагают, что URL-адрес является нелокализуемым.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1242">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="b4ae8-1243">Предоставляемые платформой ограничения маршрутов не изменяют значения, хранящиеся в значениях маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1243">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="b4ae8-1244">Все значения маршрута, переданные из URL-адреса, сохраняются как строки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1244">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="b4ae8-1245">Например, ограничение `float` пытается преобразовать значение маршрута в число с плавающей запятой, но преобразованное значение служит только для проверки возможности такого преобразования.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1245">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="b4ae8-1246">Регулярные выражения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1246">Regular expressions</span></span>

<span data-ttu-id="b4ae8-1247">В платформе ASP.NET Core в конструктор регулярных выражений добавляются члены `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1247">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="b4ae8-1248">Описание этих членов см. в разделе <xref:System.Text.RegularExpressions.RegexOptions>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1248">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="b4ae8-1249">В регулярных выражениях применяются разделители и токены, аналогичные используемым функцией маршрутизации и в языке C#.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1249">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="b4ae8-1250">Токены регулярного выражения должны быть экранированы.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1250">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="b4ae8-1251">Чтобы использовать регулярное выражение `^\d{3}-\d{2}-\d{4}$` при маршрутизации, выражение должно иметь символы `\` (обратная косая черта), представленные в строке в виде символов `\\` (двойная обратная косая черта) в исходном файле C#, для экранирования escape-символов строки `\` (если не используются [буквальные строковые литералы](/dotnet/csharp/language-reference/keywords/string)).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1251">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in routing, the expression must have the `\` (single backslash) characters provided in the string as `\\` (double backslash) characters in the C# source file in order to escape the `\` string escape character (unless using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string)).</span></span> <span data-ttu-id="b4ae8-1252">Чтобы экранировать символы разделения параметров маршрутизации (`{`, `}`, `[`, `]`), используйте их дважды в выражении (`{{`, `}`, `[[`, `]]`).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1252">To escape routing parameter delimiter characters (`{`, `}`, `[`, `]`), double the characters in the expression (`{{`, `}`, `[[`, `]]`).</span></span> <span data-ttu-id="b4ae8-1253">В следующей таблице показаны регулярные выражения и их экранированные варианты.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1253">The following table shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="b4ae8-1254">Регулярное выражение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1254">Regular Expression</span></span>    | <span data-ttu-id="b4ae8-1255">Экранированное регулярное выражение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1255">Escaped Regular Expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="b4ae8-1256">Регулярные выражения, используемые при маршрутизации, часто начинаются с символа карета (`^`) и соответствуют начальной позиции строки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1256">Regular expressions used in routing often start with the caret (`^`) character and match starting position of the string.</span></span> <span data-ttu-id="b4ae8-1257">Выражения часто заканчиваются знаком доллара (`$`) и соответствуют концу строки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1257">The expressions often end with the dollar sign (`$`) character and match end of the string.</span></span> <span data-ttu-id="b4ae8-1258">Благодаря символам `^` и `$` регулярное выражение сопоставляется со всем значением параметра маршрута.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1258">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="b4ae8-1259">Если символы `^` и `$` отсутствуют, регулярное выражение сопоставляется с любой подстрокой внутри строки, что обычно нежелательно.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1259">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="b4ae8-1260">В следующей таблице представлен ряд примеров и объясняются причины соответствия или несоответствия.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1260">The following table provides examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="b4ae8-1261">Выражение</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1261">Expression</span></span>   | <span data-ttu-id="b4ae8-1262">Строка</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1262">String</span></span>    | <span data-ttu-id="b4ae8-1263">Соответствие</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1263">Match</span></span> | <span data-ttu-id="b4ae8-1264">Добавление примечаний</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1264">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-1265">hello</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1265">hello</span></span>     | <span data-ttu-id="b4ae8-1266">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1266">Yes</span></span>   | <span data-ttu-id="b4ae8-1267">Соответствие подстроки</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1267">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-1268">123abc456</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1268">123abc456</span></span> | <span data-ttu-id="b4ae8-1269">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1269">Yes</span></span>   | <span data-ttu-id="b4ae8-1270">Соответствие подстроки</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1270">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-1271">mz</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1271">mz</span></span>        | <span data-ttu-id="b4ae8-1272">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1272">Yes</span></span>   | <span data-ttu-id="b4ae8-1273">Соответствует выражению</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1273">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="b4ae8-1274">MZ</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1274">MZ</span></span>        | <span data-ttu-id="b4ae8-1275">Yes</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1275">Yes</span></span>   | <span data-ttu-id="b4ae8-1276">Без учета регистра</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1276">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="b4ae8-1277">hello</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1277">hello</span></span>     | <span data-ttu-id="b4ae8-1278">Нет</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1278">No</span></span>    | <span data-ttu-id="b4ae8-1279">См. замечания, касающиеся символов `^` и `$`, выше</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1279">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="b4ae8-1280">123abc456</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1280">123abc456</span></span> | <span data-ttu-id="b4ae8-1281">Нет</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1281">No</span></span>    | <span data-ttu-id="b4ae8-1282">См. замечания, касающиеся символов `^` и `$`, выше</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1282">See `^` and `$` above</span></span> |

<span data-ttu-id="b4ae8-1283">Дополнительные сведения о синтаксисе регулярных выражений см. в статье [Регулярные выражения в .NET Framework](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1283">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="b4ae8-1284">Чтобы ограничить возможные значения параметра набором известных значений, используйте регулярное выражение.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1284">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="b4ae8-1285">Например, при использовании выражения `{action:regex(^(list|get|create)$)}` значение маршрута `action` будет соответствовать только `list`, `get` или `create`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1285">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="b4ae8-1286">При передаче в словарь ограничений строка `^(list|get|create)$` будет эквивалентной.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1286">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="b4ae8-1287">Ограничения, которые передаются в словарь ограничений (то есть не являются встроенными ограничениями шаблона) и не соответствуют одному из известных ограничений, также рассматриваются как регулярные выражения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1287">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="custom-route-constraints"></a><span data-ttu-id="b4ae8-1288">Пользовательские ограничения маршрутов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1288">Custom Route Constraints</span></span>

<span data-ttu-id="b4ae8-1289">Помимо встроенных ограничений маршрутов пользовательские ограничения маршрутов можно создать путем внедрения интерфейса <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1289">In addition to the built-in route constraints, custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="b4ae8-1290">Интерфейс <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> содержит один метод, `Match`, который возвращает `true`, если ограничение удовлетворяется, и `false` — если нет.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1290">The <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface contains a single method, `Match`, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="b4ae8-1291">Чтобы применить пользовательский метод <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, тип ограничения маршрута необходимо зарегистрировать с помощью <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> приложения в контейнере службы приложения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1291">To use a custom <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the app's service container.</span></span> <span data-ttu-id="b4ae8-1292">Объект <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> — это словарь, который сопоставляет ключи ограничений пути с реализациями <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, которые проверяют эти ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1292">A <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> is a dictionary that maps route constraint keys to <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> implementations that validate those constraints.</span></span> <span data-ttu-id="b4ae8-1293"><xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> приложения можно преобразовать в `Startup.ConfigureServices` как часть вызова [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) или путем настройки <xref:Microsoft.AspNetCore.Routing.RouteOptions> непосредственно с помощью `services.Configure<RouteOptions>`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1293">An app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="b4ae8-1294">Например:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1294">For example:</span></span>

```csharp
services.AddRouting(options =>
{
    options.ConstraintMap.Add("customName", typeof(MyCustomConstraint));
});
```

<span data-ttu-id="b4ae8-1295">Ограничения могут применяться к маршрутам обычным способом с использованием имени, указанного при регистрации типа ограничения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1295">The constraint can then be applied to routes in the usual manner, using the name specified when registering the constraint type.</span></span> <span data-ttu-id="b4ae8-1296">Например:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1296">For example:</span></span>

```csharp
[HttpGet("{id:customName}")]
public ActionResult<string> Get(string id)
```

## <a name="url-generation-reference"></a><span data-ttu-id="b4ae8-1297">Справочник по формированию URL-адресов</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1297">URL generation reference</span></span>

<span data-ttu-id="b4ae8-1298">В приведенном ниже примере показано, как создать ссылку на маршрут с использованием словаря значений маршрута и коллекции <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1298">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

<span data-ttu-id="b4ae8-1299">В результате приведенного выше примера создается <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> со значением `/package/create/123`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1299">The <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="b4ae8-1300">Словарь предоставляет значения маршрута `operation` и `id` шаблона "Отслеживание маршрута пакета", `package/{operation}/{id}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1300">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="b4ae8-1301">Дополнительные сведения см. в примере кода в разделе [Использование ПО промежуточного слоя маршрутизации](#use-routing-middleware) или в [примере приложения](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1301">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="b4ae8-1302">Второй параметр конструктора <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> — это коллекция *значений окружения*.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1302">The second parameter to the <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="b4ae8-1303">Значения окружения упрощают разработку, ограничивая число значений, которые необходимо указывать в определенном контексте запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1303">Ambient values are convenient to use because they limit the number of values a developer must specify within a request context.</span></span> <span data-ttu-id="b4ae8-1304">Текущие значения маршрута текущего запроса считаются значениями окружения для создания ссылки.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1304">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="b4ae8-1305">В приложении ASP.NET MVC в действии `About` контроллера `HomeController` не нужно задавать значение маршрута контроллера, указывающее на действие `Index` &mdash; используется значение окружения `Home`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1305">In an ASP.NET Core MVC app's `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="b4ae8-1306">Значения окружения, которые не соответствуют параметру, игнорируются.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1306">Ambient values that don't match a parameter are ignored.</span></span> <span data-ttu-id="b4ae8-1307">Значения окружения также не учитываются, когда явно указанное значение переопределяет значение окружения.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1307">Ambient values are also ignored when an explicitly provided value overrides the ambient value.</span></span> <span data-ttu-id="b4ae8-1308">Сопоставление выполняется слева направо в URL-адресе.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1308">Matching occurs from left to right in the URL.</span></span>

<span data-ttu-id="b4ae8-1309">Явно предоставленные значения, которые не соответствуют сегменту маршрута, добавляются в строку запроса.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1309">Values explicitly provided but that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="b4ae8-1310">В приведенной ниже таблице показан результат использования шаблона маршрута `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1310">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="b4ae8-1311">Значения окружения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1311">Ambient Values</span></span>                     | <span data-ttu-id="b4ae8-1312">Явные значения</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1312">Explicit Values</span></span>                        | <span data-ttu-id="b4ae8-1313">Результат</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1313">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="b4ae8-1314">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1314">controller = "Home"</span></span>                | <span data-ttu-id="b4ae8-1315">action = "About"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1315">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="b4ae8-1316">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1316">controller = "Home"</span></span>                | <span data-ttu-id="b4ae8-1317">controller = "Order", action = "About"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1317">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="b4ae8-1318">controller = "Home", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1318">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="b4ae8-1319">action = "About"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1319">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="b4ae8-1320">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1320">controller = "Home"</span></span>                | <span data-ttu-id="b4ae8-1321">action = "About", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1321">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="b4ae8-1322">Если маршрут имеет значение по умолчанию, которое не соответствует параметру, и это значение предоставлено явным образом, оно должно соответствовать значению по умолчанию:</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1322">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="b4ae8-1323">Для этого маршрута ссылка будет создана только в том случае, если предоставлены соответствующие значения для `controller` и `action`.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1323">Link generation only generates a link for this route when the matching values for `controller` and `action` are provided.</span></span>

## <a name="complex-segments"></a><span data-ttu-id="b4ae8-1324">Сложные сегменты</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1324">Complex segments</span></span>

<span data-ttu-id="b4ae8-1325">Сложные сегменты (например, `[Route("/x{token}y")]`) обрабатываются путем "нежадного" сопоставления литералов справа налево.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1325">Complex segments (for example `[Route("/x{token}y")]`) are processed by matching up literals from right to left in a non-greedy way.</span></span> <span data-ttu-id="b4ae8-1326">Подробные сведения о сопоставлении сложных сегментов см. в [этом коде](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293).</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1326">See [this code](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) for a detailed explanation of how complex segments are matched.</span></span> <span data-ttu-id="b4ae8-1327">[Пример кода](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) не используется в ASP.NET Core, но он предоставляет подробное объяснение сложных сегментов.</span><span class="sxs-lookup"><span data-stu-id="b4ae8-1327">The [code sample](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) is not used by ASP.NET Core, but it provides a good explanation of complex segments.</span></span>
<!-- While that code is no longer used by ASP.NET Core for complex segment matching, it provides a good match to the current algorithm. The [current code](https://github.com/aspnet/AspNetCore/blob/91514c9af7e0f4c44029b51f05a01c6fe4c96e4c/src/Http/Routing/src/Matching/DfaMatcherBuilder.cs#L227-L244) is too abstracted from matching to be useful for understanding complex segment matching.
-->

::: moniker-end
