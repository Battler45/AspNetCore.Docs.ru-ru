---
title: Основы ASP.NET Core
author: rick-anderson
description: Познакомьтесь с основными принципами создания приложений ASP.NET Core.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 09/06/2019
uid: fundamentals/index
ms.openlocfilehash: cff2afd62ed60648dc689d408dde56ecda18c261
ms.sourcegitcommit: 2d4c1732c4866ed26b83da35f7bc2ad021a9c701
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2019
ms.locfileid: "70815649"
---
# <a name="aspnet-core-fundamentals"></a>Основы ASP.NET Core

В этой статье приведен обзор основных тем, связанных с разработкой приложений ASP.NET Core.

## <a name="the-startup-class"></a>Класс Startup

В классе `Startup` делается следующее.

* Настраиваются службы, необходимые приложению.
* Определяется конвейер обработки запросов.

*Службы* — это компоненты, которые используются в приложении. Например, службой является компонент ведения журнала. Код для настройки (или *регистрации*) служб добавляется в метод `Startup.ConfigureServices`.

Конвейер обработки запросов состоит из ряда компонентов *ПО промежуточного* слоя. Например, это ПО может обрабатывать запросы для статических файлов или перенаправлять HTTP-запросы в HTTPS. Каждый компонент ПО промежуточного слоя выполняет асинхронные операции в `HttpContext`, а затем либо вызывает следующий компонент в конвейере, либо завершает запрос. Код для настройки конвейера обработки запросов добавляется в метод `Startup.Configure`.

Пример класса `Startup`:

[!code-csharp[](index/snapshots/2.x/Startup1.cs?highlight=3,12)]

Дополнительные сведения можно найти по адресу: <xref:fundamentals/startup>.

## <a name="dependency-injection-services"></a>Введение зависимостей (службы)

ASP.NET Core включает встроенную платформу внедрения зависимостей, позволяющую классам приложения обращаться к настроенным службам. Одним из вариантов получения экземпляра службы в классе является создание конструктора с параметром требуемого типа. Параметр может быть типом службы или интерфейсом. Система внедрения зависимостей предоставляет службу во время выполнения.

Ниже показан класс, который использует внедрение зависимостей для получения объекта контекста Entity Framework Core. Выделенная строка является примером внедрения через конструктор.

[!code-csharp[](index/snapshots/2.x/Index.cshtml.cs?highlight=5)]

Несмотря на то, что система внедрения зависимостей является встроенной, она позволяет вам при желании подключать сторонний контейнер с инверсией управления (IoC).

Дополнительные сведения можно найти по адресу: <xref:fundamentals/dependency-injection>.

## <a name="middleware"></a>ПО промежуточного слоя

Конвейер обработки запросов состоит из ряда компонентов ПО промежуточного слоя. Каждый компонент выполняет асинхронные операции в `HttpContext`, а затем либо вызывает следующий компонент в конвейере, либо завершает запрос.

По принятому соглашению компонент ПО промежуточного слоя добавляется в конвейер вызовом метода расширения `Use...` в методе `Startup.Configure`. Например, чтобы включить отрисовку статических файлов, вызовите `UseStaticFiles`.

Код настройки конвейера обработки запросов выделен в следующем примере:

[!code-csharp[](index/snapshots/2.x/Startup1.cs?highlight=14-16)]

ASP.NET Core включает обширный набор встроенного ПО промежуточного слоя и позволяет вам писать свое собственное.

Дополнительные сведения можно найти по адресу: <xref:fundamentals/middleware/index>.

## <a name="host"></a>Узел

Приложение ASP.NET Core создает *узел* при запуске. Узел — это объект, который инкапсулирует все ресурсы приложения.

* Реализация HTTP-сервера
* Компоненты ПО промежуточного слоя
* Ведение журнала
* Внедрение зависимостей
* Параметр Configuration

Основной причиной включения всех взаимозависимых ресурсов приложения в один объект является управление жизненным циклом: контроль запуска и корректного завершения работы приложения.

::: moniker range=">= aspnetcore-3.0"

Доступны два узла: универсальный узел и веб-узел. Универсальный узел является рекомендуемым вариантом, а веб-узел служит только для обеспечения обратной совместимости.

Код для создания узла находится в `Program.Main`:

[!code-csharp[](index/snapshots/3.x/Program1.cs)]

Методы `CreateDefaultBuilder` и `ConfigureWebHostDefaults` применяются для настройки узла с часто используемыми параметрами, например:

* Использование [Kestrel](#servers) в качестве веб-сервера и поддержка интеграции с IIS.
* Загрузка конфигурации из файлов *appsettings.json* и *appsettings.{имя среды}.json*, переменных среды, аргументов командной строки и других источников.
* Отправка выходных данных журнала в поставщики служб консоли и отладки.

Дополнительные сведения можно найти по адресу: <xref:fundamentals/host/generic-host>.

::: moniker-end

::: moniker range="< aspnetcore-3.0"

Доступны два узла: веб-узел и универсальный узел. В ASP.NET Core 2.x универсальный узел используется в сценариях, не связанных с Интернетом.

Код для создания узла находится в `Program.Main`:

[!code-csharp[](index/snapshots/2.x/Program1.cs)]

Метод `CreateDefaultBuilder` применяется для настройки узла с часто используемыми параметрами, например:

* Использование [Kestrel](#servers) в качестве веб-сервера и поддержка интеграции с IIS.
* Загрузка конфигурации из файлов *appsettings.json* и *appsettings.{имя среды}.json*, переменных среды, аргументов командной строки и других источников.
* Отправка выходных данных журнала в поставщики служб консоли и отладки.

Дополнительные сведения можно найти по адресу: <xref:fundamentals/host/web-host>.

::: moniker-end

### <a name="non-web-scenarios"></a>Сценарии, не связанные с Интернетом

Универсальный узел позволяет приложениям других типов использовать перекрестные расширения платформ, такие как средства ведения журналов, внедрения зависимостей, настройки и управления жизненным циклом. Дополнительные сведения см. в разделах <xref:fundamentals/host/generic-host> и <xref:fundamentals/host/hosted-services>.

## <a name="servers"></a>Серверы

Приложение ASP.NET Core использует реализацию HTTP-сервера для приема HTTP-запросов. Сервер отправляет приложению запросы в виде набора [функций запросов](xref:fundamentals/request-features), объединенных в `HttpContext`.

::: moniker range=">= aspnetcore-2.2"

# <a name="windowstabwindows"></a>[Windows](#tab/windows)

ASP.NET Core предоставляет следующие реализации серверов:

* *Kestrel* — это кроссплатформенный веб-сервер. Он часто запускается в реконфигурации прокси-сервера с помощью [IIS](https://www.iis.net/). В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет.
* *HTTP-сервер IIS* — это сервер для Windows, который использует службы IIS. Он позволяет запускать приложение ASP.NET Core и службы IIS в одном процессе.
* *HTTP.sys* — это сервер для Windows, который не используется со службами IIS.

# <a name="macostabmacos"></a>[macOS](#tab/macos)

ASP.NET Core предоставляет реализацию кроссплатформенного сервера *Kestrel*. В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет. Он часто запускается в реконфигурации прокси-сервера с помощью [Nginx](https://nginx.org) или [Apache](https://httpd.apache.org/).

# <a name="linuxtablinux"></a>[Linux](#tab/linux)

ASP.NET Core предоставляет реализацию кроссплатформенного сервера *Kestrel*. В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет. Он часто запускается в реконфигурации прокси-сервера с помощью [Nginx](https://nginx.org) или [Apache](https://httpd.apache.org/).

---

::: moniker-end

::: moniker range="< aspnetcore-2.2"

# <a name="windowstabwindows"></a>[Windows](#tab/windows)

ASP.NET Core предоставляет следующие реализации серверов:

* *Kestrel* — это кроссплатформенный веб-сервер. Он часто запускается в реконфигурации прокси-сервера с помощью [IIS](https://www.iis.net/). В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет.
* *HTTP.sys* — это сервер для Windows, который не используется со службами IIS.

# <a name="macostabmacos"></a>[macOS](#tab/macos)

ASP.NET Core предоставляет реализацию кроссплатформенного сервера *Kestrel*. В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет. Он часто запускается в реконфигурации прокси-сервера с помощью [Nginx](https://nginx.org) или [Apache](https://httpd.apache.org/).

# <a name="linuxtablinux"></a>[Linux](#tab/linux)

ASP.NET Core предоставляет реализацию кроссплатформенного сервера *Kestrel*. В ASP.NET Core 2.0 и более поздних версиях можно использовать Kestrel в роли общедоступного пограничного сервера с прямым доступом через Интернет. Он часто запускается в реконфигурации прокси-сервера с помощью [Nginx](https://nginx.org) или [Apache](https://httpd.apache.org/).

---

::: moniker-end

Дополнительные сведения можно найти по адресу: <xref:fundamentals/servers/index>.

## <a name="configuration"></a>Параметр Configuration

ASP.NET Core предоставляет платформу конфигурации, которая получает параметры в виде пар "имя-значение" от упорядоченного набора поставщиков конфигурации. Доступны встроенные поставщики конфигурации для различных источников, таких как файлы *JSON*, *XML*, переменные среды и аргументы командной строки. Кроме того, вы можете писать поставщики конфигурации сами.

Например, можно указать, что источником конфигурации являются файл *appsettings.json* и переменные среды. В этом случае при запросе значения *ConnectionString* платформа сначала выполнит поиск в файле *appsettings.json*. Если значение будет найдено не только в нем, но и в переменной среды, приоритет получит значение из переменной среды.

Для управления конфиденциальными данными конфигурации, например паролями, ASP.NET Core предоставляет специальный инструмент [Менеджер секретов](xref:security/app-secrets). Для секретов в рабочей среде рекомендуется использовать [Azure Key Vault](xref:security/key-vault-configuration).

Дополнительные сведения можно найти по адресу: <xref:fundamentals/configuration/index>.

## <a name="options"></a>Параметры

Когда это возможно, ASP.NET Core следует *шаблону параметров* для хранения и получения значений конфигурации. Шаблон параметров использует классы для представления групп связанных настроек.

Например, следующий код задает параметры WebSockets:

```csharp
var options = new WebSocketOptions  
{  
   KeepAliveInterval = TimeSpan.FromSeconds(120),  
   ReceiveBufferSize = 4096
};  
app.UseWebSockets(options);
```

Дополнительные сведения можно найти по адресу: <xref:fundamentals/configuration/options>.

## <a name="environments"></a>Среды

Среды выполнения, включая среду *разработки*, *промежуточную* и *рабочую* среды, являются ключевыми компонентами ASP.NET Core. Указать среду, в которой запускается приложение, можно с помощью переменной среды `ASPNETCORE_ENVIRONMENT`. ASP.NET Core считывает переменную среды при запуске приложения и сохраняет ее значение в реализации `IHostingEnvironment`. Объект среды можно получить в любом месте приложения при помощи внедрения зависимостей.

В следующем примере кода из класса `Startup` показана настройка приложения для вывода подробных сведений об ошибках исключительно при запуске в среде разработки:

[!code-csharp[](index/snapshots/2.x/Startup2.cs?highlight=3-6)]

Дополнительные сведения можно найти по адресу: <xref:fundamentals/environments>.

## <a name="logging"></a>Ведение журнала

ASP.NET Core поддерживает API ведения журналов, который работает с разными встроенными и сторонними поставщиками. Доступны следующие поставщики:

* Консоль
* Отладка
* Трассировка событий Windows
* Журнал событий Windows
* TraceSource
* Служба приложений Azure
* Azure Application Insights

Записи в журналы можно вносить в любом месте кода приложения. Для этого нужно получить объект `ILogger` из внедрения зависимостей и вызвать методы ведения журналов.

Ниже приведен пример кода, где используется объект `ILogger`. В коде выделены строки внедрения конструктора и вызова методов ведения журналов.

[!code-csharp[](index/snapshots/2.x/TodoController.cs?highlight=5,13,17)]

Интерфейс `ILogger` позволяет передавать в поставщик ведения журналов любое количество полей. Как правило, поля используются для создания строки сообщения, но поставщик также может отправлять их в хранилище данных в виде отдельных полей. Благодаря этому поставщики могут реализовывать [семантическое (структурированное) ведение журналов](https://softwareengineering.stackexchange.com/questions/312197/benefits-of-structured-logging-vs-basic-logging).

Дополнительные сведения можно найти по адресу: <xref:fundamentals/logging/index>.

## <a name="routing"></a>Маршрутизация

*Маршрут* — это шаблон URL-адреса, сопоставляемый с обработчиком. Обычно обработчик представляет собой страницу Razor, метод действия в контроллере MVC или ПО промежуточного слоя. Маршрутизация ASP.NET Core позволяет контролировать URL-адреса, используемые приложением.

Дополнительные сведения можно найти по адресу: <xref:fundamentals/routing>.

## <a name="error-handling"></a>Обработка ошибок

ASP.NET Core содержит встроенные функции обработки ошибок, такие как:

* Страница исключений для разработчика
* Настраиваемые страницы ошибок
* Статические страницы с кодами состояния
* Обработка исключений при запуске

Дополнительные сведения можно найти по адресу: <xref:fundamentals/error-handling>.

## <a name="make-http-requests"></a>Создание HTTP-запросов

ASP.NET Core включает реализацию интерфейса `IHttpClientFactory` для создания экземпляров `HttpClient`. Фабрика:

* Центральное расположение для именования и настройки логических экземпляров `HttpClient`. Например, можно зарегистрировать и использовать клиент *github* для доступа к GitHub. Можно зарегистрировать клиент по умолчанию для других целей.
* Поддержка регистрации и связывания в цепочки множества делегирующих обработчиков для создания конвейера ПО промежуточного слоя под исходящие запросы. Этот шаблон похож на входящий конвейер ПО промежуточного слоя в ASP.NET Core. Шаблон предоставляет механизм управления сквозной функциональностью HTTP-запросов, включая кэширование, обработку ошибок, сериализацию и ведение журнала.
* Интеграция с *Polly* — популярной сторонней библиотекой для обработки временных сбоев.
* Управление созданием пулов и временем существования базовых экземпляров `HttpClientMessageHandler` с целью избежать обычных проблем с DNS, которые возникают при управлении временем существования `HttpClient` вручную.
* Настройка параметров ведения журнала (через `ILogger`) для всех запросов, отправленных через клиентов, созданных фабрикой.

Дополнительные сведения можно найти по адресу: <xref:fundamentals/http-requests>.

## <a name="content-root"></a>Корневой каталог содержимого

Корень содержимого — это базовый путь к любому закрытому содержимому, например к файлам Razor, которое используется приложением. По умолчанию корень содержимого является базовым путем исполняемого файла приложения. Альтернативное расположение можно указать при [создании узла](#host).

::: moniker range=">= aspnetcore-3.0"

Дополнительные сведения: [Корень содержимого](xref:fundamentals/host/generic-host#content-root).

::: moniker-end

::: moniker range="< aspnetcore-3.0"

Дополнительные сведения: [Корень содержимого](xref:fundamentals/host/web-host#content-root).

::: moniker-end

## <a name="web-root"></a>Корневой веб-узел

Корневой каталог документов (*webroot*) — это базовый путь к общедоступным статическим ресурсам, включая CSS, JavaScript и файлы изображений. По умолчанию ПО промежуточного слоя статических файлов обслуживает только файлы из корневого каталога документов и его подкаталогов. По умолчанию используется путь *{корневой каталог содержимого}/wwwroot*. Альтернативное расположение можно задать при [создании узла](#host).

::: moniker range=">= aspnetcore-3.0"

См. дополнительные сведения о [WebRoot](/aspnet/core/fundamentals/host/generic-host?view=aspnetcore-3.0#webroot).

::: moniker-end

::: moniker range="< aspnetcore-3.0"

Дополнительные сведения см. в разделе [Корневой веб-каталог](/aspnet/core/fundamentals/host/web-host#webroot).

::: moniker-end

Для указания на корневой каталог файлов Razor (*CSHTML*) используется символ тильды и косой черты `~/`. Пути, начинающиеся с `~/`, называются виртуальными путями.

Дополнительные сведения можно найти по адресу: <xref:fundamentals/static-files>.
