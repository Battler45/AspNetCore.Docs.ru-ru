---
title: ASP.NET Core моделей размещения Блазор
author: guardrex
description: Общие сведения о моделях размещения Блазор на стороне клиента и на стороне сервера.
monikerRange: '>= aspnetcore-3.0'
ms.author: riande
ms.custom: mvc
ms.date: 09/05/2019
uid: blazor/hosting-models
ms.openlocfilehash: f7a16d64e1f874a4f6b3c8db5217810b13c7c6ff
ms.sourcegitcommit: 43c6335b5859282f64d66a7696c5935a2bcdf966
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/07/2019
ms.locfileid: "70800428"
---
# <a name="aspnet-core-blazor-hosting-models"></a>ASP.NET Core моделей размещения Блазор

По [Даниэль Roth)](https://github.com/danroth27)

Блазор — это веб-платформа, предназначенная для запуска на стороне клиента в браузере на среде выполнения .NET на основе веб- [сборки](https://webassembly.org/)(*блазор на стороне клиента*) или на стороне сервера в ASP.NET Core (*блазор на стороне сервера*). Независимо от модели размещения, модели приложения и компонента *одинаковы*.

Сведения о создании проекта для моделей размещения, описанных в этой статье, <xref:blazor/get-started>см. в разделе.

## <a name="client-side"></a>Компоненты на стороне клиента

Основная модель размещения для Блазор работает на стороне клиента в браузере на веб-сборке. Приложение Blazor, его зависимости и среда выполнения .NET скачиваются в браузере. Приложение выполняется непосредственно в потоке пользовательского интерфейса браузера. Обновления пользовательского интерфейса и обработка событий выполняются в рамках одного процесса. Ресурсы приложения развертываются как статические файлы на веб-сервере или в службе, способной обслуживать статические содержимое клиентам.

![Блазор на стороне клиента: Приложение Блазор выполняется в потоке пользовательского интерфейса в браузере.](hosting-models/_static/client-side.png)

Чтобы создать приложение Блазор с помощью клиентской модели размещения, используйте шаблон **приложения блазор для сборки** ([DotNet New блазорвасм](/dotnet/core/tools/dotnet-new)).

Выбрав шаблон **приложения блазор-Assembly** , вы можете настроить приложение для использования ASP.NET Core серверной части, установив флажок **ASP.NET Core размещения** ([DotNet New блазорвасм — Hosted](/dotnet/core/tools/dotnet-new)). ASP.NET Core приложение обслуживает приложения Блазор для клиентов. Клиентское приложение Блазор может взаимодействовать с сервером по сети с помощью вызовов веб-API или [SignalR](xref:signalr/introduction).

Шаблоны включают скрипт *блазор... js* , который обрабатывает:

* Загрузка среды выполнения .NET, приложения и зависимостей приложения.
* Инициализация среды выполнения для запуска приложения.

Модель размещения на стороне клиента предлагает несколько преимуществ:

* Зависимость на стороне сервера .NET отсутствует. Приложение полностью работает после загрузки на клиент.
* Ресурсы и возможности клиента полностью используются.
* Работа разгружается с сервера на клиент.
* Веб-сервер ASP.NET Core не требуется для размещения приложения. Возможны сценарии бессерверного развертывания (например, обслуживание приложения из CDN).

Существует недостаток для размещения на стороне клиента:

* Приложение ограничено возможностями браузера.
* Требуется аппаратное и программное обеспечение, поддерживающее клиент (например, поддержка сборок).
* Размер скачивания больше, и приложения загружаются дольше.
* Поддержка среды выполнения .NET и инструментария менее зрела. Например, существуют ограничения на поддержку и отладку [.NET Standard](/dotnet/standard/net-standard) .

## <a name="server-side"></a>Компоненты на стороне сервера

В модели размещения на стороне сервера приложение выполняется на сервере из приложения ASP.NET Core. Обновление элементов пользовательского интерфейса, обработка событий и вызовы JavaScript обрабатываются через подключение [SignalR](xref:signalr/introduction).

![Браузер взаимодействует с приложением (размещенным в приложении ASP.NET Core) на сервере через подключение SignalR.](hosting-models/_static/server-side.png)

Чтобы создать приложение Блазор с помощью модели размещения на стороне сервера, используйте шаблон **серверное приложение ASP.NET Core блазор** ([DotNet New блазорсервер](/dotnet/core/tools/dotnet-new)). Приложение ASP.NET Core размещает приложение на стороне сервера и создает конечную точку SignalR, в которую подключаются клиенты.

ASP.NET Core приложение ссылается на `Startup` класс приложения для добавления:

* Службы на стороне сервера.
* Приложение в конвейер обработки запросов.

Сценарий&dagger; *блазор. Server. js* устанавливает клиентское соединение. Ответственность за сохранение и восстановление состояния приложения в случае необходимости (например, в случае потери сетевого подключения) несет приложение.

Модель размещения на стороне сервера предлагает несколько преимуществ.

* Размер скачивания значительно меньше клиентского приложения, и приложение загружается гораздо быстрее.
* Приложение обладает всеми преимуществами серверных возможностей, включая использование любых API-интерфейсов, совместимых с .NET Core.
* .NET Core на сервере используется для запуска приложения, поэтому существующие инструменты .NET, такие как отладка, работают должным образом.
* Поддерживаются тонкие клиенты. Например, серверные приложения работают с браузерами, которые не поддерживают веб-сборку и устройства с ограниченными ресурсами.
* База .NET (C# код) приложения, включая код компонента приложения, не обслуживаются для клиентов.

Существуют недостатки размещения на стороне сервера:

* Обычно существует большая задержка. Каждое взаимодействие с пользователем включает сетевой прыжок.
* Автономная поддержка отсутствует. Если подключение клиента завершается сбоем, приложение перестает работать.
* Масштабируемость — это сложная задача для приложений с большим количеством пользователей. Сервер должен управлять несколькими клиентскими подключениями и обрабатывать состояние клиента.
* Для обслуживания приложения требуется сервер ASP.NET Core. Сценарии бессерверного развертывания невозможны (например, обслуживание приложения из CDN).

&dagger;Сценарий *блазор. Server. js* обрабатывается из внедренного ресурса в ASP.NET Core общей платформе.

### <a name="reconnection-to-the-same-server"></a>Повторное подключение к тому же серверу

Для приложений на стороне сервера блазор требуется активное подключение SignalR к серверу. Если соединение потеряно, приложение попытается повторно подключиться к серверу. Пока состояние клиента по-прежнему находится в памяти, сеанс клиента возобновляется без потери состояния.
 
Когда клиент обнаруживает, что соединение потеряно, пользователь по умолчанию отображает пользовательский интерфейс, когда клиент пытается повторно подключиться. Если происходит сбой повторного подключения, пользователь предоставляет возможность повторить попытку. Чтобы настроить пользовательский интерфейс, определите элемент, указав `components-reconnect-modal` его `id` в качестве элемента на странице Razor *_Host. cshtml* . Клиент обновляет этот элемент одним из следующих классов CSS в зависимости от состояния соединения:
 
* `components-reconnect-show`&ndash; Показать пользовательский интерфейс, указывающий, что соединение было потеряно, а клиент пытается повторно подключиться.
* `components-reconnect-hide`&ndash; Клиент имеет активное соединение, скрыть пользовательский интерфейс.
* `components-reconnect-failed`&ndash; Сбой повторного подключения. Чтобы повторить попытку повторного подключения `window.Blazor.reconnect()`, вызовите.

### <a name="stateful-reconnection-after-prerendering"></a>Повторное подключение с отслеживанием состояния после предварительной подготовки к просмотру
 
Приложения блазор на стороне сервера настраиваются по умолчанию для создания интерфейса пользователя на сервере, прежде чем будет установлено клиентское соединение с сервером. Это настраивается на странице Razor *_Host. cshtml* :
 
```cshtml
<body>
    <app>@(await Html.RenderComponentAsync<App>(RenderMode.ServerPrerendered))</app>
 
    <script src="_framework/blazor.server.js"></script>
</body>
```

`RenderMode`Настраивает, является ли компонент:

* Предварительно отображается на странице.
* Отображается как статический HTML на странице или включает необходимые сведения для начальной загрузки приложения Блазор из агента пользователя.

| `RenderMode`        | Описание |
| ------------------- | ----------- |
| `ServerPrerendered` | Преобразует компонент в статический HTML и включает маркер для серверного приложения Блазор. При запуске агента пользователя этот маркер используется для начальной загрузки приложения Блазор. Параметры не поддерживаются. |
| `Server`            | Отображает маркер для серверного приложения Блазор. Выходные данные компонента не включаются. При запуске агента пользователя этот маркер используется для начальной загрузки приложения Блазор. Параметры не поддерживаются. |
| `Static`            | Преобразует компонент в статический HTML. Поддерживаются параметры. |

Отрисовка компонентов сервера из статической HTML-страницы не поддерживается.
 
Клиент повторно подключится к серверу с тем же состоянием, которое использовалось для выprerender приложения. Если состояние приложения по-прежнему находится в памяти, состояние компонента не будет повторно отображено после установления подключения SignalR.

### <a name="render-stateful-interactive-components-from-razor-pages-and-views"></a>Отображение интерактивных компонентов с отслеживанием состояния из страниц и представлений Razor
 
Интерактивные компоненты с отслеживанием состояния могут быть добавлены на страницу Razor или в представление.

При визуализации страницы или представления:

* Компонент предварительно отображается страницей или представлением.
* Исходное состояние компонента, используемое для предварительной визуализации, потеряно.
* Состояние нового компонента создается при установлении подключения SignalR.
 
Следующая страница Razor визуализирует `Counter` компонент:

```cshtml
<h1>My Razor Page</h1>
 
@(await Html.RenderComponentAsync<Counter>(RenderMode.ServerPrerendered))
```

### <a name="render-noninteractive-components-from-razor-pages-and-views"></a>Прорисовка неинтерактивных компонентов на страницах и представлениях Razor

На следующей странице `MyComponent` Razor компонент статически подготавливается к просмотру с начальным значением, указанным с помощью формы:
 
```cshtml
<h1>My Razor Page</h1>

<form>
    <input type="number" asp-for="InitialValue" />
    <button type="submit">Set initial value</button>
</form>
 
@(await Html.RenderComponentAsync<MyComponent>(RenderMode.Static, 
    new { InitialValue = InitialValue }))
 
@code {
    [BindProperty(SupportsGet=true)]
    public int InitialValue { get; set; }
}
```

Так `MyComponent` как статически отображается, компонент не может быть интерактивным.

### <a name="detect-when-the-app-is-prerendering"></a>Обнаруживать время подготовки приложения к просмотру
 
[!INCLUDE[](~/includes/blazor-prerendering.md)]

### <a name="configure-the-signalr-client-for-blazor-server-side-apps"></a>Настройка клиента SignalR для приложений на стороне сервера Блазор
 
Иногда необходимо настроить клиент SignalR, используемый приложениями Блазор на стороне сервера. Например, может потребоваться настроить ведение журнала на клиенте SignalR для диагностики проблемы с подключением.
 
Чтобы настроить клиент SignalR в файле *pages/_Host. cshtml* , сделайте следующее:

* Добавьте атрибут в тег для скрипта *блазор. Server. js.* `<script>` `autostart="false"`
* Вызовите `Blazor.start` и передайте объект конфигурации, указывающий построитель SignalR.
 
```html
<script src="_framework/blazor.server.js" autostart="false"></script>
<script>
  Blazor.start({
    configureSignalR: function (builder) {
      builder.configureLogging(2); // LogLevel.Information
    }
  });
</script>
```

## <a name="additional-resources"></a>Дополнительные ресурсы

* <xref:blazor/get-started>
* <xref:signalr/introduction>
