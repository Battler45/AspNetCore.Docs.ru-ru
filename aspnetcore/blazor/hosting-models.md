---
title: Модели размещения Blazor ASP.NET Core
author: guardrex
description: Общие сведения о моделях размещения Blazor и Blazor Server.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 02/12/2020
no-loc:
- Blazor
- SignalR
uid: blazor/hosting-models
ms.openlocfilehash: 54be0e032a60c69880f428e52f9d778032385dc5
ms.sourcegitcommit: 6645435fc8f5092fc7e923742e85592b56e37ada
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2020
ms.locfileid: "77447052"
---
# <a name="aspnet-core-opno-locblazor-hosting-models"></a>Модели размещения Blazor ASP.NET Core

По [Даниэль Roth)](https://github.com/danroth27)

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

Blazor — это веб-платформа, предназначенная для запуска на стороне клиента в браузере в среде выполнения .NET на основе [сборки](https://webassembly.org/)(Blazor веб- *сборки*) или на стороне сервера в ASP.NET Core ( *Blazor Server*). Независимо от модели размещения, модели приложения и компонента *одинаковы*.

Сведения о создании проекта для моделей размещения, описанных в этой статье, см. в разделе <xref:blazor/get-started>.

Дополнительные сведения о конфигурации см. в разделе <xref:blazor/hosting-model-configuration>.

## <a name="opno-locblazor-webassembly"></a>Blazor WebAssembly

Основная модель размещения для Blazor работает на стороне клиента в браузере на веб-сборке. Приложение Blazor, его зависимости и среда выполнения .NET скачиваются в браузере. Приложение выполняется непосредственно в потоке пользовательского интерфейса браузера. Обновления пользовательского интерфейса и обработка событий выполняются в рамках одного процесса. Ресурсы приложения развертываются как статические файлы на веб-сервере или в службе, способной обслуживать статические содержимое клиентам.

![[! Операцион. NO-LOC (Блазор)]. сборка: [! Операцион. Приложение NO-LOC (Блазор)] выполняется в потоке пользовательского интерфейса в браузере.](hosting-models/_static/blazor-webassembly.png)

Чтобы создать Blazor приложение с помощью клиентской модели размещения, используйте шаблон **приложенияBlazor сборки** ([DotNet New блазорвасм](/dotnet/core/tools/dotnet-new)).

ВыбравBlazor шаблон **приложения-сборки** , вы можете настроить приложение для использования ASP.NET Core серверной части, установив флажок **ASP.NET Core Hosted** ([DotNet New блазорвасм — Hosted](/dotnet/core/tools/dotnet-new)). ASP.NET Core приложение обслуживает Blazor приложение клиентам. Blazor приложение веб-сборки может взаимодействовать с сервером по сети с помощью вызовов API или [SignalR](xref:signalr/introduction) (<xref:tutorials/signalr-blazor-webassembly>).

Шаблоны включают `blazor.webassembly.js` сценарий, который обрабатывает:

* Загрузка среды выполнения .NET, приложения и зависимостей приложения.
* Инициализация среды выполнения для запуска приложения.

Модель размещения Blazorных сборок предоставляет несколько преимуществ.

* Зависимость на стороне сервера .NET отсутствует. Приложение полностью работает после загрузки на клиент.
* Ресурсы и возможности клиента полностью используются.
* Работа разгружается с сервера на клиент.
* Веб-сервер ASP.NET Core не требуется для размещения приложения. Возможны сценарии бессерверного развертывания (например, обслуживание приложения из CDN).

Существует недостаток для Blazor размещения сборки:

* Приложение ограничено возможностями браузера.
* Требуется аппаратное и программное обеспечение, поддерживающее клиент (например, поддержка сборок).
* Размер скачивания больше, и приложения загружаются дольше.
* Поддержка среды выполнения .NET и инструментария менее зрела. Например, существуют ограничения на поддержку и отладку [.NET Standard](/dotnet/standard/net-standard) .

## <a name="opno-locblazor-server"></a>Сервер Blazor

При использовании модели размещения сервера Blazor приложение выполняется на сервере из приложения ASP.NET Core. Обновление элементов пользовательского интерфейса, обработка событий и вызовы JavaScript обрабатываются через подключение [SignalR](xref:signalr/introduction).

![Браузер взаимодействует с приложением (размещенным в приложении ASP.NET Core) на сервере через [! Операцион. НЕТ-LOC (SignalR)] подключение.](hosting-models/_static/blazor-server.png)

Чтобы создать Blazor приложение с помощью модели размещения сервера Blazor, используйте шаблон **серверного приложения ASP.NET CoreBlazor** ([DotNet New блазорсервер](/dotnet/core/tools/dotnet-new)). Приложение ASP.NET Core размещает приложение Blazor Server и создает конечную точку SignalR, в которую подключаются клиенты.

ASP.NET Core приложение ссылается на класс `Startup` приложения для добавления:

* Службы на стороне сервера.
* Приложение в конвейер обработки запросов.

Сценарий `blazor.server.js`&dagger; устанавливает соединение с клиентом. Ответственность за сохранение и восстановление состояния приложения в случае необходимости (например, в случае потери сетевого подключения) несет приложение.

Модель размещения серверов Blazor предлагает несколько преимуществ.

* Размер загружаемого файла значительно меньше, чем Blazor приложение сборки, и приложение загружается гораздо быстрее.
* Приложение обладает всеми преимуществами серверных возможностей, включая использование любых API-интерфейсов, совместимых с .NET Core.
* .NET Core на сервере используется для запуска приложения, поэтому существующие инструменты .NET, такие как отладка, работают должным образом.
* Поддерживаются тонкие клиенты. Например, Blazor серверные приложения работают с браузерами, которые не поддерживают сборку и устройства с ограниченными ресурсами.
* База .NET (C# код) приложения, включая код компонента приложения, не обслуживаются для клиентов.

Существуют недостатки Blazor размещения сервера:

* Обычно существует большая задержка. Каждое взаимодействие с пользователем включает сетевой прыжок.
* Автономная поддержка отсутствует. Если подключение клиента завершается сбоем, приложение перестает работать.
* Масштабируемость — это сложная задача для приложений с большим количеством пользователей. Сервер должен управлять несколькими клиентскими подключениями и обрабатывать состояние клиента.
* Для обслуживания приложения требуется сервер ASP.NET Core. Сценарии бессерверного развертывания невозможны (например, обслуживание приложения из CDN).

&dagger;сценарий `blazor.server.js` обслуживается из внедренного ресурса в ASP.NET Core общей платформе.

### <a name="comparison-to-server-rendered-ui"></a>Сравнение с ИНТЕРФЕЙСом, отображаемым сервером

Одним из способов понимания Blazor серверных приложений является понимание того, как оно отличается от традиционных моделей для отрисовки пользовательского интерфейса в ASP.NET Core приложениях с помощью представлений Razor или Razor Pages. В обеих моделях используется язык Razor для описания содержимого HTML, но они значительно отличаются от отрисовки разметки.

При отрисовке страницы Razor или представления каждая строка кода Razor выдает HTML в виде текста. После отрисовки сервер удаляет экземпляр страницы или представления, включая любое созданное состояние. Когда происходит другой запрос к странице, например при сбое проверки сервера и отображении сводки проверки:

* Вся страница снова преобразуется в HTML-текст.
* Страница отправляется клиенту.

Blazor приложение состоит из многократно используемых элементов пользовательского интерфейса, называемых *компонентами*. Компонент содержит C# код, разметку и другие компоненты. При подготовке компонента к просмотру Blazor создает граф включенных компонентов, аналогичный HTML-или модель DOM XML (DOM). Эта диаграмма включает в себя состояние компонента, содержащееся в свойствах и полях. Blazor оценивает граф компонентов для создания двоичного представления разметки. Двоичный формат может быть следующим:

* Включено в текст HTML (во время предварительной отрисовки&dagger;).
* Используется для эффективного обновления разметки во время обычной отрисовки.

&dagger;Предварительная *подготовка* &ndash; запрошенный компонент Razor компилируется на сервере в статический HTML и отправляется клиенту, где он готовится к просмотру пользователю. После соединения между клиентом и сервером статические предварительно отображаемые элементы компонента заменяются интерактивными элементами. Предварительная визуализация делает приложение более быстрым реагированием на пользователя.

Обновление пользовательского интерфейса в Blazor активируется следующим образом:

* Взаимодействие с пользователем, например выбор кнопки.
* Триггеры приложений, например таймер.

Граф перерисовывается, и вычисляется *различие в пользовательском* интерфейсе (разница). Это различие является наименьшим набором изменений DOM, необходимых для обновления пользовательского интерфейса на клиенте. Diff отправляется клиенту в двоичном формате и применяется в браузере.

Компонент уничтожается после того, как пользователь выходит из него с клиента. Несмотря на то, что пользователь взаимодействует с компонентом, состояние компонента (службы, ресурсы) должно храниться в памяти сервера. Так как состояние множества компонентов может поддерживаться сервером одновременно, нехватка памяти является проблемой, которую необходимо решить. Инструкции по созданию приложения Blazor Server для обеспечения оптимального использования памяти сервера см. в разделе <xref:security/blazor/server>.

### <a name="circuits"></a>Защит

Серверное приложение Blazor построено на основе [ASP.NET Core SignalR](xref:signalr/introduction). Каждый клиент взаимодействует с сервером через одно или несколько SignalR соединений, называемых *каналом*. Цепь — это Blazorабстракции для SignalR подключений, которые могут допускать временные перерывы в сети. Когда клиент Blazor видит, что SignalRное подключение отключено, оно пытается повторно подключиться к серверу с помощью нового соединения SignalR.

Каждый экран браузера (вкладка браузера или IFRAME), подключенный к Blazor серверному приложению, использует SignalRное соединение. Это еще одно важное различие по сравнению с обычными серверно-визуализированными приложениями. В приложении, готовом для просмотра, открытие одного и того же приложения на нескольких экранах браузера обычно не приводит к дополнительным требованиям к ресурсам на сервере. В приложении Blazor Server каждый экран браузера требует отдельного канала и отдельных экземпляров состояния компонента для управления сервером.

Blazor рассматривает закрытие вкладки браузера или переход по внешнему URL-адресу *корректное* завершение. В случае корректного завершения работы канал и связанные ресурсы немедленно освобождаются. Клиент может также отключиться от некорректного, например, из-за прерывания работы сети. Blazor Server хранит отключенные цепи в течение настраиваемого интервала, чтобы разрешить клиенту повторное подключение.

### <a name="ui-latency"></a>Задержка пользовательского интерфейса

Задержка пользовательского интерфейса — это время, которое занимает от инициированного действия до момента обновления пользовательского интерфейса. Меньшее значение задержки пользовательского интерфейса является обязательным, чтобы приложение было легко реагировать на пользователя. В приложении Blazor Server каждое действие отправляется на сервер, обрабатывается, и разница пользовательского интерфейса отсылается обратно. Следовательно, задержка пользовательского интерфейса — это сумма задержки в сети и задержки сервера при обработке действия.

Для бизнес-приложения, которое ограничено частной корпоративной сетью, воздействие на восприятие пользователей задержки из-за задержки в сети обычно незаметно. Для приложения, развернутого через Интернет, задержка может стать заметным для пользователей, особенно в том случае, если пользователи широко распределены географически.

Использование памяти может также повлиять на задержку приложения. Увеличение использования памяти приводит к частым сборкам мусора или выделению памяти на диск, что снижает производительность приложений и, следовательно, увеличивает задержку пользовательского интерфейса. Дополнительные сведения см. в разделе <xref:security/blazor/server>.

Blazor серверные приложения должны быть оптимизированы для минимизации задержки пользовательского интерфейса за счет уменьшения задержки сети и использования памяти. Способ измерения задержки в сети см. в разделе <xref:host-and-deploy/blazor/server#measure-network-latency>. Дополнительные сведения о SignalR и Blazorсм. в следующих статьях:

* <xref:host-and-deploy/blazor/server>
* <xref:security/blazor/server>

### <a name="connection-to-the-server"></a>Соединение с сервером

для Blazor серверных приложений требуется активное подключение SignalR к серверу. Если соединение потеряно, приложение попытается повторно подключиться к серверу. Пока состояние клиента по-прежнему находится в памяти, сеанс клиента возобновляется без потери состояния.

Приложение Blazor Server предварительно отображается в ответ на первый клиентский запрос, который настраивает состояние пользовательского интерфейса на сервере. Когда клиент пытается создать SignalR подключение, клиент должен повторно подключиться к тому же серверу. Blazor серверных приложений, использующих более одного внутреннего сервера, должны реализовывать *закрепленные сеансы* для SignalRных соединений.

Мы рекомендуем использовать для серверных приложений [SignalRслужбу Azure ](/azure/azure-signalr)Blazor. Она позволяет вертикально масштабировать серверные приложения Blazor для одновременного использования большого числа подключений SignalR. Прикрепленные сеансы включены для службы SignalR Azure, задав для параметра `ServerStickyMode` или значения конфигурации службы значение `Required`. Дополнительные сведения см. в разделе <xref:host-and-deploy/blazor/server#signalr-configuration>.

При использовании служб IIS прикрепленные сеансы включаются с помощью маршрутизации запросов приложений. Дополнительные сведения см. в статье [Балансировка нагрузки HTTP с помощью маршрутизации запросов приложений](/iis/extensions/configuring-application-request-routing-arr/http-load-balancing-using-application-request-routing).

## <a name="additional-resources"></a>Дополнительные ресурсы

* <xref:blazor/get-started>
* <xref:signalr/introduction>
* <xref:blazor/hosting-model-configuration>
* <xref:tutorials/signalr-blazor-webassembly>
