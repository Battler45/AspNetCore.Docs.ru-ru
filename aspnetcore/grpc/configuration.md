---
title: Конфигурация gRPC для .NET
author: jamesnk
description: Узнайте, как настроить gRPC для приложений .NET.
monikerRange: '>= aspnetcore-3.0'
ms.author: jamesnk
ms.custom: mvc
ms.date: 09/05/2019
uid: grpc/configuration
ms.openlocfilehash: de478752f94713d7f3d55ed66e6410500c3a72e8
ms.sourcegitcommit: 2cb857f0de774df421e35289662ba92cfe56ffd1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/25/2019
ms.locfileid: "75355736"
---
# <a name="grpc-for-net-configuration"></a>Конфигурация gRPC для .NET

## <a name="configure-services-options"></a>Настройка параметров служб

службы gRPC настроены с `AddGrpc` в *Startup.CS*. В следующей таблице описаны параметры для настройки служб gRPC Services.

| Параметр | Значение по умолчанию | Описание |
| ------ | ------------- | ----------- |
| `MaxSendMessageSize` | `null` | Максимальный размер сообщения в байтах, которое может быть отправлено с сервера. Попытка отправить сообщение, превышающее заданный максимальный размер сообщения, приведет к исключению. |
| `MaxReceiveMessageSize` | 4 МБ | Максимальный размер сообщения в байтах, которое может быть получено сервером. Если сервер получает сообщение, размер которого превышает это ограничение, вызывается исключение. Увеличение этого значения позволяет серверу принимать большие сообщения, но может негативно сказаться на потреблении памяти. |
| `EnableDetailedErrors` | `false` | Если `true`, подробные сообщения об исключениях возвращаются клиентам при возникновении исключения в методе службы. Значение по умолчанию — `false`. Установка `EnableDetailedErrors` `true` может привести к утечке конфиденциальной информации. |
| `CompressionProviders` | gzip | Коллекция поставщиков сжатия, используемая для сжатия и распаковки сообщений. Пользовательские поставщики сжатия можно создать и добавить в коллекцию. Настроенные по умолчанию поставщики поддерживают сжатие **gzip** . |
| `ResponseCompressionAlgorithm` | `null` | Алгоритм сжатия, используемый для сжатия сообщений, отправленных с сервера. Алгоритм должен соответствовать поставщику сжатия в `CompressionProviders`. Чтобы алгоритм выполнял сжатие ответа, клиент должен указать, что он поддерживает алгоритм, отправив его в заголовке **GRPC-Accept-Encoding** . |
| `ResponseCompressionLevel` | `null` | Уровень сжатия, используемый для сжатия сообщений, отправленных с сервера. |
| `Interceptors` | Нет | Коллекция перехватчиков, которые выполняются с каждым вызовом gRPC. Перехватчики выполняются в том порядке, в котором они зарегистрированы. Глобально настроенные перехватчики выполняются до того, как перехватчики настроены для одной службы. Дополнительные сведения о перехватчиках gRPC см. в разделе [GRPC перехватчики и по промежуточного слоя](xref:grpc/migration#grpc-interceptors-vs-middleware). |

Параметры можно настроить для всех служб, предоставив делегаты параметров для вызова `AddGrpc` в `Startup.ConfigureServices`:

[!code-csharp[](~/grpc/configuration/sample/GrcpService/Startup.cs?name=snippet)]

Параметры одной службы переопределяют глобальные параметры, предоставленные в `AddGrpc` и могут быть настроены с помощью `AddServiceOptions<TService>`:

[!code-csharp[](~/grpc/configuration/sample/GrcpService/Startup2.cs?name=snippet)]

## <a name="configure-client-options"></a>Настройка параметров клиента

Конфигурация клиента gRPC задается на `GrpcChannelOptions`. В следующей таблице описаны параметры для настройки каналов gRPC.

| Параметр | Значение по умолчанию | Описание |
| ------ | ------------- | ----------- |
| `HttpClient` | Новый экземпляр | `HttpClient`, используемый для выполнения вызовов gRPC. Клиент может быть настроен для настройки пользовательского `HttpClientHandler`или добавления дополнительных обработчиков в конвейер HTTP для вызовов gRPC. Если `HttpClient` не указано, то для канала создается новый экземпляр `HttpClient`. Он будет автоматически удален. |
| `DisposeHttpClient` | `false` | Если `true`и указан `HttpClient`, то экземпляр `HttpClient` будет удален при удалении `GrpcChannel`. |
| `LoggerFactory` | `null` | `LoggerFactory`, используемый клиентом для записи в журнал сведений о вызовах gRPC. `LoggerFactory` экземпляр можно разрешить из внедрения зависимостей или создать с помощью `LoggerFactory.Create`. Примеры настройки ведения журнала см. в разделе <xref:grpc/diagnostics#grpc-client-logging>. |
| `MaxSendMessageSize` | `null` | Максимальный размер сообщения в байтах, которое может быть отправлено клиентом. Попытка отправить сообщение, превышающее заданный максимальный размер сообщения, приведет к исключению. |
| `MaxReceiveMessageSize` | 4 МБ | Максимальный размер сообщения в байтах, которое может быть получено клиентом. Если клиент получает сообщение, размер которого превышает это ограничение, вызывается исключение. Увеличение этого значения позволяет клиенту принимать большие сообщения, но может негативно сказаться на потреблении памяти. |
| `Credentials` | `null` | Экземпляр `ChannelCredentials`. Учетные данные используются для добавления метаданных проверки подлинности в вызовы gRPC. |
| `CompressionProviders` | gzip | Коллекция поставщиков сжатия, используемая для сжатия и распаковки сообщений. Пользовательские поставщики сжатия можно создать и добавить в коллекцию. Настроенные по умолчанию поставщики поддерживают сжатие **gzip** . |

В приведенном ниже коде

* Задает максимальный размер сообщения для отправки и получения в канале.
* Создает клиент.

[!code-csharp[](~/grpc/configuration/sample/Program.cs?name=snippet&highlight=3-8)]

[!INCLUDE[](~/includes/gRPCazure.md)]

## <a name="additional-resources"></a>Дополнительные ресурсы

* <xref:grpc/aspnetcore>
* <xref:grpc/client>
* <xref:grpc/diagnostics>
* <xref:tutorials/grpc/grpc-start>
